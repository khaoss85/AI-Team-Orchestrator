<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Il Test Comprensivo – L'Esame di Maturità del Sistema | Esecuzione Qualita | AI Team Orchestrator</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Capitolo 18 del libro AI Team Orchestrator: Il Test Comprensivo – L'Esame di Maturità del Sistema">
    <meta name="keywords" content="AI agents, sistema AI-driven, architettura AI, OpenAI SDK, team AI">
    <meta name="author" content="Daniele Pelleri">
    <meta name="robots" content="index, follow">

    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🤖</text></svg>">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Il Test Comprensivo – L'Esame di Maturità del Sistema">
    <meta property="og:description" content="Capitolo 18 del libro AI Team Orchestrator: Il Test Comprensivo – L'Esame di Maturità del Sistema">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://books.danielepelleri.com/it/esecuzione-qualita/test-comprensivo-esame-maturita/">
    
    <!-- Canonical -->
    <link rel="canonical" href="https://books.danielepelleri.com/it/esecuzione-qualita/test-comprensivo-esame-maturita/">
    <link rel="alternate" hreflang="en" href="https://books.danielepelleri.com/en/execution-quality/test-comprensivo-esame-maturita/">
    <link rel="alternate" hreflang="it" href="https://books.danielepelleri.com/it/esecuzione-qualita/test-comprensivo-esame-maturita/">
    
    <style>
        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #2c3e50;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        /* Breadcrumb Navigation */
        .breadcrumb {
            background: rgba(255, 255, 255, 0.9);
            padding: 1rem 2rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
        }
        
        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
        }
        
        .breadcrumb a:hover {
            text-decoration: underline;
        }
        
        .breadcrumb span {
            color: #7f8c8d;
            margin: 0 0.5rem;
        }
        
        /* Chapter Header */
        .chapter-header {
            background: white;
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            margin-bottom: 3rem;
            text-align: center;
        }
        
        .chapter-instrument {
            font-size: 4rem;
            margin-bottom: 1rem;
        }
        
        .chapter-meta {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            color: #7f8c8d;
            flex-wrap: wrap;
        }
        
        .chapter-title {
            font-size: 2.5rem;
            color: #2c3e50;
            margin-bottom: 1rem;
            font-weight: 700;
            line-height: 1.2;
        }
        
        /* Content Styles */
        .chapter-content {
            background: white;
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            margin-bottom: 3rem;
        }
        
        .chapter-content h3 {
            font-size: 2rem;
            color: #2c3e50;
            margin: 2rem 0 1rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 0.5rem;
        }
        
        .chapter-content h4 {
            font-size: 1.5rem;
            color: #495057;
            margin: 1.5rem 0 1rem;
        }
        
        .chapter-content p {
            margin-bottom: 1.5rem;
            font-size: 1.1rem;
            line-height: 1.8;
        }
        
        .chapter-content ul, .chapter-content ol {
            margin: 1.5rem 0;
            padding-left: 2rem;
        }
        
        .chapter-content li {
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
            line-height: 1.6;
        }
        
        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin: 2rem 0;
        }
        
        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }
        
        th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
        }
        
        /* Code Styles */
        pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1.5rem 0;
            font-size: 0.9rem;
        }
        
        code {
            background: #f1f3f4;
            color: #d73a49;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        }
        
        pre code {
            background: transparent;
            color: inherit;
            padding: 0;
        }
        
        /* Special Boxes */
        .war-story, .industry-insight, .architecture-section, .key-takeaways-section {
            border-radius: 10px;
            padding: 2rem;
            margin: 2rem 0;
        }
        
        .war-story {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border-left: 4px solid #856404;
        }
        
        .industry-insight {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-left: 4px solid #28a745;
        }
        
        .architecture-section {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 1px solid #dee2e6;
        }
        
        .key-takeaways-section {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
        }
        
        /* Mermaid Container */
        .mermaid {
            background: #f8f9fa;
            padding: 2rem;
            border-radius: 10px;
            margin: 2rem 0;
            text-align: center;
        }
        
        /* Navigation */
        .chapter-nav-bottom {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 3rem 0;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .nav-button {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem 2rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            text-decoration: none;
            border-radius: 50px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }
        
        .nav-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.6);
        }
        
        .nav-button.secondary {
            background: rgba(255, 255, 255, 0.9);
            color: #667eea;
            border: 2px solid #667eea;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .nav-button.secondary:hover {
            background: white;
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }
        
        /* War Story Icon Styling */
        .war-story-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .war-story-icon {
            width: 1.5rem;
            height: 1.5rem;
            flex-shrink: 0;
            color: #856404;
        }
        
        /* Architecture Section Styling */
        .architecture-title {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .architecture-icon {
            width: 2rem;
            height: 2rem;
            flex-shrink: 0;
            color: #667eea;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .chapter-header,
            .chapter-content {
                padding: 2rem;
            }
            
            .chapter-title {
                font-size: 2rem;
            }
            
            .chapter-nav-bottom {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
        
    <style>
        /* Reader Tools */
        .reader-tools {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .tool-button {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .tool-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        
        /* Bookmark Modal */
        .bookmarks-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 70vh;
            overflow-y: auto;
            position: relative;
        }
        
        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
        }
        
        .close-modal:hover {
            color: #333;
        }
        
        .bookmark-item {
            padding: 0.5rem 0;
            border-bottom: 1px solid #eee;
        }
        
        .bookmark-item:last-child {
            border-bottom: none;
        }
        
        .bookmark-link {
            color: #667eea;
            text-decoration: none;
        }
        
        .bookmark-link:hover {
            text-decoration: underline;
        }
        
        /* Reading Progress Bar */
        .reading-progress {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: rgba(102, 126, 234, 0.2);
            z-index: 999;
        }
        
        .reading-progress::before {
            content: '';
            display: block;
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transform-origin: left;
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }
        
        /* Dark Mode */
        body.dark-mode {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: #ecf0f1;
        }
        
        body.dark-mode .chapter-header,
        body.dark-mode .chapter-content,
        body.dark-mode .breadcrumb {
            background: rgba(52, 73, 94, 0.8);
            color: #ecf0f1;
        }
        
        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 1rem 2rem;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 10001;
        }
        
        .toast.show {
            transform: translateX(0);
        }
    </style>
        
        <!-- 🎯 Shared Lead Generation System -->
        <link rel="stylesheet" href="../../../shared-lead-generation.css">
        <script src="../../../shared-lead-generation.js"></script>
</head>
<body>
    <!-- Reading Progress Bar -->
    <div class="reading-progress" id="readingProgress"></div>
    
    <!-- Reader Tools -->
    <div class="reader-tools">
        <button class="tool-button" onclick="addBookmark()" title="I Miei Segnalibri">📚</button>
        <button class="tool-button" onclick="toggleTheme()" title="Tema">🎨</button>
        <button class="tool-button" onclick="increaseFontSize()" title="Dimensione Font +">A+</button>
        <button class="tool-button" onclick="decreaseFontSize()" title="Dimensione Font -">A-</button>
    </div>
    
    <!-- Bookmark Modal -->
    <div id="bookmarksModal" class="bookmarks-modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeBookmarksModal()">&times;</span>
            <h3>📚 I Miei Segnalibri</h3>
            <div id="bookmarksList">
                <!-- Bookmarks will be populated by JavaScript -->
            </div>
        </div>
    </div>    <div class="container">
        <!-- Breadcrumb -->
        <nav class="breadcrumb">
            <a href="../../ai-team-orchestrator.html">🏠 AI Team Orchestrator</a>
            <span>›</span>
            <a href="../">🎺 Esecuzione Qualita</a>
            <span>›</span>
            <span>Il Test Comprensivo – L'Esame di Maturità del Sistema</span>
        </nav>

        <!-- Chapter Header -->
        <header class="chapter-header">
            <div class="chapter-instrument">🎺</div>
            <div class="chapter-meta">
                <span>🎺 Movimento 2 di 4</span>
                <span>📖 Capitolo 18 di 42</span>
                <span>⏱️ ~6 min lettura</span>
                <span>📊 Livello: Intermedio</span>
            </div>
            <h1 class="chapter-title">Il Test Comprensivo – L'Esame di Maturità del Sistema</h1>
        </header>

        <!-- Main Content -->
        <article class="chapter-content">
<p>Avevamo testato ogni singolo componente in isolamento. Avevamo testato le interazioni tra due o tre componenti. Ma una domanda fondamentale rimaneva senza risposta: <strong>il sistema funziona come un organismo unico e coerente?</strong></p>

<p>Un'orchestra può avere i migliori violinisti e i migliori percussionisti, ma se non hanno mai provato a suonare tutti insieme la stessa sinfonia, il risultato sarà il caos. Era il momento di far suonare la nostra intera orchestra.</p>

<p>Questo ci ha portato a creare il <strong>Test Comprensivo End-to-End</strong>. Non un semplice test, ma una vera e propria simulazione di un intero progetto, dall'inizio alla fine.</p>

<h3>La Decisione Architetturale: Testare lo Scenario, non la Funzione</h3>

<p>L'obiettivo di questo test non era verificare una singola funzione o un singolo agente. L'obiettivo era verificare uno <strong>scenario di business completo</strong>.</p>

<p><em>Codice di riferimento: <code>tests/test_comprehensive_e2e.py</code></em>
<em>Evidenza dai Log: <code>comprehensive_e2e_test_...log</code></em></p>

<p>Abbiamo scelto uno scenario complesso e realistico, basato sulle richieste di un potenziale cliente:</p>

<p>&gt; <em>"Voglio un sistema in grado di raccogliere 50 contatti qualificati (CMO/CTO di aziende SaaS europee) e di suggerire almeno 3 sequenze email da impostare su HubSpot, con un target di open-rate del 30%."</em></p>

<p>Questo non era un task, era un <strong>progetto</strong>. Testarlo significava verificare che decine di componenti e agenti lavorassero in perfetta armonia.</p>

<h3>L'Infrastruttura di Test: Un "Gemello Digitale" dell'Ambiente di Produzione</h3>

<p>Un test di questa portata non può essere eseguito in un ambiente di sviluppo locale. Per garantire che i risultati fossero significativi, abbiamo dovuto costruire un <strong>ambiente di staging dedicato</strong>, un "gemello digitale" del nostro ambiente di produzione.</p>

<p><strong>Componenti Chiave dell'Ambiente di Test Comprensivo:</strong></p>

<table>
<thead>
<tr>
<th>Componente</th>
<th>Implementazione</th>
<th>Scopo Strategico</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Database Dedicato</strong></td>
<td>Un'istanza Supabase separata, identica come schema a quella di produzione.</td>
<td>Isolare i dati di test da quelli reali e permettere un "reset" pulito prima di ogni esecuzione.</td>
</tr>
<tr>
<td><strong>Containerizzazione</strong></td>
<td>L'intera applicazione backend (Executor, API, Monitor) viene eseguita in un container Docker.</td>
<td>Garantire che il test giri nello stesso ambiente software della produzione, eliminando problemi di "funziona sulla mia macchina".</td>
</tr>
<tr>
<td><strong>Mock vs. Servizi Reali</strong></td>
<td>I servizi esterni critici (come l'SDK di OpenAI) vengono eseguiti in modalità "mock" per velocità e costi, ma l'infrastruttura di rete e le chiamate API sono reali.</td>
<td>Trovare il giusto equilibrio tra l'affidabilità di un test realistico e la praticità di un ambiente controllato.</td>
</tr>
<tr>
<td><strong>Script di Orchestrazione</strong></td>
<td>Uno script <code>pytest</code> che non si limita a lanciare funzioni, ma orchestra l'intero scenario: avvia il container, popola il DB con lo stato iniziale, avvia il test e fa il teardown.</td>
<td>Automatizzare l'intero processo per renderlo ripetibile e integrabile in un flusso di CI/CD.</td>
</tr>
</tbody>
</table>

<p>Questa infrastruttura ha richiesto un investimento di tempo, ma è stata fondamentale per la stabilità del nostro processo di sviluppo.</p>

<p><strong>Flusso del Test Comprensivo:</strong></p>

<div class="architecture-section">
    <div class="architecture-title">
        <svg class="architecture-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
            <line x1="9" y1="9" x2="15" y2="9"/>
            <line x1="9" y1="12" x2="15" y2="12"/>
            <line x1="9" y1="15" x2="15" y2="15"/>
        </svg>
        <h4>Architettura del Sistema</h4>
    </div>
    
    <div class="mermaid">
        graph TD
            A[Fase 1: Setup] --> B[Crea un Workspace vuoto<br/>con l'obiettivo del progetto]
            B --> C[Fase 2: Composizione del Team]
            C --> D[Verifica che il Director<br/>crei un team appropriato]
            D --> E[Fase 3: Pianificazione]
            E --> F[Verifica che l'AnalystAgent<br/>scomponga l'obiettivo in task concreti]
            F --> G[Fase 4: Esecuzione Autonoma]
            G --> H[Avvia l'Executor e lo lascia<br/>funzionare senza interruzioni]
            H --> I[Fase 5: Monitoraggio]
            I --> J[Monitora il HealthMonitor<br/>per assicurarsi che non ci siano stalli]
            J --> K[Fase 6: Validazione Finale]
            K --> L[Dopo un tempo definito, ferma il test<br/>e verifica lo stato finale del DB]
            
            subgraph Success[Criteri di Successo]
                L --> M[Almeno 1 Deliverable finale<br/>è stato creato?]
                M --> N[Il contenuto del deliverable è<br/>di alta qualità e senza placeholder?]
                N --> O[Il progresso verso l'obiettivo<br/>50 contatti è > 0?]
                O --> P[Il sistema ha salvato almeno<br/>un insight nella Memoria?]
            end
    </div>
</div>

<h3>"War Story": La Scoperta della "Disconnessione Fatale"</h3>

<p>La prima esecuzione del test comprensivo fu un fallimento catastrofico, ma incredibilmente istruttivo. Il sistema ha lavorato per ore, ha completato decine di task, ma alla fine... nessun deliverable. Il progresso verso l'obiettivo era rimasto a zero.</p>

<p><em>Logbook del Disastro (Analisi post-test):</em></p>

<pre><code class="language-text">ANALISI FINALE:
- Task Completati: 27
- Deliverable Creati: 0
- Progresso Obiettivo &quot;Contatti&quot;: 0/50
- Insights nella Memoria: 8 (generici)</code></pre>

<p>Analizzando il database, abbiamo scoperto la <strong>"Disconnessione Fatale"</strong>. Il problema era surreale: il sistema <strong>estraeva correttamente gli obiettivi</strong> e <strong>creava correttamente i task</strong>, ma, a causa di un bug, <strong>non collegava mai i task agli obiettivi (<code>goal_id</code> era <code>null</code>)</strong>.</p>

<p>Ogni task veniva eseguito in un vuoto strategico. L'agente completava il suo lavoro, ma il sistema non aveva modo di sapere a quale obiettivo di business quel lavoro contribuisse. Di conseguenza, il <code>GoalProgressUpdate</code> non si attivava mai, e la pipeline di creazione dei deliverable non partiva mai.</p>

<p><strong>La Lezione Appresa: Senza Allineamento, l'Esecuzione è Inutile.</strong></p>

<p>Questa è stata forse la lezione più importante di tutto il progetto. Un team di agenti super-efficienti che eseguono task non allineati a un obiettivo strategico è solo un modo molto sofisticato di sprecare risorse.</p>

<ul>
<li><strong>Pilastro #5 (Goal-Driven):</strong> Questo fallimento ci ha mostrato quanto questo pilastro fosse vitale. Non era una feature "nice-to-have", ma la spina dorsale dell'intero sistema.</li>
<li><strong>Test Comprensivi sono Indispensabili:</strong> Nessun test di unità o di integrazione parziale avrebbe mai potuto scovare un problema di disallineamento strategico come questo. Solo testando l'intero ciclo di vita del progetto è emersa la disconnessione.</li>
</ul>

<p>La correzione è stata tecnicamente semplice, ma l'impatto è stato enorme. La seconda esecuzione del test comprensivo è stata un successo, producendo il primo, vero deliverable end-to-end del nostro sistema.</p>

<div class="key-takeaways-section">
    <h4 class="key-takeaways-title">📝 Key Takeaways del Capitolo:</h4>
    <div class="key-takeaways-content"><p class="takeaway-item">✓ <strong>Testa lo Scenario, non la Feature:</strong> Per sistemi complessi, i test più importanti non sono quelli che verificano una singola funzione, ma quelli che simulano uno scenario di business reale dall'inizio alla fine.</p>
<p class="takeaway-item">✓ <strong>Costruisci un "Gemello Digitale":</strong> I test end-to-end affidabili richiedono un ambiente di staging dedicato che rispecchi il più possibile la produzione.</p>
<p class="takeaway-item">✓ <strong>L'Allineamento è Tutto:</strong> Assicurati che ogni singola azione nel tuo sistema sia tracciabile fino a un obiettivo di business di alto livello.</p>
<p class="takeaway-item">✓ <strong>I Fallimenti nei Test Comprensivi sono Miniere d'Oro:</strong> Un fallimento in un test di unità è un bug. Un fallimento in un test comprensivo è spesso un'indicazione di un problema architetturale o strategico fondamentale.</p>
    </div>
</div>

<p><strong>Conclusione del Capitolo</strong></p>

<p>Con il successo del test comprensivo, avevamo finalmente la prova che il nostro "organismo AI" era vitale e funzionante. Poteva prendere un obiettivo astratto e trasformarlo in un risultato concreto.</p>

<p>Ma un ambiente di test è un laboratorio protetto. Il mondo reale è molto più caotico. Eravamo pronti per l'ultima prova prima di poter considerare il nostro sistema "production-ready": il <strong>Test di Produzione</strong>.</p>
            </div>

            
        </article>

        <!-- Bottom Navigation -->
        <nav class="chapter-nav-bottom">
            <a href="../test-consolidamento-semplificare/" class="nav-button secondary">← Capitolo Precedente</a>
            <a href="../test-produzione-sopravvivere/" class="nav-button">Prossimo Capitolo →</a>
        </nav>
    </div>

    <!-- Mermaid.js for diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'base',
            themeVariables: {
                primaryColor: '#667eea',
                primaryTextColor: '#2c3e50',
                primaryBorderColor: '#667eea',
                lineColor: '#7f8c8d',
                secondaryColor: '#f8f9fa',
                tertiaryColor: '#ffffff'
            }
        });
    </script>

    <!-- Prism.js for code highlighting -->
    <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

    <!-- Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-VEGK4VZMG0"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-VEGK4VZMG0');
        
        gtag('event', 'chapter_start', {
            'chapter_title': 'Il Test Comprensivo – L'Esame di Maturità del Sistema',
            'movement': 'esecuzione-qualita',
            'chapter_number': 18
        });
    </script>
    <script src="../../shared-reader-tools.js"></script>
</body>
    
    <script>
        // Reading Progress
        function updateReadingProgress() {
            const article = document.querySelector('.chapter-content');
            const progress = document.getElementById('readingProgress');
            
            if (article && progress) {
                const articleTop = article.offsetTop;
                const articleHeight = article.offsetHeight;
                const windowTop = window.pageYOffset;
                const windowHeight = window.innerHeight;
                
                const articleBottom = articleTop + articleHeight;
                const windowBottom = windowTop + windowHeight;
                
                let progressPercentage = 0;
                
                if (windowTop >= articleTop && windowTop <= articleBottom) {
                    progressPercentage = ((windowTop - articleTop) / articleHeight) * 100;
                } else if (windowBottom >= articleBottom) {
                    progressPercentage = 100;
                }
                
                progress.style.transform = `scaleX(${Math.min(progressPercentage / 100, 1)})`;
            }
        }
        
        window.addEventListener('scroll', updateReadingProgress);
        window.addEventListener('load', updateReadingProgress);
        
        // Font Size Controls
        let currentFontSize = 1.1;
        
        function increaseFontSize() {
            currentFontSize = Math.min(currentFontSize + 0.1, 2.0);
            applyFontSize();
        }
        
        function decreaseFontSize() {
            currentFontSize = Math.max(currentFontSize - 0.1, 0.8);
            applyFontSize();
        }
        
        function applyFontSize() {
            const content = document.querySelector('.chapter-content');
            if (content) {
                const paragraphs = content.querySelectorAll('p, li');
                paragraphs.forEach(p => {
                    p.style.fontSize = currentFontSize + 'rem';
                });
            }
            localStorage.setItem('fontSize', currentFontSize.toString());
        }
        
        // Theme Toggle
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDark.toString());
            showToast(isDark ? 'Modalità scura attivata' : 'Modalità chiara attivata');
        }
        
        // Bookmarks
        function toggleBookmarks() {
            const modal = document.getElementById('bookmarksModal');
            modal.style.display = modal.style.display === 'flex' ? 'none' : 'flex';
            loadBookmarks();
        }
        
        function closeBookmarksModal() {
            document.getElementById('bookmarksModal').style.display = 'none';
        }
        
        function addBookmark() {
            const title = document.querySelector('.chapter-title').textContent;
            const url = window.location.href;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');
            
            // Check if bookmark already exists
            const exists = bookmarks.find(b => b.url === url);
            if (exists) {
                showToast('Segnalibro rimosso!');
                bookmarks = bookmarks.filter(b => b.url !== url);
            } else {
                showToast('Segnalibro salvato!');
                bookmarks.push({
                    title: title,
                    url: url,
                    timestamp: new Date().toISOString()
                });
            }
            
            localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
        }
        
        function loadBookmarks() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');
            const container = document.getElementById('bookmarksList');
            
            if (bookmarks.length === 0) {
                container.innerHTML = '<p>Nessun segnalibro salvato.</p>';
                return;
            }
            
            container.innerHTML = bookmarks
                .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                .map(bookmark => `
                    <div class="bookmark-item">
                        <a href="${bookmark.url}" class="bookmark-link">${bookmark.title}</a>
                    </div>
                `).join('');
        }
        
        // Toast Notifications
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 2000);
        }
        
        // Load saved preferences
        window.addEventListener('load', function() {
            // Load font size
            const savedFontSize = localStorage.getItem('fontSize');
            if (savedFontSize) {
                currentFontSize = parseFloat(savedFontSize);
                applyFontSize();
            }
            
            // Load theme
            const isDark = localStorage.getItem('darkMode') === 'true';
            if (isDark) {
                document.body.classList.add('dark-mode');
            }
        });
    </script>
</html>