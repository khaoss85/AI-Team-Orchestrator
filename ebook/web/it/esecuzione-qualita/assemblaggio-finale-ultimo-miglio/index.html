<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L'Assemblaggio Finale – Il Test dell'Ultimo Miglio | Esecuzione Qualita | AI Team Orchestrator</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Capitolo 13 del libro AI Team Orchestrator: L'Assemblaggio Finale – Il Test dell'Ultimo Miglio">
    <meta name="keywords" content="AI agents, sistema AI-driven, architettura AI, OpenAI SDK, team AI">
    <meta name="author" content="Daniele Pelleri">
    <meta name="robots" content="index, follow">

    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🤖</text></svg>">
    
    <!-- Open Graph -->
    <meta property="og:title" content="L'Assemblaggio Finale – Il Test dell'Ultimo Miglio">
    <meta property="og:description" content="Capitolo 13 del libro AI Team Orchestrator: L'Assemblaggio Finale – Il Test dell'Ultimo Miglio">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://books.danielepelleri.com/it/esecuzione-qualita/assemblaggio-finale-ultimo-miglio/">
    
    <!-- Canonical -->
    <link rel="canonical" href="https://books.danielepelleri.com/it/esecuzione-qualita/assemblaggio-finale-ultimo-miglio/">
    <link rel="alternate" hreflang="en" href="https://books.danielepelleri.com/en/execution-quality/assemblaggio-finale-ultimo-miglio/">
    <link rel="alternate" hreflang="it" href="https://books.danielepelleri.com/it/esecuzione-qualita/assemblaggio-finale-ultimo-miglio/">
    
    <style>
        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #2c3e50;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        /* Breadcrumb Navigation */
        .breadcrumb {
            background: rgba(255, 255, 255, 0.9);
            padding: 1rem 2rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
        }
        
        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
        }
        
        .breadcrumb a:hover {
            text-decoration: underline;
        }
        
        .breadcrumb span {
            color: #7f8c8d;
            margin: 0 0.5rem;
        }
        
        /* Chapter Header */
        .chapter-header {
            background: white;
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            margin-bottom: 3rem;
            text-align: center;
        }
        
        .chapter-instrument {
            font-size: 4rem;
            margin-bottom: 1rem;
        }
        
        .chapter-meta {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            color: #7f8c8d;
            flex-wrap: wrap;
        }
        
        .chapter-title {
            font-size: 2.5rem;
            color: #2c3e50;
            margin-bottom: 1rem;
            font-weight: 700;
            line-height: 1.2;
        }
        
        /* Content Styles */
        .chapter-content {
            background: white;
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            margin-bottom: 3rem;
        }
        
        .chapter-content h3 {
            font-size: 2rem;
            color: #2c3e50;
            margin: 2rem 0 1rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 0.5rem;
        }
        
        .chapter-content h4 {
            font-size: 1.5rem;
            color: #495057;
            margin: 1.5rem 0 1rem;
        }
        
        .chapter-content p {
            margin-bottom: 1.5rem;
            font-size: 1.1rem;
            line-height: 1.8;
        }
        
        .chapter-content ul, .chapter-content ol {
            margin: 1.5rem 0;
            padding-left: 2rem;
        }
        
        .chapter-content li {
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
            line-height: 1.6;
        }
        
        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin: 2rem 0;
        }
        
        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }
        
        th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
        }
        
        /* Code Styles */
        pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1.5rem 0;
            font-size: 0.9rem;
        }
        
        code {
            background: #f1f3f4;
            color: #d73a49;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        }
        
        pre code {
            background: transparent;
            color: inherit;
            padding: 0;
        }
        
        /* Special Boxes */
        .war-story, .industry-insight, .architecture-section, .key-takeaways-section {
            border-radius: 10px;
            padding: 2rem;
            margin: 2rem 0;
        }
        
        .war-story {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border-left: 4px solid #856404;
        }
        
        .industry-insight {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-left: 4px solid #28a745;
        }
        
        .architecture-section {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 1px solid #dee2e6;
        }
        
        .key-takeaways-section {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
        }
        
        /* Mermaid Container */
        .mermaid {
            background: #f8f9fa;
            padding: 2rem;
            border-radius: 10px;
            margin: 2rem 0;
            text-align: center;
        }
        
        /* Navigation */
        .chapter-nav-bottom {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 3rem 0;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .nav-button {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem 2rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            text-decoration: none;
            border-radius: 50px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }
        
        .nav-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.6);
        }
        
        .nav-button.secondary {
            background: rgba(255, 255, 255, 0.9);
            color: #667eea;
            border: 2px solid #667eea;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .nav-button.secondary:hover {
            background: white;
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }
        
        /* War Story Icon Styling */
        .war-story-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .war-story-icon {
            width: 1.5rem;
            height: 1.5rem;
            flex-shrink: 0;
            color: #856404;
        }
        
        /* Architecture Section Styling */
        .architecture-title {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .architecture-icon {
            width: 2rem;
            height: 2rem;
            flex-shrink: 0;
            color: #667eea;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .chapter-header,
            .chapter-content {
                padding: 2rem;
            }
            
            .chapter-title {
                font-size: 2rem;
            }
            
            .chapter-nav-bottom {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
        
        /* Reader Tools */
        .reader-tools {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .tool-button {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .tool-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        
        /* Bookmark Modal */
        .bookmarks-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 70vh;
            overflow-y: auto;
            position: relative;
        }
        
        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
        }
        
        .close-modal:hover {
            color: #333;
        }
        
        .bookmark-item {
            padding: 0.5rem 0;
            border-bottom: 1px solid #eee;
        }
        
        .bookmark-item:last-child {
            border-bottom: none;
        }
        
        .bookmark-link {
            color: #667eea;
            text-decoration: none;
        }
        
        .bookmark-link:hover {
            text-decoration: underline;
        }
        
        /* Reading Progress Bar */
        .reading-progress {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: rgba(102, 126, 234, 0.2);
            z-index: 999;
        }
        
        .reading-progress::before {
            content: '';
            display: block;
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transform-origin: left;
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }
        
        /* Dark Mode */
        body.dark-mode {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: #ecf0f1;
        }
        
        body.dark-mode .chapter-header,
        body.dark-mode .chapter-content,
        body.dark-mode .breadcrumb {
            background: rgba(52, 73, 94, 0.8);
            color: #ecf0f1;
        }
        
        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 1rem 2rem;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 10001;
        }
        
        .toast.show {
            transform: translateX(0);
        }
</head>
<body>
    <!-- Reading Progress Bar -->
    <div class="reading-progress" id="readingProgress"></div>
    
    <!-- Reader Tools -->
    <div class="reader-tools">
        <button class="tool-button" onclick="addBookmark()" title="I Miei Segnalibri">📚</button>
        <button class="tool-button" onclick="toggleTheme()" title="Tema">🎨</button>
        <button class="tool-button" onclick="increaseFontSize()" title="Dimensione Font +">A+</button>
        <button class="tool-button" onclick="decreaseFontSize()" title="Dimensione Font -">A-</button>
    </div>
    
    <!-- Bookmark Modal -->
    <div id="bookmarksModal" class="bookmarks-modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeBookmarksModal()">&times;</span>
            <h3>📚 I Miei Segnalibri</h3>
            <div id="bookmarksList">
                <!-- Bookmarks will be populated by JavaScript -->
            </div>
        </div>
    </div>    <div class="container">
        <!-- Breadcrumb -->
        <nav class="breadcrumb">
            <a href="../../ai-team-orchestrator.html">🏠 AI Team Orchestrator</a>
            <span>›</span>
            <a href="../">🎺 Esecuzione Qualita</a>
            <span>›</span>
            <span>L'Assemblaggio Finale – Il Test dell'Ultimo Miglio</span>
        </nav>

        <!-- Chapter Header -->
        <header class="chapter-header">
            <div class="chapter-instrument">🎺</div>
            <div class="chapter-meta">
                <span>🎺 Movimento 2 di 4</span>
                <span>📖 Capitolo 13 di 42</span>
                <span>⏱️ ~5 min lettura</span>
                <span>📊 Livello: Intermedio</span>
            </div>
            <h1 class="chapter-title">L'Assemblaggio Finale – Il Test dell'Ultimo Miglio</h1>
        </header>

        <!-- Main Content -->
        <article class="chapter-content">
<p>Avevamo raggiunto un punto critico. Il nostro sistema era un eccellente produttore di "ingredienti" di alta qualità: i nostri asset granulari. Il <code>QualityGate</code> assicurava che ogni asset fosse valido, e l'approccio <code>Asset-First</code> garantiva che fossero riutilizzabili. Ma il nostro utente non aveva ordinato degli ingredienti; aveva ordinato un piatto finito.</p>

<p>Il nostro sistema si fermava un passo prima del traguardo. Produceva tutti i pezzi necessari per un deliverable, ma non eseguiva l'ultimo, fondamentale passo: <strong>l'assemblaggio</strong>.</p>

<p>Questa era la sfida dell'ultimo miglio. Come trasformare una collezione di asset di alta qualità in un deliverable finale che fosse coerente, ben strutturato e, soprattutto, più della semplice somma delle sue parti?</p>

<h3>La Decisione Architetturale: L'Agente Assemblatore</h3>

<p>Abbiamo creato un nuovo agente specializzato, il <code>DeliverableAssemblyAgent</code>. Il suo unico scopo è agire come lo "chef" finale della nostra cucina AI.</p>

<p><em>Codice di riferimento: <code>backend/deliverable_system/deliverable_assembly.py</code> (ipotetico)</em></p>

<p>Questo agente non genera nuovi contenuti da zero. È un <strong>curatore e un narratore</strong>. Il suo processo di ragionamento è progettato per:</p>

<ol>
<li><strong>Analizzare l'Obiettivo del Deliverable:</strong> Capire lo scopo finale del prodotto (es. "una presentazione per un cliente", "un report tecnico", "una lista di contatti importabile").</li>
<li><strong>Selezionare gli Asset Rilevanti:</strong> Scegliere dalla collezione di asset disponibili solo quelli pertinenti all'obiettivo specifico del deliverable.</li>
<li><strong>Creare una Struttura Narrativa:</strong> Non si limita a "incollare" gli asset. Decide l'ordine migliore, scrive introduzioni e conclusioni, crea transizioni logiche tra le sezioni e formatta il tutto in un documento coerente.</li>
<li><strong>Garantire la Qualità Finale:</strong> Esegue un ultimo controllo di qualità sull'intero deliverable assemblato, assicurandosi che sia privo di ridondanze e che il tono di voce sia consistente.</li>
</ol>

<p><strong>Flusso di Assemblaggio del Deliverable:</strong></p>

<div class="architecture-section">
    <div class="architecture-title">
        <svg class="architecture-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
            <line x1="9" y1="9" x2="15" y2="9"/>
            <line x1="9" y1="12" x2="15" y2="12"/>
            <line x1="9" y1="15" x2="15" y2="15"/>
        </svg>
        <h4>Architettura del Sistema</h4>
    </div>
    
    <div class="mermaid">
        graph TD
            A[Trigger: Obiettivo Raggiunto] --> B{DeliverableAssemblyAgent si attiva} B --> C[Analizza l'Obiettivo del Deliverable] C --> D{Query al DB per Asset Rilevanti} D --> E[Seleziona e Ordina gli Asset] E --> F{Genera Struttura Narrativa (Intro, Conclusione, Transizioni)} F --> G[Assembla il Contenuto Finale] G --> H{Validazione Finale di Coerenza} H --> I[Salva Deliverable Finito nel DB]
    </div>
</div>

<h3>Il Prompt dello "Chef AI"</h3>

<p>Il prompt per questo agente è uno dei più complessi, perché richiede non solo capacità analitiche, ma anche creative e narrative.</p>

<pre><code class="language-python">prompt = f&quot;&quot;&quot;
Sei un Editor Strategico di livello mondiale. Il tuo compito è prendere una serie di asset informativi grezzi e assemblarli in un deliverable finale di altissima qualità, coerente e pronto per un cliente esigente.

**Obiettivo del Deliverable Finale:**
&quot;{goal_description}&quot;

**Asset Disponibili (JSON):**
{json.dumps(assets, indent=2)}

**Istruzioni per l&#x27;Assemblaggio:**
1.  **Analisi e Selezione:** Seleziona solo gli asset più rilevanti e di alta qualità per raggiungere l&#x27;obiettivo. Scarta quelli ridondanti o non pertinenti.
2.  **Struttura Narrativa:** Proponi una struttura logica per il documento finale (es. &quot;1. Executive Summary, 2. Analisi Dati Chiave, 3. Raccomandazioni Strategiche, 4. Prossimi Passi&quot;).
3.  **Scrittura dei Raccordi:** Scrivi un&#x27;introduzione che presenti lo scopo del documento e una conclusione che riassuma i punti chiave e le azioni consigliate. Scrivi brevi frasi di transizione per collegare i diversi asset in modo fluido.
4.  **Formattazione Professionale:** Formatta l&#x27;intero documento in Markdown, usando titoli, grassetti e liste per massimizzare la leggibilità.
5.  **Titolo Finale:** Crea un titolo per il deliverable che sia professionale e descrittivo.

**Output Format (JSON only):**
{{
  &quot;title&quot;: &quot;Titolo del Deliverable Finale&quot;,
  &quot;content_markdown&quot;: &quot;Il contenuto completo del deliverable, formattato in Markdown...&quot;,
  &quot;assets_used&quot;: [&quot;id_asset_1&quot;, &quot;id_asset_3&quot;],
  &quot;assembly_reasoning&quot;: &quot;La logica che hai seguito per scegliere e ordinare gli asset e per creare la struttura narrativa.&quot;
}}
&quot;&quot;&quot;</code></pre>

<h3>"War Story": Il Deliverable "Frankenstein"</h3>

<p>Il nostro primo test di assemblaggio ha prodotto un risultato che abbiamo soprannominato il "Deliverable Frankenstein".</p>

<p><em>Evidenza: <code>test_final_deliverable_assembly.py</code> (primi tentativi falliti)</em></p>

<p>L'agente aveva eseguito le istruzioni alla lettera: aveva preso tutti gli asset e li aveva messi uno dopo l'altro, separati da un semplice "ecco il prossimo asset". Il risultato era un documento tecnicamente corretto, ma illeggibile, incoerente e privo di una visione d'insieme. Era un "data dump", non un deliverable.</p>

<p><strong>La Lezione Appresa: L'Assemblaggio è un Atto Creativo, non Meccanico.</strong></p>

<p>Abbiamo capito che il nostro prompt era troppo focalizzato sull'azione meccanica di "mettere insieme i pezzi". Mancava la direttiva strategica più importante: <strong>creare una narrazione</strong>.</p>

<p>La soluzione è stata arricchire il prompt con istruzioni che forzassero l'AI a pensare come un <strong>editor</strong> e non come un semplice "assemblatore":</p>

<ul>
<li>Abbiamo aggiunto la <strong>"Struttura Narrativa"</strong> come passo esplicito.</li>
<li>Abbiamo introdotto la <strong>"Scrittura dei Raccordi"</strong> per obbligarlo a creare un flusso logico.</li>
<li>Abbiamo richiesto l'<strong><code>assembly_reasoning</code></strong> nell'output per forzarlo a riflettere sul <em>perché</em> delle sue scelte strutturali.</li>
</ul>

<p>Queste modifiche hanno trasformato l'output da un collage di informazioni a un documento strategico e coerente.</p>

<div class="key-takeaways-section">
    <h4 class="key-takeaways-title">📝 Key Takeaways del Capitolo:</h4>
    <div class="key-takeaways-content"><p class="takeaway-item">✓ <strong>L'Ultimo Miglio è il Più Importante:</strong> Non dare per scontato l'assemblaggio finale. Dedica un agente o un servizio specifico a trasformare gli asset in un prodotto finito.</p>
<p class="takeaway-item">✓ <strong>Assemblare è Creare:</strong> La fase di assemblaggio non è un'operazione meccanica, ma un processo creativo che richiede capacità di sintesi, narrazione e strutturazione.</p>
<p class="takeaway-item">✓ <strong>Guida il Ragionamento Narrativo:</strong> Quando chiedi a un'AI di assemblare informazioni, non limitarti a dire "metti insieme questo". Chiedigli di "creare una storia", di "costruire un'argomentazione", di "guidare il lettore verso una conclusione".</p>
    </div>
</div>

<p><strong>Conclusione del Capitolo</strong></p>

<p>Con l'introduzione dell'<code>DeliverableAssemblyAgent</code>, avevamo finalmente chiuso il cerchio della produzione. Il nostro sistema era ora in grado di gestire l'intero ciclo di vita di un'idea: dalla scomposizione di un obiettivo alla creazione di task, dall'esecuzione dei task alla raccolta di dati reali, dall'estrazione di asset di valore all'assemblaggio di un deliverable finale di alta qualità.</p>

<p>Il nostro team AI non era più solo un gruppo di lavoratori; era diventato una vera e propria <strong>fabbrica di conoscenza</strong>. Ma come faceva questa fabbrica a diventare più efficiente nel tempo? Era il momento di affrontare il pilastro più importante di tutti: la <strong>Memoria</strong>.</p>
            </div>

            
        </article>

        <!-- Bottom Navigation -->
        <nav class="chapter-nav-bottom">
            <a href="../quality-gate-human-loop/" class="nav-button secondary">← Capitolo Precedente</a>
            <a href="../sistema-memoria-agente-impara/" class="nav-button">Prossimo Capitolo →</a>
        </nav>
    </div>

    <!-- Mermaid.js for diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'base',
            themeVariables: {
                primaryColor: '#667eea',
                primaryTextColor: '#2c3e50',
                primaryBorderColor: '#667eea',
                lineColor: '#7f8c8d',
                secondaryColor: '#f8f9fa',
                tertiaryColor: '#ffffff'
            }
        });
    </script>

    <!-- Prism.js for code highlighting -->
    <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

    <!-- Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-VEGK4VZMG0"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-VEGK4VZMG0');
        
        gtag('event', 'chapter_start', {
            'chapter_title': 'L'Assemblaggio Finale – Il Test dell'Ultimo Miglio',
            'movement': 'esecuzione-qualita',
            'chapter_number': 13
        });
    </script>
    <script src="../../shared-reader-tools.js"></script>
</body>
    
    <script>
        // Reading Progress
        function updateReadingProgress() {
            const article = document.querySelector('.chapter-content');
            const progress = document.getElementById('readingProgress');
            
            if (article && progress) {
                const articleTop = article.offsetTop;
                const articleHeight = article.offsetHeight;
                const windowTop = window.pageYOffset;
                const windowHeight = window.innerHeight;
                
                const articleBottom = articleTop + articleHeight;
                const windowBottom = windowTop + windowHeight;
                
                let progressPercentage = 0;
                
                if (windowTop >= articleTop && windowTop <= articleBottom) {
                    progressPercentage = ((windowTop - articleTop) / articleHeight) * 100;
                } else if (windowBottom >= articleBottom) {
                    progressPercentage = 100;
                }
                
                progress.style.transform = `scaleX(${Math.min(progressPercentage / 100, 1)})`;
            }
        }
        
        window.addEventListener('scroll', updateReadingProgress);
        window.addEventListener('load', updateReadingProgress);
        
        // Font Size Controls
        let currentFontSize = 1.1;
        
        function increaseFontSize() {
            currentFontSize = Math.min(currentFontSize + 0.1, 2.0);
            applyFontSize();
        }
        
        function decreaseFontSize() {
            currentFontSize = Math.max(currentFontSize - 0.1, 0.8);
            applyFontSize();
        }
        
        function applyFontSize() {
            const content = document.querySelector('.chapter-content');
            if (content) {
                const paragraphs = content.querySelectorAll('p, li');
                paragraphs.forEach(p => {
                    p.style.fontSize = currentFontSize + 'rem';
                });
            }
            localStorage.setItem('fontSize', currentFontSize.toString());
        }
        
        // Theme Toggle
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDark.toString());
            showToast(isDark ? 'Modalità scura attivata' : 'Modalità chiara attivata');
        }
        
        // Bookmarks
        function toggleBookmarks() {
            const modal = document.getElementById('bookmarksModal');
            modal.style.display = modal.style.display === 'flex' ? 'none' : 'flex';
            loadBookmarks();
        }
        
        function closeBookmarksModal() {
            document.getElementById('bookmarksModal').style.display = 'none';
        }
        
        function addBookmark() {
            const title = document.querySelector('.chapter-title').textContent;
            const url = window.location.href;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');
            
            // Check if bookmark already exists
            const exists = bookmarks.find(b => b.url === url);
            if (exists) {
                showToast('Segnalibro rimosso!');
                bookmarks = bookmarks.filter(b => b.url !== url);
            } else {
                showToast('Segnalibro salvato!');
                bookmarks.push({
                    title: title,
                    url: url,
                    timestamp: new Date().toISOString()
                });
            }
            
            localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
        }
        
        function loadBookmarks() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');
            const container = document.getElementById('bookmarksList');
            
            if (bookmarks.length === 0) {
                container.innerHTML = '<p>Nessun segnalibro salvato.</p>';
                return;
            }
            
            container.innerHTML = bookmarks
                .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                .map(bookmark => `
                    <div class="bookmark-item">
                        <a href="${bookmark.url}" class="bookmark-link">${bookmark.title}</a>
                    </div>
                `).join('');
        }
        
        // Toast Notifications
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 2000);
        }
        
        // Load saved preferences
        window.addEventListener('load', function() {
            // Load font size
            const savedFontSize = localStorage.getItem('fontSize');
            if (savedFontSize) {
                currentFontSize = parseFloat(savedFontSize);
                applyFontSize();
            }
            
            // Load theme
            const isDark = localStorage.getItem('darkMode') === 'true';
            if (isDark) {
                document.body.classList.add('dark-mode');
            }
        });
    </script>
</html>