<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Il Ciclo di Miglioramento – L'Auto-Correzione in Azione | Esecuzione Qualita | AI Team Orchestrator</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Capitolo 15 del libro AI Team Orchestrator: Il Ciclo di Miglioramento – L'Auto-Correzione in Azione">
    <meta name="keywords" content="AI agents, sistema AI-driven, architettura AI, OpenAI SDK, team AI">
    <meta name="author" content="Daniele Pelleri">
    <meta name="robots" content="index, follow">

    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🤖</text></svg>">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Il Ciclo di Miglioramento – L'Auto-Correzione in Azione">
    <meta property="og:description" content="Capitolo 15 del libro AI Team Orchestrator: Il Ciclo di Miglioramento – L'Auto-Correzione in Azione">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://books.danielepelleri.com/it/esecuzione-qualita/ciclo-miglioramento-auto-correzione/">
    
    <!-- Canonical -->
    <link rel="canonical" href="https://books.danielepelleri.com/it/esecuzione-qualita/ciclo-miglioramento-auto-correzione/">
    <link rel="alternate" hreflang="en" href="https://books.danielepelleri.com/en/execution-quality/ciclo-miglioramento-auto-correzione/">
    <link rel="alternate" hreflang="it" href="https://books.danielepelleri.com/it/esecuzione-qualita/ciclo-miglioramento-auto-correzione/">
    
    <style>
        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #2c3e50;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        /* Breadcrumb Navigation */
        .breadcrumb {
            background: rgba(255, 255, 255, 0.9);
            padding: 1rem 2rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
        }
        
        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
        }
        
        .breadcrumb a:hover {
            text-decoration: underline;
        }
        
        .breadcrumb span {
            color: #7f8c8d;
            margin: 0 0.5rem;
        }
        
        /* Chapter Header */
        .chapter-header {
            background: white;
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            margin-bottom: 3rem;
            text-align: center;
        }
        
        .chapter-instrument {
            font-size: 4rem;
            margin-bottom: 1rem;
        }
        
        .chapter-meta {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            color: #7f8c8d;
            flex-wrap: wrap;
        }
        
        .chapter-title {
            font-size: 2.5rem;
            color: #2c3e50;
            margin-bottom: 1rem;
            font-weight: 700;
            line-height: 1.2;
        }
        
        /* Content Styles */
        .chapter-content {
            background: white;
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            margin-bottom: 3rem;
        }
        
        .chapter-content h3 {
            font-size: 2rem;
            color: #2c3e50;
            margin: 2rem 0 1rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 0.5rem;
        }
        
        .chapter-content h4 {
            font-size: 1.5rem;
            color: #495057;
            margin: 1.5rem 0 1rem;
        }
        
        .chapter-content p {
            margin-bottom: 1.5rem;
            font-size: 1.1rem;
            line-height: 1.8;
        }
        
        .chapter-content ul, .chapter-content ol {
            margin: 1.5rem 0;
            padding-left: 2rem;
        }
        
        .chapter-content li {
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
            line-height: 1.6;
        }
        
        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin: 2rem 0;
        }
        
        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }
        
        th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
        }
        
        /* Code Styles */
        pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1.5rem 0;
            font-size: 0.9rem;
        }
        
        code {
            background: #f1f3f4;
            color: #d73a49;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        }
        
        pre code {
            background: transparent;
            color: inherit;
            padding: 0;
        }
        
        /* Special Boxes */
        .war-story, .industry-insight, .architecture-section, .key-takeaways-section {
            border-radius: 10px;
            padding: 2rem;
            margin: 2rem 0;
        }
        
        .war-story {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border-left: 4px solid #856404;
        }
        
        .industry-insight {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-left: 4px solid #28a745;
        }
        
        .architecture-section {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 1px solid #dee2e6;
        }
        
        .key-takeaways-section {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
        }
        
        /* Mermaid Container */
        .mermaid {
            background: #f8f9fa;
            padding: 2rem;
            border-radius: 10px;
            margin: 2rem 0;
            text-align: center;
        }
        
        /* Navigation */
        .chapter-nav-bottom {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 3rem 0;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .nav-button {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem 2rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            text-decoration: none;
            border-radius: 50px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }
        
        .nav-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.6);
        }
        
        .nav-button.secondary {
            background: rgba(255, 255, 255, 0.9);
            color: #667eea;
            border: 2px solid #667eea;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .nav-button.secondary:hover {
            background: white;
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }
        
        /* War Story Icon Styling */
        .war-story-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .war-story-icon {
            width: 1.5rem;
            height: 1.5rem;
            flex-shrink: 0;
            color: #856404;
        }
        
        /* Architecture Section Styling */
        .architecture-title {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .architecture-icon {
            width: 2rem;
            height: 2rem;
            flex-shrink: 0;
            color: #667eea;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .chapter-header,
            .chapter-content {
                padding: 2rem;
            }
            
            .chapter-title {
                font-size: 2rem;
            }
            
            .chapter-nav-bottom {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
        
    <style>
        /* Reader Tools */
        .reader-tools {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .tool-button {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .tool-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        
        /* Bookmark Modal */
        .bookmarks-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 70vh;
            overflow-y: auto;
            position: relative;
        }
        
        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
        }
        
        .close-modal:hover {
            color: #333;
        }
        
        .bookmark-item {
            padding: 0.5rem 0;
            border-bottom: 1px solid #eee;
        }
        
        .bookmark-item:last-child {
            border-bottom: none;
        }
        
        .bookmark-link {
            color: #667eea;
            text-decoration: none;
        }
        
        .bookmark-link:hover {
            text-decoration: underline;
        }
        
        /* Reading Progress Bar */
        .reading-progress {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: rgba(102, 126, 234, 0.2);
            z-index: 999;
        }
        
        .reading-progress::before {
            content: '';
            display: block;
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transform-origin: left;
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }
        
        /* Dark Mode */
        body.dark-mode {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: #ecf0f1;
        }
        
        body.dark-mode .chapter-header,
        body.dark-mode .chapter-content,
        body.dark-mode .breadcrumb {
            background: rgba(52, 73, 94, 0.8);
            color: #ecf0f1;
        }
        
        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 1rem 2rem;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 10001;
        }
        
        .toast.show {
            transform: translateX(0);
        }
    </style>
</head>
<body>
    <!-- Reading Progress Bar -->
    <div class="reading-progress" id="readingProgress"></div>
    
    <!-- Reader Tools -->
    <div class="reader-tools">
        <button class="tool-button" onclick="addBookmark()" title="I Miei Segnalibri">📚</button>
        <button class="tool-button" onclick="toggleTheme()" title="Tema">🎨</button>
        <button class="tool-button" onclick="increaseFontSize()" title="Dimensione Font +">A+</button>
        <button class="tool-button" onclick="decreaseFontSize()" title="Dimensione Font -">A-</button>
    </div>
    
    <!-- Bookmark Modal -->
    <div id="bookmarksModal" class="bookmarks-modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeBookmarksModal()">&times;</span>
            <h3>📚 I Miei Segnalibri</h3>
            <div id="bookmarksList">
                <!-- Bookmarks will be populated by JavaScript -->
            </div>
        </div>
    </div>    <div class="container">
        <!-- Breadcrumb -->
        <nav class="breadcrumb">
            <a href="../../ai-team-orchestrator.html">🏠 AI Team Orchestrator</a>
            <span>›</span>
            <a href="../">🎺 Esecuzione Qualita</a>
            <span>›</span>
            <span>Il Ciclo di Miglioramento – L'Auto-Correzione in Azione</span>
        </nav>

        <!-- Chapter Header -->
        <header class="chapter-header">
            <div class="chapter-instrument">🎺</div>
            <div class="chapter-meta">
                <span>🎺 Movimento 2 di 4</span>
                <span>📖 Capitolo 15 di 42</span>
                <span>⏱️ ~5 min lettura</span>
                <span>📊 Livello: Intermedio</span>
            </div>
            <h1 class="chapter-title">Il Ciclo di Miglioramento – L'Auto-Correzione in Azione</h1>
        </header>

        <!-- Main Content -->
        <article class="chapter-content">
<p>Il nostro sistema era diventato un eccellente studente. Grazie al <code>WorkspaceMemory</code>, imparava da ogni successo e da ogni fallimento, accumulando una conoscenza strategica di valore inestimabile. Ma c'era ancora un anello mancante nel ciclo di feedback: <strong>l'azione</strong>.</p>

<p>Il sistema era come un consulente brillante che scriveva report perfetti su cosa non andava, ma poi li lasciava su una scrivania a prendere polvere. Rilevava i problemi, memorizzava le lezioni, ma non agiva in autonomia per correggere la rotta.</p>

<p>Per realizzare la nostra visione di un sistema veramente autonomo, dovevamo implementare il <strong>Pilastro #13 (Course-Correction Automatico)</strong>. Dovevamo dare al sistema non solo la capacità di <em>sapere</em> cosa fare, ma anche il <em>potere</em> di farlo.</p>

<h3>La Decisione Architetturale: Un "Sistema Nervoso" Proattivo</h3>

<p>Abbiamo progettato il nostro sistema di auto-correzione non come un processo separato, ma come un "riflesso" automatico integrato nel cuore dell'Executor. L'idea era che, a intervalli regolari e dopo eventi significativi (come il completamento di un task), il sistema dovesse fermarsi un istante per "riflettere" e, se necessario, correggere la propria strategia.</p>

<p>Abbiamo creato un nuovo componente, il <code>GoalValidator</code>, il cui scopo non era solo validare la qualità, ma confrontare lo stato attuale del progetto con gli obiettivi finali.</p>

<p><em>Codice di riferimento: <code>backend/ai_quality_assurance/goal_validator.py</code></em></p>

<p><strong>Flusso di Auto-Correzione:</strong></p>

<div class="architecture-section">
    <div class="architecture-title">
        <svg class="architecture-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
            <line x1="9" y1="9" x2="15" y2="9"/>
            <line x1="9" y1="12" x2="15" y2="12"/>
            <line x1="9" y1="15" x2="15" y2="15"/>
        </svg>
        <h4>Architettura del Sistema</h4>
    </div>
    
    <div class="mermaid">
        graph TD
            A[Evento Trigger:<br/>Task Completato o Timer Periodico] --> B{GoalValidator si attiva}
            B --> C[Analisi del Gap:<br/>Confronta Stato Attuale vs. Obiettivi]
            C -->|Nessun Gap Rilevante| D[Continua Operazioni Normali]
            C -->|Gap Critico Rilevato| E{Consultazione Memoria}
            E -->|Cerca Failure Lessons Correlate| F{Generazione Piano Correttivo}
            F -->|L'AI definisce nuovi task| G[Creazione Task Correttivi]
            G -->|Priorità CRITICAL| H{Aggiunti alla Coda dell'Executor}
            H --> D
    </div>
</div>

<h3>"War Story": Il Validatore che Gridava "Al Lupo!"</h3>

<p>La nostra prima implementazione del <code>GoalValidator</code> era troppo sensibile.</p>

<p><em>Logbook del Disastro (28 Luglio):</em></p>

<pre><code class="language-text">CRITICAL goal validation failures: 4 issues
⚠️ GOAL SHORTFALL: 0/50.0 contatti for contacts (100.0% gap, missing 50.0)
INFO: Creating corrective task: &quot;URGENTE: Raccogliere 50.0 contatti mancanti&quot;
... (5 minuti dopo)
CRITICAL goal validation failures: 4 issues
⚠️ GOAL SHORTFALL: 0/50.0 contatti for contacts (100.0% gap, missing 50.0)
INFO: Creating corrective task: &quot;URGENTE: Raccogliere 50.0 contatti mancanti&quot;</code></pre>

<p>Il sistema era entrato in un <strong>ciclo di panico</strong>. Rilevava un gap, creava un task correttivo, ma prima ancora che l'Executor potesse assegnare ed eseguire quel task, il validatore ripartiva, rilevava lo stesso gap e creava un <em>altro</em> task correttivo identico. In poche ore, la nostra coda di task era inondata di centinaia di task duplicati.</p>

<p><strong>La Lezione Appresa: L'Auto-Correzione ha Bisogno di "Pazienza" e "Consapevolezza"</strong></p>

<p>Un sistema proattivo senza consapevolezza dello stato delle sue stesse azioni correttive crea più problemi di quanti ne risolva. La soluzione ha richiesto di rendere il nostro <code>GoalValidator</code> più intelligente e "paziente".</p>

<ol>
<li><strong>Controllo dei Task Correttivi Esistenti:</strong> Prima di creare un nuovo task correttivo, il validatore ora controlla se esiste già un task <code>pending</code> o <code>in_progress</code> che sta cercando di risolvere lo stesso gap. Se esiste, non fa nulla.</li>
</ol>

<ol>
<li><strong>Cooldown Period:</strong> Dopo aver creato un task correttivo, il sistema entra in un "periodo di grazia" (es. 30 minuti) per quel goal specifico, durante il quale non vengono generate nuove azioni correttive, dando al team di agenti il tempo di agire.</li>
</ol>

<ol>
<li><strong>Priorità e Urgenza AI-Driven:</strong> Invece di creare sempre task "URGENTI", abbiamo insegnato all'AI a valutare la gravità del gap in relazione alla timeline del progetto. Un gap del 10% a inizio progetto potrebbe generare un task a priorità media; lo stesso gap a un giorno dalla scadenza genererebbe un task a priorità critica.</li>
</ol>

<h3>Il Prompt che Guida la Correzione</h3>

<p>Il cuore di questo sistema è il prompt che genera i task correttivi. Non si limita a dire "risolvi il problema", ma chiede una mini-analisi strategica.</p>

<p><em>Codice di riferimento: Logica <code>_generate_corrective_task</code> in <code>goal_validator.py</code></em></p>

<pre><code class="language-python">prompt = f&quot;&quot;&quot;
Sei un Project Manager esperto in crisis management. È stato rilevato un gap critico tra lo stato attuale del progetto e gli obiettivi prefissati.

**Obiettivo Fallito:** {goal.description}
**Stato Attuale:** {current_progress}
**Gap Rilevato:** {failure_details}

**Lezioni dal Passato (dalla Memoria):**
{relevant_failure_lessons}

**Analisi Richiesta:**
1.  **Root Cause Analysis:** Basandoti sulle lezioni passate e sul gap, qual è la causa più probabile di questo fallimento? (es. &quot;I task erano troppo teorici&quot;, &quot;Mancava un tool di verifica email&quot;).
2.  **Azione Correttiva Specifica:** Definisci UN SINGOLO task, il più specifico e azionabile possibile, per iniziare a colmare questo gap. Non essere generico.
3.  **Assegnazione Ottimale:** Quale ruolo del team è più adatto a risolvere questo problema?

**Output Format (JSON only):**
{{
  &quot;root_cause&quot;: &quot;La causa principale del fallimento.&quot;,
  &quot;corrective_task&quot;: {{
    &quot;name&quot;: &quot;Nome del task correttivo (es. &#x27;Verifica Email di 50 Contatti Esistenti&#x27;)&quot;,
    &quot;description&quot;: &quot;Descrizione dettagliata del task e del risultato atteso.&quot;,
    &quot;assigned_to_role&quot;: &quot;Ruolo Specializzato&quot;,
    &quot;priority&quot;: &quot;high&quot;
  }}
}}
&quot;&quot;&quot;</code></pre>

<p>Questo prompt non solo risolve il problema, ma lo fa in modo intelligente, imparando dal passato e delegando al ruolo giusto, chiudendo perfettamente il ciclo di feedback.</p>

<div class="key-takeaways-section">
    <h4 class="key-takeaways-title">📝 Key Takeaways del Capitolo:</h4>
    <div class="key-takeaways-content"><p class="takeaway-item">✓ <strong>La Rilevazione non Basta, Serve l'Azione:</strong> Un sistema autonomo non si limita a identificare i problemi, ma deve essere in grado di generare e prioritizzare azioni per risolverli.</p>
<p class="takeaway-item">✓ <strong>L'Autonomia Richiede Consapevolezza di Sé:</strong> Un sistema di auto-correzione deve essere consapevole delle azioni che ha già intrapreso per evitare di entrare in cicli di panico e creare lavoro duplicato.</p>
<p class="takeaway-item">✓ <strong>Usa la Memoria per Guidare la Correzione:</strong> Le migliori azioni correttive sono quelle informate dagli errori del passato. Integra strettamente il tuo sistema di validazione con il tuo sistema di memoria.</p>
    </div>
</div>

<p><strong>Conclusione del Capitolo</strong></p>

<p>Con l'implementazione del sistema di auto-correzione, il nostro team AI aveva sviluppato un "sistema nervoso". Ora poteva percepire quando qualcosa non andava e reagire in modo proattivo e intelligente.</p>

<p>Avevamo un sistema che pianificava, eseguiva, collaborava, produceva risultati di qualità, imparava e si auto-correggeva. Era quasi completo. L'ultima grande sfida era di natura diversa: come potevamo essere sicuri che un sistema così complesso fosse stabile e affidabile nel tempo? Questo ci ha portato a sviluppare un robusto sistema di <strong>Monitoraggio e Test di Integrità</strong>.</p>
            </div>

            
        </article>

        <!-- Bottom Navigation -->
        <nav class="chapter-nav-bottom">
            <a href="../sistema-memoria-agente-impara/" class="nav-button secondary">← Capitolo Precedente</a>
            <a href="../monitoraggio-autonomo-controllo/" class="nav-button">Prossimo Capitolo →</a>
        </nav>
    </div>

    <!-- Mermaid.js for diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'base',
            themeVariables: {
                primaryColor: '#667eea',
                primaryTextColor: '#2c3e50',
                primaryBorderColor: '#667eea',
                lineColor: '#7f8c8d',
                secondaryColor: '#f8f9fa',
                tertiaryColor: '#ffffff'
            }
        });
    </script>

    <!-- Prism.js for code highlighting -->
    <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

    <!-- Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-VEGK4VZMG0"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-VEGK4VZMG0');
        
        gtag('event', 'chapter_start', {
            'chapter_title': 'Il Ciclo di Miglioramento – L'Auto-Correzione in Azione',
            'movement': 'esecuzione-qualita',
            'chapter_number': 15
        });
    </script>
    <script src="../../shared-reader-tools.js"></script>
</body>
    
    <script>
        // Reading Progress
        function updateReadingProgress() {
            const article = document.querySelector('.chapter-content');
            const progress = document.getElementById('readingProgress');
            
            if (article && progress) {
                const articleTop = article.offsetTop;
                const articleHeight = article.offsetHeight;
                const windowTop = window.pageYOffset;
                const windowHeight = window.innerHeight;
                
                const articleBottom = articleTop + articleHeight;
                const windowBottom = windowTop + windowHeight;
                
                let progressPercentage = 0;
                
                if (windowTop >= articleTop && windowTop <= articleBottom) {
                    progressPercentage = ((windowTop - articleTop) / articleHeight) * 100;
                } else if (windowBottom >= articleBottom) {
                    progressPercentage = 100;
                }
                
                progress.style.transform = `scaleX(${Math.min(progressPercentage / 100, 1)})`;
            }
        }
        
        window.addEventListener('scroll', updateReadingProgress);
        window.addEventListener('load', updateReadingProgress);
        
        // Font Size Controls
        let currentFontSize = 1.1;
        
        function increaseFontSize() {
            currentFontSize = Math.min(currentFontSize + 0.1, 2.0);
            applyFontSize();
        }
        
        function decreaseFontSize() {
            currentFontSize = Math.max(currentFontSize - 0.1, 0.8);
            applyFontSize();
        }
        
        function applyFontSize() {
            const content = document.querySelector('.chapter-content');
            if (content) {
                const paragraphs = content.querySelectorAll('p, li');
                paragraphs.forEach(p => {
                    p.style.fontSize = currentFontSize + 'rem';
                });
            }
            localStorage.setItem('fontSize', currentFontSize.toString());
        }
        
        // Theme Toggle
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDark.toString());
            showToast(isDark ? 'Modalità scura attivata' : 'Modalità chiara attivata');
        }
        
        // Bookmarks
        function toggleBookmarks() {
            const modal = document.getElementById('bookmarksModal');
            modal.style.display = modal.style.display === 'flex' ? 'none' : 'flex';
            loadBookmarks();
        }
        
        function closeBookmarksModal() {
            document.getElementById('bookmarksModal').style.display = 'none';
        }
        
        function addBookmark() {
            const title = document.querySelector('.chapter-title').textContent;
            const url = window.location.href;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');
            
            // Check if bookmark already exists
            const exists = bookmarks.find(b => b.url === url);
            if (exists) {
                showToast('Segnalibro rimosso!');
                bookmarks = bookmarks.filter(b => b.url !== url);
            } else {
                showToast('Segnalibro salvato!');
                bookmarks.push({
                    title: title,
                    url: url,
                    timestamp: new Date().toISOString()
                });
            }
            
            localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
        }
        
        function loadBookmarks() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');
            const container = document.getElementById('bookmarksList');
            
            if (bookmarks.length === 0) {
                container.innerHTML = '<p>Nessun segnalibro salvato.</p>';
                return;
            }
            
            container.innerHTML = bookmarks
                .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                .map(bookmark => `
                    <div class="bookmark-item">
                        <a href="${bookmark.url}" class="bookmark-link">${bookmark.title}</a>
                    </div>
                `).join('');
        }
        
        // Toast Notifications
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 2000);
        }
        
        // Load saved preferences
        window.addEventListener('load', function() {
            // Load font size
            const savedFontSize = localStorage.getItem('fontSize');
            if (savedFontSize) {
                currentFontSize = parseFloat(savedFontSize);
                applyFontSize();
            }
            
            // Load theme
            const isDark = localStorage.getItem('darkMode') === 'true';
            if (isDark) {
                document.body.classList.add('dark-mode');
            }
        });
    </script>
</html>