<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tool Testing - Anchoring AI to Reality | Core Philosophy Architecture | AI Team Orchestrator</title>
    <meta name="description" content="Chapter 10 of AI Team Orchestrator: Tool Testing - Anchoring AI to Reality">
    <meta name="robots" content="index, follow">
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #2c3e50;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 2rem;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }
        
        .chapter-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .chapter-instrument {
            font-size: 4rem;
            margin-bottom: 1rem;
        }
        
        .chapter-meta {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            color: #7f8c8d;
            flex-wrap: wrap;
        }
        
        .chapter-title {
            font-size: 2.5rem;
            color: #2c3e50;
            margin-bottom: 2rem;
            font-weight: 700;
            line-height: 1.2;
        }
        
        .coming-soon {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 4rem 2rem;
            border-radius: 15px;
            text-align: center;
            margin: 2rem 0;
        }
        
        .nav-button {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem 2rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            text-decoration: none;
            border-radius: 50px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 1rem 0.5rem;
        }
        
        .nav-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.6);
        }
        /* Reader Tools */
        .reader-tools {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
            transition: all 0.3s ease;
            min-width: 60px;
        }
        
        .reader-tools.collapsed {
            width: 60px;
            padding: 0.8rem;
        }
        
        .reader-tool {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.6rem;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s ease;
            color: #495057;
            font-size: 0.85rem;
            white-space: nowrap;
        }
        
        .reader-tool:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }
        
        .reader-tool.active {
            background: #667eea;
            color: white;
        }
        
        .reader-tool-icon {
            font-size: 1.1rem;
            flex-shrink: 0;
        }
        
        .reader-tool-label {
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .collapsed .reader-tool-label {
            display: none;
        }
        
        .reader-tools-toggle {
            position: absolute;
            top: -10px;
            left: -10px;
            width: 30px;
            height: 30px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        /* Language Switcher */
        .language-switcher {
            display: flex;
            background: rgba(0,0,0,0.1);
            border-radius: 6px;
            overflow: hidden;
        }
        
        .language-option {
            padding: 0.3rem 0.6rem;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 0.7rem;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.2s ease;
        }
        
        .language-option.active {
            background: #667eea;
            color: white;
        }
        
        /* Reading Progress */
        .reading-progress {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: rgba(102, 126, 234, 0.2);
            z-index: 1001;
        }
        
        .reading-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        /* Dark Mode */
        body.dark-mode {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e9ecef;
        }
        
        .dark-mode .container {
            color: #e9ecef;
        }
        
        .dark-mode .chapter-header,
        .dark-mode .chapter-content {
            background: rgba(255, 255, 255, 0.05);
            color: #e9ecef;
        }
        
        .dark-mode .breadcrumb {
            background: rgba(255, 255, 255, 0.1);
            color: #e9ecef;
        }
        
        .dark-mode .reader-tools {
            background: rgba(0, 0, 0, 0.8);
            color: #e9ecef;
        }
        
        .dark-mode .reader-tool {
            color: #e9ecef;
        }
        
        .dark-mode .reader-tool:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        
        /* Dark Mode - Headings and Titles */
        .dark-mode .chapter-title,
        .dark-mode .chapter-content h3,
        .dark-mode .chapter-content h4,
        .dark-mode .chapter-content h5 {
            color: #e9ecef !important;
        }
        
        .dark-mode .chapter-content p,
        .dark-mode .chapter-content li,
        .dark-mode .chapter-content strong {
            color: #e9ecef;
        }
        
        .dark-mode .takeaway-item {
            color: #e9ecef;
        }
        
        /* Dark Mode - Tables */
        .dark-mode table {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .dark-mode th,
        .dark-mode td {
            color: #e9ecef;
            border-bottom-color: rgba(255, 255, 255, 0.1);
        }
        
        .dark-mode th {
            background: rgba(255, 255, 255, 0.1);
        }
        
        /* Navigation Container Fix */
        .chapter-nav-bottom {
            max-width: 900px;
            box-sizing: border-box;
            margin: 3rem auto 2rem auto;
            padding: 0 2rem;
            position: relative;
        }
        /* Responsive */
        @media (max-width: 768px) {
            .reader-tools {
                right: 10px;
                padding: 0.8rem;
                min-width: 50px;
            }
            
            .reader-tools.collapsed {
                width: 50px;
                padding: 0.6rem;
            }
            
            .reader-tool {
                padding: 0.5rem;
            }
            
            .reader-tool-label {
                font-size: 0.75rem;
            }
        }

        /* Fixed Bookmark Toast */
        .bookmark-toast {
            position: fixed;
            top: 80px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 0.8rem 1.2rem;
            border-radius: 8px;
            z-index: 1002;
            transform: translateX(350px);
            opacity: 0;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
            pointer-events: none;
        }
        
        .bookmark-toast.show {
            transform: translateX(0);
            opacity: 1;
            pointer-events: auto;
        }
        
        .bookmark-toast.error {
            background: #dc3545;
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
        }

        /* Dark Mode - Content Areas */
        .dark-mode .content-area {
            background: rgba(255, 255, 255, 0.05);
            color: #e9ecef;
        }
        
        .dark-mode .content-area h2,
        .dark-mode .content-area h3,
        .dark-mode .content-area h4 {
            color: #e9ecef;
        }
        
        .dark-mode .content-area p,
        .dark-mode .content-area li {
            color: #e9ecef;
        }
        
        .dark-mode .content-area strong {
            color: #e9ecef;
        }
        
        /* Dark Mode - Tables */
        .dark-mode table {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .dark-mode th,
        .dark-mode td {
            color: #e9ecef;
            border-bottom-color: rgba(255, 255, 255, 0.1);
        }
        
        .dark-mode th {
            background: rgba(255, 255, 255, 0.1);
        }
        
        /* Dark Mode - Takeaways and Boxes */
        .dark-mode .key-takeaways,
        .dark-mode .insight-box,
        .dark-mode .war-story {
            background: rgba(255, 255, 255, 0.05);
            color: #e9ecef;
        }
        
        .dark-mode .key-takeaways h3,
        .dark-mode .insight-box h3,
        .dark-mode .war-story h3 {
            color: #e9ecef;
        }
        
        .dark-mode .key-takeaways p,
        .dark-mode .insight-box p,
        .dark-mode .war-story p {
            color: #e9ecef;
        }
        
        .dark-mode .key-takeaways li,
        .dark-mode .insight-box li,
        .dark-mode .war-story li {
            color: #e9ecef;
        }
    
        /* Architecture Icon Styling */
        .architecture-icon {
            width: 24px;
            height: 24px;
            margin-right: 12px;
            flex-shrink: 0;
        }
        
        
        /* War Story Icon Styling */
        .war-story-icon {
            width: 24px;
            height: 24px;
            margin-right: 12px;
            flex-shrink: 0;
        }
        
        /* Insight Icon Styling */
        .insight-icon {
            width: 24px;
            height: 24px;
            margin-right: 12px;
            flex-shrink: 0;
        }

        /* Architecture Section Styling */
        .architecture-section {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 2rem;
            margin: 2rem 0;
        }
        
        .architecture-title {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
            font-weight: 600;
            color: #495057;
        }
        
        .architecture-title h4 {
            margin: 0;
            color: #495057;
        }
        
        /* War Story Styling */
        .war-story {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border-left: 4px solid #856404;
            border-radius: 10px;
            padding: 2rem;
            margin: 2rem 0;
        }
        
        .war-story h4 {
            color: #856404;
            margin-top: 0;
        }
        
        /* Key Takeaways Styling */
        .key-takeaways-section {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border-radius: 10px;
            padding: 2rem;
            margin: 2rem 0;
        }
        
        .key-takeaways-title {
            margin-bottom: 1rem;
            font-weight: 600;
        }
        
        .key-takeaways-content {
            line-height: 1.6;
        }
        
        .takeaway-item {
            margin-bottom: 0.5rem;
        }
        
        /* Industry Insight Styling */
        .industry-insight {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-left: 4px solid #28a745;
            border-radius: 10px;
            padding: 2rem;
            margin: 2rem 0;
        }
        
        .industry-insight h4 {
            color: #28a745;
            margin-top: 0;
        }
        
        /* Mermaid Container */
        .mermaid {
            background: #f8f9fa;
            padding: 2rem;
            border-radius: 10px;
            margin: 2rem 0;
            text-align: center;
        }
    
        .architecture-section,
        .mermaid,
        .war-story,
        .key-takeaways-section,
        .industry-insight {
            max-width: 100%;
            box-sizing: border-box;
            overflow-x: auto;
        }
        
        .mermaid svg {
            max-width: 100%;
            height: auto;
        }
    </style>

    <style>
    .contextual-link {
        color: #667eea;
        text-decoration: none;
        font-weight: 500;
        border-bottom: 1px dotted #667eea;
        transition: all 0.2s ease;
    }
    
    .contextual-link:hover {
        color: #5a6fd8;
        border-bottom-style: solid;
    }
    
    .dark-mode .contextual-link {
        color: #9bb5ff;
        border-bottom-color: #9bb5ff;
    }
    </style>
        <style>

/* ========================================
   NARRATIVE LINKING SYSTEM STYLES
   ======================================== */

/* Contextual Links */
.contextual-link  {
    color: #3b82f6;
    text-decoration: none;
    border-bottom: 1px solid rgba(59, 130, 246, 0.3);
    transition: all 0.2s ease;
    padding-bottom: 1px;
}

.contextual-link:hover {
    color: #1d4ed8;
    border-bottom-color: #1d4ed8;
    background: rgba(59, 130, 246, 0.05);
    padding: 2px 4px;
    margin: -2px -4px;
    border-radius: 3px;
}

/* Narrative Callouts */
.narrative-callout {
    margin: 2rem 0;
    padding: 1.5rem;
    border-radius: 12px;
    border: 1px solid #e5e7eb;
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

.narrative-callout.next-step {
    border-left: 4px solid #10b981;
    background: linear-gradient(135deg, #ecfdf5 0%, #f0fdf4 100%);
}

.narrative-callout.evolution {
    border-left: 4px solid #f59e0b;
    background: linear-gradient(135deg, #fffbeb 0%, #fefce8 100%);
}

.callout-header {
    display: flex;
    align-items: center;
    margin-bottom: 0.75rem;
}

.callout-icon {
    font-size: 1.25rem;
    margin-right: 0.5rem;
}

.callout-header h4 {
    margin: 0;
    font-size: 1.1rem;
    font-weight: 600;
    color: #1f2937;
}

.narrative-link {
    color: #059669;
    text-decoration: none;
    font-weight: 500;
    border-bottom: 2px solid rgba(5, 150, 105, 0.2);
    transition: all 0.2s ease;
}

.narrative-link:hover {
    color: #047857;
    border-bottom-color: #047857;
    background: rgba(5, 150, 105, 0.1);
    padding: 2px 4px;
    margin: -2px -4px;
    border-radius: 4px;
}

.callout-meta {
    display: flex;
    gap: 1rem;
    margin-top: 1rem;
    font-size: 0.875rem;
    color: #6b7280;
}

/* Journey Progress */
.journey-progress {
    margin-top: 1rem;
}

.progress-bar {
    width: 100%;
    height: 4px;
    background: rgba(249, 115, 22, 0.2);
    border-radius: 2px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #f97316 0%, #ea580c 100%);
    border-radius: 2px;
    transition: width 0.3s ease;
}

.progress-text {
    display: block;
    margin-top: 0.5rem;
    font-size: 0.8rem;
    color: #9ca3af;
}

/* Related Chapters */
.related-chapters {
    margin: 2.5rem 0;
    padding: 2rem;
    background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
    border-radius: 12px;
    border: 1px solid #e5e7eb;
}

.related-chapters h4 {
    margin: 0 0 1.5rem 0;
    font-size: 1.2rem;
    color: #1f2937;
    display: flex;
    align-items: center;
}

.related-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
}

.related-item {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: 1.25rem;
    background: white;
    border-radius: 8px;
    border: 1px solid #e5e7eb;
    transition: all 0.2s ease;
}

.related-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 16px -4px rgba(0, 0, 0, 0.1);
    border-color: #3b82f6;
}

.related-icon {
    font-size: 1.5rem;
    min-width: 2rem;
}

.related-content {
    flex: 1;
}

.related-link {
    color: #1f2937;
    text-decoration: none;
    font-weight: 600;
    transition: color 0.2s ease;
}

.related-link:hover {
    color: #3b82f6;
}

.related-desc {
    margin: 0.5rem 0;
    color: #6b7280;
    font-size: 0.9rem;
    line-height: 1.4;
}

.related-connection {
    font-size: 0.8rem;
    color: #9ca3af;
    font-style: italic;
}

/* Dark Mode Support */
.dark-mode .narrative-callout {
    background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
    border-color: #374151;
    color: #f9fafb;
}

.dark-mode .related-chapters {
    background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
    border-color: #374151;
}

.dark-mode .related-item {
    background: #1f2937;
    border-color: #374151;
}

.dark-mode .related-link {
    color: #f9fafb;
}

.dark-mode .related-link:hover {
    color: #60a5fa;
}

/* Responsive Design */
@media (max-width: 768px) {
    .narrative-callout {
        margin: 1.5rem 0;
        padding: 1.25rem;
    }
    
    .related-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
    
    .related-item {
        padding: 1rem;
    }
    
    .callout-meta {
        flex-direction: column;
        gap: 0.5rem;
    }
}
    </style>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,CiAgICA8c3ZnIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDMyIDMyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogICAgICAgIDxkZWZzPgogICAgICAgICAgICA8bGluZWFyR3JhZGllbnQgaWQ9ImdyYWQxIiB4MT0iMCUiIHkxPSIwJSIgeDI9IjEwMCUiIHkyPSIxMDAlIj4KICAgICAgICAgICAgICAgIDxzdG9wIG9mZnNldD0iMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiM2NjdlZWE7c3RvcC1vcGFjaXR5OjEiIC8+CiAgICAgICAgICAgICAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiM3NjRiYTI7c3RvcC1vcGFjaXR5OjEiIC8+CiAgICAgICAgICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgICAgICAgPC9kZWZzPgogICAgICAgIDwhLS0gQmFja2dyb3VuZCBjaXJjbGUgLS0+CiAgICAgICAgPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTUiIGZpbGw9InVybCgjZ3JhZDEpIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMiIvPgogICAgICAgIDwhLS0gQUkgQnJhaW4gaWNvbiAtLT4KICAgICAgICA8Y2lyY2xlIGN4PSIxNiIgY3k9IjEzIiByPSI4IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMiIvPgogICAgICAgIDxjaXJjbGUgY3g9IjEzIiBjeT0iMTEiIHI9IjEiIGZpbGw9IiNmZmYiLz4KICAgICAgICA8Y2lyY2xlIGN4PSIxOSIgY3k9IjExIiByPSIxIiBmaWxsPSIjZmZmIi8+CiAgICAgICAgPHBhdGggZD0iTTEyIDE1YzEgMiAzIDIgNCAyczMgMCA0LTIiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLXdpZHRoPSIxLjUiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgogICAgICAgIDwhLS0gVGVhbSBvcmNoZXN0cmF0aW9uIGxpbmVzIC0tPgogICAgICAgIDxwYXRoIGQ9Ik04IDI0TDE2IDIwTDI0IDI0IiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMiIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgICAgICAgPGNpcmNsZSBjeD0iOCIgY3k9IjI0IiByPSIyIiBmaWxsPSIjZmZmIi8+CiAgICAgICAgPGNpcmNsZSBjeD0iMTYiIGN5PSIyMCIgcj0iMiIgZmlsbD0iI2ZmZiIvPgogICAgICAgIDxjaXJjbGUgY3g9IjI0IiBjeT0iMjQiIHI9IjIiIGZpbGw9IiNmZmYiLz4KICAgIDwvc3ZnPgogICAg">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,CiAgICA8c3ZnIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDMyIDMyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogICAgICAgIDxkZWZzPgogICAgICAgICAgICA8bGluZWFyR3JhZGllbnQgaWQ9ImdyYWQxIiB4MT0iMCUiIHkxPSIwJSIgeDI9IjEwMCUiIHkyPSIxMDAlIj4KICAgICAgICAgICAgICAgIDxzdG9wIG9mZnNldD0iMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiM2NjdlZWE7c3RvcC1vcGFjaXR5OjEiIC8+CiAgICAgICAgICAgICAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiM3NjRiYTI7c3RvcC1vcGFjaXR5OjEiIC8+CiAgICAgICAgICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgICAgICAgPC9kZWZzPgogICAgICAgIDwhLS0gQmFja2dyb3VuZCBjaXJjbGUgLS0+CiAgICAgICAgPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTUiIGZpbGw9InVybCgjZ3JhZDEpIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMiIvPgogICAgICAgIDwhLS0gQUkgQnJhaW4gaWNvbiAtLT4KICAgICAgICA8Y2lyY2xlIGN4PSIxNiIgY3k9IjEzIiByPSI4IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMiIvPgogICAgICAgIDxjaXJjbGUgY3g9IjEzIiBjeT0iMTEiIHI9IjEiIGZpbGw9IiNmZmYiLz4KICAgICAgICA8Y2lyY2xlIGN4PSIxOSIgY3k9IjExIiByPSIxIiBmaWxsPSIjZmZmIi8+CiAgICAgICAgPHBhdGggZD0iTTEyIDE1YzEgMiAzIDIgNCAyczMgMCA0LTIiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLXdpZHRoPSIxLjUiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgogICAgICAgIDwhLS0gVGVhbSBvcmNoZXN0cmF0aW9uIGxpbmVzIC0tPgogICAgICAgIDxwYXRoIGQ9Ik04IDI0TDE2IDIwTDI0IDI0IiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMiIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgICAgICAgPGNpcmNsZSBjeD0iOCIgY3k9IjI0IiByPSIyIiBmaWxsPSIjZmZmIi8+CiAgICAgICAgPGNpcmNsZSBjeD0iMTYiIGN5PSIyMCIgcj0iMiIgZmlsbD0iI2ZmZiIvPgogICAgICAgIDxjaXJjbGUgY3g9IjI0IiBjeT0iMjQiIHI9IjIiIGZpbGw9IiNmZmYiLz4KICAgIDwvc3ZnPgogICAg">
    <link rel="canonical" href="https://books.danielepelleri.com/en/core-philosophy-architecture/tool-testing-reality-anchor/" />
</head>
<body>
    <div class="container">
        <!-- Breadcrumb -->
        <nav class="breadcrumb">
            <a href="../../ai-team-orchestrator.html">🏠 AI Team Orchestrator</a>
            <span>›</span>
            <a href="../">🎻 Core Philosophy & Architecture</a>
            <span>›</span>
            <span>Tool Testing - Anchoring AI to Reality</span>
        </nav>
        <header class="chapter-header">
            <div class="chapter-instrument">🔧</div>
            <div class="chapter-meta">
                <span>Movement 1 of 4</span>
                <span>Chapter 10 of 42</span>
                <span>Ready to Read</span>
            </div>
            <h1 class="chapter-title">Tool Testing - Anchoring AI to Reality</h1>
        </header>

        <div class="chapter-content">
<p>We had a dynamic team and an intelligent orchestrator. But our agents, however well-designed, were still "digital philosophers." They could reason, plan, and write, but they couldnt <strong>act on the external world</strong>. Their knowledge was limited to what was intrinsic to the LLM model—a snapshot of the past, devoid of real-time data.</p>

<p>An AI system that cannot access updated information is destined to produce generic, outdated, and ultimately useless content. To respect our <strong>Pillar #11 (Concrete and Actionable Deliverables)</strong>, we had to give our agents the ability to "see" and "interact" with the external world. We had to give them <strong>Tools</strong>.</p>

<h3>The Architectural Decision: A Central "Tool Registry"</h3>

<p>Our first decision was not to associate tools directly with individual agents in the code. This would have created tight coupling and made management difficult. Instead, we created a <strong>centralized Tool Registry</strong>.</p>

<p><em>Reference code: <code>backend/tools/registry.py</code> (hypothetical, based on our logic)</em></p>

<p>This registry is a simple dictionary that maps a tool name (e.g., <code>"websearch"</code>) to an executable class.</p>

<pre><code class="language-python"># tools/registry.py
class ToolRegistry:
    def __init__(self):
        self._tools = {}

    def register(self, tool_name):
        def decorator(tool_class):
            self._tools[tool_name] = tool_class()
            return tool_class
        return decorator

    def get_tool(self, tool_name):
        return self._tools.get(tool_name)

tool_registry = ToolRegistry()

# tools/web_search_tool.py
from .registry import tool_registry

@tool_registry.register(&quot;websearch&quot;)
class WebSearchTool:
    async def execute(self, query: str):
        # Logic to call a search API like DuckDuckGo
        ...</code></pre>

<p>This approach gave us incredible flexibility:</p>

<ul>
<li><strong>Modularity (Pillar #14):</strong> Each tool is a standalone module, easy to develop, test, and maintain.</li>
<li><strong>Reusability:</strong> Any agent in the system can request access to any registered tool, without needing specific code.</li>
<li><strong>Extensibility:</strong> Adding a new tool (e.g., an <code>ImageGenerator</code>) simply means creating a new file and registering it, without touching the logic of agents or the orchestrator.</li>
</ul>

<h3>The First Tool: <code>websearch</code> – The Window to the World</h3>

<p>The first and most important tool we implemented was <code>websearch</code>. This single instrument transformed our agents from "students in a library" to "field researchers."</p>

<p>When an agent needs to execute a task, the OpenAI SDK allows it to autonomously decide whether it needs a tool. If the agent "thinks" it needs to search the web, the SDK formats a tool execution request. Our <code>Executor</code> intercepts this request, calls our implementation of the <code>WebSearchTool</code>, and returns the result to the agent, which can then use it to complete its work.</p>

<p><strong>Tool Execution Flow:</strong></p>

<div class="architecture-section">
    <div class="architecture-title">
        <svg class="architecture-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
            <line x1="9" y1="9" x2="15" y2="9"/>
            <line x1="9" y1="12" x2="15" y2="12"/>
            <line x1="9" y1="15" x2="15" y2="15"/>
        </svg>
        <h4>System Architecture</h4>
    </div>
    
    <div class="mermaid">
graph TD
    A[Agent receives Task] --> B{AI decides to use a tool}
    B --> C[SDK formats request for "websearch"]
    C --> D{Executor intercepts the request}
    D --> E[Calls `tool_registry.get_tool(websearch)`]
    E --> F[Executes the actual search]
    F --> G[Returns results to Executor]
    G --> H[SDK passes results to Agent]
    H --> I[Agent uses data to complete Task]
    </div>
</div>

<div class="architecture-section">
    <div class="architecture-title">
        <svg class="architecture-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
            <line x1="9" y1="9" x2="15" y2="9"/>
            <line x1="9" y1="12" x2="15" y2="12"/>
            <line x1="9" y1="15" x2="15" y2="15"/>
        </svg>
        <h4>System Architecture</h4>
    </div>
    
    
</div>

<div class="war-story">
    <h4>"War Story": The Test That Revealed AIs "Laziness"</h4>
    <p>We wrote a test to verify that the tools were working.</p>

<p><em>Reference code: <code>tests/test_tools.py</code></em></p>

<p>The test was simple: give an agent a task that clearly <em>required</em> a web search (e.g., "Who is the current CEO of OpenAI?") and verify that the <code>websearch</code> tool was called.</p>

<p>The first results were disconcerting: <strong>the test failed 50% of the time.</strong></p>

<p><em>Disaster Logbook (July 27):</em></p>

<pre><code class="language-text">ASSERTION FAILED: Web search tool was not called.;
AI Response: &quot;As of my last update in early 2023, the CEO of OpenAI was Sam Altman.&quot</code></pre>

<p><strong>The Problem:</strong> The LLM was "lazy." Instead of admitting it didnt have updated information and using the tool we had provided, it preferred to give an answer based on its internal knowledge, even if obsolete. It was choosing the easy way out, at the expense of quality and truthfulness.</p>

<p><strong>The Lesson Learned: You Must <em>Force</em> Tool Usage</strong></p>

<p>Its not enough to <em>give</em> a tool to an agent. You must create an environment and instructions that <strong>incentivize (or force) it to use it</strong>.</p>

<p>The solution was a refinement of our prompt engineering:</p>

<ol>
<li><strong>Explicit Instructions in System Prompt:</strong> We added a phrase to each agent's system prompt: <em>"When you need current or specific information that you don't have, you MUST use the appropriate tools available to you."</em></li>
</ol>

<ol>
<li><strong>"Priming" in Task Prompt:</strong> When assigning a task, we started adding a hint: <em>"This task requires up-to-date information. Use your tools to ensure accuracy."</em></li>
</ol>

<p>These changes increased tool usage from 50% to over 95%, solving the "laziness" problem and ensuring our agents actively sought real data.</p>
</div>

<div class="key-takeaways-section">
    <h4 class="key-takeaways-title">📝 Key Takeaways of the Chapter:</h4>
    <p class="takeaway-item">✓ <strong>Agents Need Tools:</strong> An AI system without access to external tools is a limited system destined to become obsolete.</p>
<p class="takeaway-item">✓ <strong>Centralize Tools in a Registry:</strong> Don't tie tools to specific agents. A modular registry is more scalable and maintainable.</p>
<p class="takeaway-item">✓ <strong>AI Can Be "Lazy":</strong> Don't assume an agent will use the tools you provide. You must explicitly instruct and incentivize it to do so.</p>
<p class="takeaway-item">✓ <strong>Test <em>Behavior</em>, Not Just Output:</strong> Tool tests shouldn't just verify that the tool works, but that the agent <em>decides</em> to use it when strategically correct.</p>

</div>

<p><strong>Chapter Conclusion</strong></p>

<p>With the introduction of tools, our agents finally had a way to produce reality-based results. But this opened a new Pandora's box: <strong>quality</strong>.</p>

<p>Now that agents could produce data-rich content, how could we be sure this content was high quality, consistent, and, most importantly, of real business value? It was time to build our <strong>Quality Gate</strong>.</p>
            </div>
</div>
    
    <div class="mermaid">
graph TD
    A[New Workspace Created] --> B{Semantic Goal Analysis}
    B --> C{Key Skills Extraction}
    C --> D{Necessary Roles Definition}
    D --> E{Complete Agent Profiles Generation}
    E --> F[Team Proposal]
    F --> G{Human/Automatic Approval}
    G -- Approved --> H[Agent Creation in DB]

    subgraph "Phase 1: Strategic Analysis (AI)"
        B[The `Director` reads the workspace goal]
        C[AI identifies necessary skills: "email marketing", "data analysis", "copywriting"]
        D[AI groups skills into roles: "Marketing Strategist", "Data Analyst"]
    end

    subgraph "Phase 2: Profile Creation (AI)"
        E[For each role, AI generates a complete profile: name, seniority, hard/soft skills, background]
    end
    
    subgraph "Phase 3: Finalization"
        F[The `Director` presents the proposed team with strategic justification]
        G[User approves or system auto-approves]
        H[Agents are saved to database and activated]
    end
    </div>
</div>

<div class="architecture-section">
    <div class="architecture-title">
        <svg class="architecture-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
            <line x1="9" y1="9" x2="15" y2="9"/>
            <line x1="9" y1="12" x2="15" y2="12"/>
            <line x1="9" y1="15" x2="15" y2="15"/>
        </svg>
        <h4>System Architecture</h4>
    </div>
    
    
</div>

<h3>The Heart of the System: The AI Recruiter Prompt</h3>

<p>To realize this vision, the <code>Director</code>s prompt had to be incredibly detailed.</p>

<p><em>Reference code: <code>backend/director.py</code> (<code>_generate_team_proposal_with_ai</code> logic)</em></p>

<pre><code class="language-python">prompt = f&quot;&quot;&quot;
You are a Director of a world-class AI talent agency. Your task is to analyze a new project&#x27;s objective and assemble the perfect AI agent team to ensure its success, treating each agent as a human professional.

**Obiettivo del Progetto:**
&quot;{workspace_goal}&quot;

**Available Budget:** {budget} EUR
**Expected Timeline:** {timeline}

**Required Analysis:**
1.  **Functional Decomposition:** Break down the objective into its main functional areas (e.g., &quot;Data Research&quot;, &quot;Creative Writing&quot;, &quot;Technical Analysis&quot;, &quot;Project Management&quot;).
2.  **Role-Skills Mapping:** For each functional area, define the necessary specialized role and the 3-5 essential key competencies (hard skills).
3.  **Soft Skills Definition:** For each role, identify 2-3 crucial soft skills (e.g., &quot;Problem Solving&quot; for an analyst, &quot;Empathy&quot; for a designer).
4.  **Optimal Team Composition:** Assemble a team of 3-5 agents, balancing skills to cover all areas without unnecessary overlaps. Assign seniority (Junior, Mid, Senior) to each role based on complexity.
5.  **Budget Optimization:** Ensure the total estimated team cost doesn&#x27;t exceed the budget. Prioritize efficiency: a smaller, senior team is often better than a large, junior one.
6.  **Complete Profile Generation:** For each agent, create a realistic name, personality, and brief background story that justifies their competencies.

**Output Format (JSON only):**
{{
  &quot;team_proposal&quot;: [
    {{
      &quot;name&quot;: &quot;Agent Name&quot;,
      &quot;role&quot;: &quot;Specialized Role&quot;,
      &quot;seniority&quot;: &quot;Senior&quot;,
      &quot;hard_skills&quot;: [&quot;skill 1&quot;, &quot;skill 2&quot;],
      &quot;soft_skills&quot;: [&quot;skill 1&quot;, &quot;skill 2&quot;],
      &quot;personality&quot;: &quot;Pragmatic and data-driven.&quot;,
      &quot;background_story&quot;: &quot;A brief story that contextualizes their competencies.&quot;,
      &quot;estimated_cost_eur&quot;: 5000
    }}
  ],
  &quot;total_estimated_cost&quot;: 15000,
  &quot;strategic_reasoning&quot;: &quot;The logic behind this team&#x27;s composition...&quot;
}}
&quot;&quot;&quot;</code></pre>

<div class="war-story">
    <h4>"War Story": The Agent Who Wanted to Hire Everyone</h4>
    <p>The first tests were a comic disaster. For a simple project to "write 5 emails", the <code>Director</code> proposed a team of 8 people, including an "AI Ethicist" and a "Digital Anthropologist". It had interpreted our desire for quality too literally, creating perfect but economically unsustainable teams.</p>

<p><em>Disaster Logbook (July 27):</em></p>

<pre><code class="language-text">PROPOSAL: Team of 8 agents. Estimated cost: €25,000. Budget: €5,000.
REASONING: "To ensure maximum ethical and cultural quality..."</code></pre>

<p><strong>The Lesson Learned: Autonomy Needs Clear Constraints.</strong></p>

<p>An AI without constraints will tend to "over-optimize" the request. We learned that we needed to be explicit about constraints, not just objectives. The solution was to add two critical elements to the prompt and logic:</p>

<ol>
<li><strong>Explicit Constraints in the Prompt:</strong> We added the <code><strong>Available Budget</strong></code> and <code><strong>Expected Timeline</strong></code> sections.</li>;
<li><strong>Post-Generation Validation:</strong> Our code performs a final check: <code>if proposal.total_cost &gt; budget: raise ValueError("Proposal over budget.")</code>.</li>
</ol>

<p>This experience reinforced <strong>Pillar #5 (Goal-Driven with Automatic Tracking)</strong>. An objective is not just a "what", but also a "how much" (budget) and a "when" (timeline).</p>
</div>

<div class="key-takeaways-section">
    <h4 class="key-takeaways-title">📝 Chapter Key Takeaways:</h4>
    <p class="takeaway-item">✓ <strong>Treat Agents as Colleagues:</strong> Design your agents with rich profiles (hard/soft skills, personality). This improves task matching and makes the system more intuitive.</p>
<p class="takeaway-item">✓ <strong>Delegate Team Composition to AI:</strong> Dont hard-code roles. Let AI analyze the project and propose the most suitable team.</p>
<p class="takeaway-item">✓ <strong>Autonomy Requires Constraints:</strong> To get realistic results, you must provide AI not only with objectives, but also constraints (budget, time, resources).</p>
<p class="takeaway-item">✓ <strong>Use AI for Creativity, Code for Rules:</strong> AI is excellent at generating creative profiles. Code is perfect for applying rigid, non-negotiable rules (like budget compliance).</p>

</div>

<p><strong>Chapter Conclusion</strong></p>

<p>With the <code>Director</code>, our system had reached a new level of autonomy. Now it could not only execute a plan, but also <strong>create the right team to execute it</strong>. We had a system that dynamically adapted to the nature of each new project.</p>

<p>But a team, however well composed, needs tools to work with. Our next challenge was understanding how to provide agents with the right "tools" for each trade, anchoring their intellectual capabilities to concrete actions in the real world.</p>
            </div>
    </div>

        <!-- Reader Tools -->
        <div class="reader-tools" id="readerTools">
            <button class="reader-tools-toggle" onclick="toggleReaderTools()">⚙</button>
            
            <div class="reader-tool" onclick="toggleTheme()">
                <span class="reader-tool-icon" id="themeIcon">🌙</span>
                <span class="reader-tool-label">Theme</span>
            </div>
            
            <div class="reader-tool" onclick="toggleBookmark()">
                <span class="reader-tool-icon">🔖</span>
                <span class="reader-tool-label">Bookmark</span>
            </div>
            
            <div class="reader-tool" onclick="showBookmarks()">
                <span class="reader-tool-icon">📚</span>
                <span class="reader-tool-label">My Bookmarks</span>
            </div>
            
            <div class="language-switcher">
                <select class="language-select" onchange="switchLanguage(this.value)">
                <option value="en">🇬🇧 EN</option><option value="it">🇮🇹 IT</option></select>
            </div>
            
            <div class="reader-tool" onclick="showFontSizeMenu()">
                <span class="reader-tool-icon">🔤</span>
                <span class="reader-tool-label">Font Size</span>
            </div>
        </div>
        
        <!-- Reading Progress -->
        <div class="reading-progress">
            <div class="reading-progress-fill" id="progressFill"></div>
        </div>
        
        <!-- Bookmark Toast -->
        <div class="bookmark-toast" id="bookmarkToast">
            <span id="bookmarkMessage">Bookmark saved!</span>
        </div>        
    <!-- Related Chapters Section -->
    <div class="related-chapters-section" id="related-chapters-section">
        <div class="related-chapters-header">
            <h3>🔗 Related Chapters</h3>
            <p>Explore these chapters to deepen your understanding of related concepts</p>
        </div>
        <div class="related-chapters-grid">
            
            <div class="related-chapter-item">
                <h4><a href="../core-philosophy-architecture/15-pillars-ai-system/" class="related-link">15 Pillars of AI Systems</a></h4>
                <p>Master agent tools with proven enterprise strategies and <a href="../memory-system-scaling/production-readiness-audit/" class="contextual-link" title="production readiness strategies">production-ready</a> patterns.</p>
                <a href="../core-philosophy-architecture/15-pillars-ai-system/" class="related-cta">Learn More →</a>
            </div>
        
            <div class="related-chapter-item">
                <h4><a href="../core-philosophy-architecture/tool-testing-reality-anchor/" class="related-link">Tool Testing Reality Anchor</a></h4>
                <p>Master function tools with proven enterprise strategies and <a href="../memory-system-scaling/production-readiness-audit/" class="contextual-link" title="production readiness strategies">production-ready</a> patterns.</p>
                <a href="../core-philosophy-architecture/tool-testing-reality-anchor/" class="related-cta">Learn More →</a>
            </div>
        
            <div class="related-chapter-item">
                <h4><a href="../core-philosophy-architecture/orchestrator-conductor/" class="related-link">Orchestrator as Conductor</a></h4>
                <p>Master <a href="../core-philosophy-architecture/agent-toolbox/" class="contextual-link" title="Tool Registry ecosystem">tool registry</a> with proven enterprise strategies and production-ready patterns.</p>
                <a href="../core-philosophy-architecture/orchestrator-conductor/" class="related-cta">Learn More →</a>
            </div>
</div>
    
    <style>
    .related-chapters-section {
        margin: 3rem 0;
        padding: 2rem;
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-radius: 15px;
        border-left: 5px solid #667eea;
    }
    
    .related-chapters-header {
        text-align: center;
        margin-bottom: 2rem;
    }
    
    .related-chapters-header h3 {
        color: #2c3e50;
        font-size: 1.8rem;
        margin-bottom: 0.5rem;
    }
    
    .related-chapters-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
    }
    
    .related-chapter-item {
        background: white;
        padding: 1.5rem;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
    }
    
    .related-chapter-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
    }
    
    .related-link {
        color: #667eea;
        text-decoration: none;
        font-weight: 600;
    }
    
    .related-link:hover {
        color: #5a6fd8;
        text-decoration: underline;
    }
    
    .related-cta {
        color: #667eea;
        text-decoration: none;
        font-weight: 600;
        font-size: 0.9rem;
        display: inline-flex;
        align-items: center;
        gap: 0.3rem;
        margin-top: 1rem;
    }
    
    .related-cta:hover {
        color: #5a6fd8;
    }
    
    /* Dark mode support */
    .dark-mode .related-chapters-section {
        background: rgba(255, 255, 255, 0.05);
        color: #e9ecef;
    }
    
    .dark-mode .related-chapters-header h3 {
        color: #e9ecef;
    }
    
    .dark-mode .related-chapter-item {
        background: rgba(255, 255, 255, 0.05);
        color: #e9ecef;
    }
    </style>
    
    <!-- Continue Reading Section -->
    <div class="continue-reading-section">
        <div class="continue-reading-header">
            <h3>📚 Continue Reading</h3>
        </div>
        <div class="continue-reading-actions">
            <a href="../ai-team-orchestrator.html" class="continue-btn primary">
                <span class="btn-icon">🏠</span>
                <span class="btn-text">Back to Guide</span>
            </a>
            <a href="../core-philosophy-architecture/" class="continue-btn secondary">
                <span class="btn-icon">🎭</span>
                <span class="btn-text">Explore Movement</span>
            </a>
        </div>
    </div>
    
    <style>
    .continue-reading-section {
        margin: 2rem 0;
        padding: 1.5rem;
        text-align: center;
        background: linear-gradient(135deg, #667eea10, #764ba210);
        border-radius: 15px;
    }
    
    .continue-reading-header h3 {
        color: #2c3e50;
        margin-bottom: 1rem;
    }
    
    .continue-reading-actions {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
    }
    
    .continue-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.8rem 1.5rem;
        border-radius: 25px;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .continue-btn.primary {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
    }
    
    .continue-btn.secondary {
        background: rgba(102, 126, 234, 0.1);
        color: #667eea;
        border: 2px solid #667eea;
    }
    
    .continue-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
    }
    
    .dark-mode .continue-reading-header h3 {
        color: #e9ecef;
    }
    
        /* Bookmarks Modal Styles */
        .bookmarks-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            backdrop-filter: blur(5px);
        }
        
        .bookmarks-modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .bookmarks-content {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .dark-mode .bookmarks-content {
            background: #1a1a2e;
            color: #e9ecef;
        }
        
        .bookmarks-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #667eea;
        }
        
        .bookmarks-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .dark-mode .bookmarks-title {
            color: #e9ecef;
        }
        
        .close-bookmarks {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #7f8c8d;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }
        
        .close-bookmarks:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }
        
        .bookmarks-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .bookmark-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 0.5rem;
            background: rgba(102, 126, 234, 0.05);
            transition: all 0.2s ease;
        }
        
        .bookmark-item:hover {
            background: rgba(102, 126, 234, 0.1);
            transform: translateX(5px);
        }
        
        .dark-mode .bookmark-item {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .dark-mode .bookmark-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .bookmark-info {
            flex-grow: 1;
        }
        
        .bookmark-title {
            font-weight: 600;
            color: #2c3e50;
            text-decoration: none;
            font-size: 1rem;
            line-height: 1.4;
        }
        
        .dark-mode .bookmark-title {
            color: #e9ecef;
        }
        
        .bookmark-title:hover {
            color: #667eea;
        }
        
        .bookmark-date {
            font-size: 0.8rem;
            color: #7f8c8d;
            margin-top: 0.3rem;
        }
        
        .bookmark-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .bookmark-action {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.3rem;
            border-radius: 5px;
            transition: all 0.2s ease;
            color: #7f8c8d;
        }
        
        .bookmark-action:hover {
            background: rgba(220, 53, 69, 0.1);
            color: #dc3545;
        }
        
        .empty-bookmarks {
            text-align: center;
            padding: 2rem;
            color: #7f8c8d;
        }
        
        .empty-bookmarks-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        
        .language-select {
            background: transparent;
            border: none;
            color: inherit;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            outline: none;
            min-width: 60px;
        }
        
        .language-select option {
            background: white;
            color: #2c3e50;
        }
        
        .dark-mode .language-select option {
            background: #1a1a2e;
            color: #e9ecef;
        }
    </style>
    </div>

    <script>

        // Reader Tools JavaScript
        let readerToolsCollapsed = false;
        
        // Initialize reader tools
        document.addEventListener('DOMContentLoaded', function() {
            initializeReaderTools();
            updateReadingProgress();
            loadUserPreferences();
        });
        
        // Toggle reader tools visibility
        function toggleReaderTools() {
            const tools = document.getElementById('readerTools')
            readerToolsCollapsed = !readerToolsCollapsed;
            
            if (readerToolsCollapsed) {
                tools.classList.add('collapsed');
            } else {
                tools.classList.remove('collapsed');
            }
            
            localStorage.setItem('readerToolsCollapsed', readerToolsCollapsed);
        }
        
        // Theme toggle functionality
        function toggleTheme() {
            const body = document.body;
            const themeIcon = document.getElementById('themeIcon')
            const isDarkMode = body.classList.contains('dark-mode');
            
            if (isDarkMode) {
                body.classList.remove('dark-mode');
                themeIcon.textContent = '🌙';
                localStorage.setItem(theme', 'light');
            } else {
                body.classList.add('dark-mode');
                themeIcon.textContent = '☀️';
                localStorage.setItem(theme', dark);
            }
        }
        
        // Bookmark functionality
        function toggleBookmark() {
            const currentPage = window.location.pathname;
            const pageTitle = document.querySelector('.chapter-title').textContent;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarks') || []');
            const existingIndex = bookmarks.findIndex(b => b.url === currentPage);
            
            if (existingIndex > -1) {
                bookmarks.splice(existingIndex, 1);
                showToast('Bookmark removed!', 'error');
            } else {
                bookmarks.push({
                    url: currentPage,
                    title: pageTitle,
                    timestamp: new Date().toISOString()
                });
                showToast('Bookmark saved!', 'success');
            }
            
            localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
        }
        
        // Language switching
        function switchLanguage(lang) {
            const currentPath = window.location.pathname;
            let newPath;
            
            if (lang === 'en')  {
                newPath = currentPath.replace(/it/, /en/);
                    .replace(filosofia-core-architettura', core-philosophy-architecture)
                    .replace('user-experience-trasparenza, user-experience-transparency)
                    .replace(esecuzione-qualita, execution-quality)
                    .replace(memory-system-scaling', memory-system-scaling)
                    .replace(i-15-pilastri-sistema-ai, 15-pillars-ai-system')
                    .replace(primo-agente-specialist-architecture, first-specialist-agent-architecture)
                    .replace(isolare-intelligenza-mock-llm, ai-mocking-testing-strategy)
                    .replace('dramma-parsing-contratto-ai, drama-parsing-ai-contracts')
                    .replace(sdk-vs-api-battle, sdk-vs-direct-api-battle)
                    .replace(agente-ambiente-interazioni-fondamentali, agent-environment-interactions)
                    .replace('orchestratore-direttore-orchestra, orchestrator-conductor)
                    .replace(staffetta-mancata-handoff, 'failed-handoff-delegation)
                    .replace(recruiter-ai-team-dinamico, ai-recruiter-dynamic-team)
                    .replace(test-tool-ancorare-realta, tool-testing-reality-anchor')
                    .replace(cassetta-attrezzi-agente, 'agent-toolbox);
            } else if (lang === it) {;
                newPath = currentPath.replace(/en/, /it/);
                    .replace(core-philosophy-architecture', filosofia-core-architettura)
                    .replace(user-experience-transparency, user-experience-trasparenza')
                    .replace(execution-quality, esecuzione-qualita)
                    .replace(memory-system-scaling, memory-system-scaling)
                    .replace('15-pillars-ai-system, i-15-pilastri-sistema-ai')
                    .replace(first-specialist-agent-architecture, primo-agente-specialist-architecture)
                    .replace(ai-mocking-testing-strategy, isolare-intelligenza-mock-llm)
                    .replace('drama-parsing-ai-contracts, dramma-parsing-contratto-ai)
                    .replace(sdk-vs-direct-api-battle, 'sdk-vs-api-battle)
                    .replace(agent-environment-interactions, agente-ambiente-interazioni-fondamentali)
                    .replace(orchestrator-conductor, orchestratore-direttore-orchestra')
                    .replace(failed-handoff-delegation, 'staffetta-mancata-handoff)
                    .replace(ai-recruiter-dynamic-team, recruiter-ai-team-dinamico)
                    .replace(tool-testing-reality-anchor, test-tool-ancorare-realta')
                    .replace(agent-toolbox, cassetta-attrezzi-agente);
            }
            
            if (newPath && newPath !== currentPath) {
                window.location.href = newPath;
            }
        }
        
        // Font size menu (simplified)
        function showFontSizeMenu() {
            const currentSize = localStorage.getItem('fontSize') || 'medium';
            let newSize;
            
            switch (currentSize) {
                case 'small':
                    newSize = 'medium';
                    break;
                case ''medium':
                    newSize = large';
                    break;
                case 'large':
                    newSize = small;
                    break;
                default:
                    newSize = 'medium';
            }
            
            setFontSize(newSize);
            localStorage.setItem(fontSize', newSize);
            showToast('`Font size: ${newSize}`, ''success');
        }
        
        // Set font size
        function setFontSize(size) {
            const root = document.documentElement;
            const sizes = {
                'small': 0.9,
                'medium': 1.0,
                'large': 1.1;
            };
            root.style.fontSize = sizes[size] + em';
        }
        
        // Show toast notification (improved)
        function showToast(message, type = 'success') {
            const toast = document.getElementById('bookmarkToast')
            const messageEl = document.getElementById('bookmarkMessage')
            
            if (!toast || !messageEl) return;
            
            // Clear any existing timeouts
            if (window.toastTimeout) {
                clearTimeout(window.toastTimeout);
            }
            
            // Reset classes and set message
            toast.classList.remove('show', 'error');
            messageEl.textContent = message;
            
            // Add appropriate classes
            if (type === 'error)  {
                toast.classList.add('error');
            }
            
            // Show toast
            toast.classList.add('show');
            
            // Hide after delay
            window.toastTimeout = setTimeout(() =>  {
                toast.classList.remove('show');
            }, 3000);
        }
        
        // Reading progress
        function updateReadingProgress() {
            const progressFill = document.getElementById('progressFill')
            
            window.addEventListener('scroll', () => {
                const article = document.querySelector('.chapter-content');
                if (!article) return;
                
                const articleTop = article.offsetTop;
                const articleHeight = article.offsetHeight;
                const windowHeight = window.innerHeight;
                const scrollTop = window.pageYOffset;
                
                const progress = Math.min(100, Math.max(0, 
                    ((scrollTop + windowHeight - articleTop) / articleHeight) * 100;
                ));
                
                progressFill.style.width = progress + '%';
            });
        }
        
        // Load user preferences
        function loadUserPreferences() {
            // Load theme
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                document.getElementById('themeIcon').textContent = '☀️';
            }
            
            // Load font size
            const savedFontSize = localStorage.getItem('fontSize');
            if (savedFontSize) {
                setFontSize(savedFontSize);
            }
            
            // Load reader tools state
            const toolsCollapsed = localStorage.getItem('readerToolsCollapsed') === true;
            if (toolsCollapsed) {
                document.getElementById('readerTools').classList.add('collapsed');
                readerToolsCollapsed = true;
            }
        }
        
        // Initialize reader tools
        function initializeReaderTools() {
            // Check if current page is bookmarked
            const currentPage = window.location.pathname;
            const bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]'');
            const isBookmarked = bookmarks.some(b => b.url === currentPage);
            
            if (isBookmarked) {
                document.querySelector('.reader-tool:nth-child(3')).classList.add('active');
            }
        
    
        // Show bookmarks modal
        function showBookmarks() {
            const modal = document.getElementById('bookmarksModal')
            const bookmarksList = document.getElementById('bookmarksList')
            const bookmarks = JSON.parse(localStorage.getItem('bookmarks') || []);
            
            if (bookmarks.length === 0) {
                bookmarksList.innerHTML = `
                    <div class="no-bookmarks">
                        <div class="no-bookmarks-icon">📚</div>
                        <h3>No bookmarks saved</h3>
                        <p>Start saving your favorite chapters clicking the icon 🔖</p>`;
                    </div>`;
            } else {
                bookmarksList.innerHTML = bookmarks.map(bookmark => `
                    <div class="bookmark-item">
                        <a href="${bookmark.url}" class="bookmark-link">
                            <div class="bookmark-title">${bookmark.title}</div>
                            <div class="bookmark-date">${new Date(bookmark.date).toLocaleDateString(it-IT)}</div>
                        </a>
                        <button class="delete-bookmark" onclick="deleteBookmark('${bookmark.url})">🗑️</button>
                    </div>
                `).join(');
            }
            
            modal.style.display = flex;
            document.body.style.overflow = hidden;
        }
        
        function closeBookmarksModal(event) {
            const modal = document.getElementById('bookmarksModal')
            if (modal && (!event || event.target === modal))  {
                modal.style.display = 'none';
                document.body.style.overflow = ';
            }
        }
        
        function deleteBookmark(url) {
            let bookmarks = JSON.parse(localStorage.getItem('bookmarks') || []);
            bookmarks = bookmarks.filter(b => b.url !== url);
            localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
            showToast('Bookmark removed!', 'error');
            showBookmarks();
        }
        
        function showToast(message, type = 'success') {
            let toast = document.getElementById('bookmarkToast')
            if (!toast) return;
            
            const messageEl = document.getElementById('bookmarkMessage')
            if (messageEl) messageEl.textContent = message;
            
            toast.style.background = type === 'error' ? '#dc3545 : #28a745;
            toast.style.opacity = 1;
            toast.style.transform = 'translateY(0);
            
            setTimeout(() => {
                toast.style.opacity = 0;
                toast.style.transform = 'translateY(-10px)';
            }, 3000);
        }
        
        document.addEventListener(DOMContentLoaded, function() {
            const currentPage = window.location.pathname;
            const bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]);
            const isBookmarked = bookmarks.some(b => b.url === currentPage);
            
            const bookmarkTool = document.querySelector('.reader-tool[onclick*="toggleBookmark"]');
            if (bookmarkTool) {
                bookmarkTool.classList.toggle('active', isBookmarked);
            }
            
            // Load saved theme
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === dark')  {
                document.body.classList.add('dark-mode');
                const themeIcon = document.getElementById('themeIcon')
                if (themeIcon) themeIcon.textContent = '☀️';
            }
        });
    
        }
    </script>

<!-- universal-progress-bar-added -->

    <!-- Mermaid.js for diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'base',
            themeVariables: {
                primaryColor: '#667eea',
                primaryTextColor: '#2c3e50',
                primaryBorderColor: '#667eea',
                lineColor: '#7f8c8d',
                secondaryColor: '#f8f9fa',
                tertiaryColor: '#ffffff'
            }
        });
    </script>
</body>
</html>
