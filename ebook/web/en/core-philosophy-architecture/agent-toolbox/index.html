<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@daniele_pelleri">
    <meta name="twitter:title" content="Agent Toolbox & Tools Registry | AI Team Orchestrator">
    <meta name="twitter:description" content="Master the Agent Toolbox: Function tools, hosted tools, and agents-as-tools patterns. Learn to build powerful tool registries for production AI systems.">
    <meta name="twitter:image" content="https://books.danielepelleri.com/assets/chapter-en.jpg">
    <title>The Agent's Toolbox - Virtual Hands | Core Philosophy Architecture | AI Team Orchestrator</title>
    <!-- Article Schema -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Article",
      "headline": "The Agent's Toolbox - Virtual Hands | AI Team Orchestrator",
      "description": "Chapter 11 of AI Team Orchestrator: The Agent's Toolbox - Virtual Hands",
      "author": {
        "@type": "Person",
        "name": "Daniele Pelleri",
        "url": "https://danielepelleri.com"
      },
      "publisher": {
        "@type": "Person",
        "name": "Daniele Pelleri"
      },
      "datePublished": "2025-01-01",
      "dateModified": "2025-08-25",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://books.danielepelleri.com/en/core-philosophy-architecture/agent-toolbox/"
      },
      "isPartOf": {
        "@type": "Book",
        "name": "AI Team Orchestrator",
        "author": {
          "@type": "Person", 
          "name": "Daniele Pelleri"
        }
    
        }
        }
    </script>
    <meta name="description" content="Chapter 11 of AI Team Orchestrator: The Agent's Toolbox - Virtual Hands">
    <meta name="keywords" content="AI agent tools, function tools, OpenAI SDK tools, agent toolbox, AI tool registry, hosted tools, code interpreter">
    <meta name="robots" content="index, follow">
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #2c3e50;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 2rem;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }
        
        .chapter-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .chapter-instrument {
            font-size: 4rem;
            margin-bottom: 1rem;
        }
        
        .chapter-meta {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            color: #7f8c8d;
            flex-wrap: wrap;
        }
        
        .chapter-title {
            font-size: 2.5rem;
            color: #2c3e50;
            margin-bottom: 2rem;
            font-weight: 700;
            line-height: 1.2;
        }
        
        .coming-soon {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 4rem 2rem;
            border-radius: 15px;
            text-align: center;
            margin: 2rem 0;
        }
        
        .nav-button {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem 2rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            text-decoration: none;
            border-radius: 50px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 1rem 0.5rem;
        }
        
        .nav-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.6);
        }
        /* Reader Tools */
        .reader-tools {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
            transition: all 0.3s ease;
            min-width: 60px;
        }
        
        .reader-tools.collapsed {
            width: 60px;
            padding: 0.8rem;
        }
        
        .reader-tool {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.6rem;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s ease;
            color: #495057;
            font-size: 0.85rem;
            white-space: nowrap;
        }
        
        .reader-tool:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }
        
        .reader-tool.active {
            background: #667eea;
            color: white;
        }
        
        .reader-tool-icon {
            font-size: 1.1rem;
            flex-shrink: 0;
        }
        
        .reader-tool-label {
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .collapsed .reader-tool-label {
            display: none;
        }
        
        .reader-tools-toggle {
            position: absolute;
            top: -10px;
            left: -10px;
            width: 30px;
            height: 30px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        /* Language Switcher */
        /* Language Switcher */
        .language-switcher {
            position: relative;
        }
        
        .language-select {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(0,0,0,0.1);
            border-radius: 6px;
            padding: 0.4rem 0.8rem;
            font-size: 0.75rem;
            font-weight: 600;
            color: #495057;
            cursor: pointer;
            transition: all 0.2s ease;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns=http://www.w3.org/2000/svg viewBox=0 0 24 24 fill=none stroke=currentColor' stroke-width=2 stroke-linecap=round stroke-linejoin=round'%3e%3cpolyline points=6,9 12,15 18,9%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.4rem center;
            background-size: 1rem;
            padding-right: 1.8rem;
            min-width: 60px;
        }
        
        .language-select:hover {
            background: rgba(255, 255, 255, 1);
            border-color: #667eea;
        }
        
        .language-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }
        
        /* Reading Progress */
        .reading-progress {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: rgba(102, 126, 234, 0.2);
            z-index: 1001;
        }
        
        .reading-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        /* Dark Mode */
        body.dark-mode {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e9ecef;
        }
        
        .dark-mode .container {
            color: #e9ecef;
        }
        
        .dark-mode .chapter-header,
        .dark-mode .chapter-content {
            background: rgba(255, 255, 255, 0.05);
            color: #e9ecef;
        }
        
        .dark-mode .breadcrumb {
            background: rgba(255, 255, 255, 0.1);
            color: #e9ecef;
        }
        
        .dark-mode .reader-tools {
            background: rgba(0, 0, 0, 0.8);
            color: #e9ecef;
        }
        
        .dark-mode .reader-tool {
            color: #e9ecef;
        }
        
        .dark-mode .reader-tool:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .dark-mode .language-select {
            background: rgba(255, 255, 255, 0.1);
            color: #e9ecef;
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        .dark-mode .language-select:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: #667eea;
        }
        
        /* Dark Mode - Headings and Titles */
        .dark-mode .chapter-title,
        .dark-mode .chapter-content h3,
        .dark-mode .chapter-content h4,
        .dark-mode .chapter-content h5 {
            color: #e9ecef !important;
        }
        
        .dark-mode .chapter-content p,
        .dark-mode .chapter-content li,
        .dark-mode .chapter-content strong {
            color: #e9ecef;
        }
        
        .dark-mode .takeaway-item {
            color: #e9ecef;
        }
        
        /* Dark Mode - Tables */
        .dark-mode table {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .dark-mode th,
        .dark-mode td {
            color: #e9ecef;
            border-bottom-color: rgba(255, 255, 255, 0.1);
        }
        
        .dark-mode th {
            background: rgba(255, 255, 255, 0.1);
        }
        
        /* Navigation Container Fix */
        .chapter-nav-bottom {
            max-width: 900px;
            box-sizing: border-box;
            margin: 3rem auto 2rem auto;
            padding: 2rem;
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            gap: 2rem;
        }
        
        .nav-section {
            flex: 1;
            text-align: center;
        }
        
        .nav-section.center {
            border-left: 1px solid #e9ecef;
            border-right: 1px solid #e9ecef;
            padding: 0 2rem;
        }
        
        .nav-label {
            font-size: 0.8rem;
            color: #7f8c8d;
            margin-bottom: 0.5rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .nav-link {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.2s ease;
            display: block;
            padding: 0.5rem;
            border-radius: 8px;
        }
        
        .nav-link:hover {
            background: #667eea;
            color: white;
            transform: translateY(-1px);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .reader-tools {
                right: 10px;
                padding: 0.8rem;
                min-width: 50px;
            }
            
            .reader-tools.collapsed {
                width: 50px;
                padding: 0.6rem;
            }
            
            .reader-tool {
                padding: 0.5rem;
            }
            
            .reader-tool-label {
                font-size: 0.75rem;
            }
            
            .chapter-nav-bottom {
                flex-direction: column;
                text-align: center;
                padding: 1rem;
                gap: 1rem;
            }
            
            .nav-section.center {
                border: none;
                border-top: 1px solid #e9ecef;
                border-bottom: 1px solid #e9ecef;
                padding: 1rem 0;
            }
        }

        /* Fixed Bookmark Toast */
        .bookmark-toast {
            position: fixed;
            top: 80px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 0.8rem 1.2rem;
            border-radius: 8px;
            z-index: 1002;
            transform: translateX(350px);
            opacity: 0;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
            pointer-events: none;
        }
        
        .bookmark-toast.show {
            transform: translateX(0);
            opacity: 1;
            pointer-events: auto;
        }
        
        .bookmark-toast.error {
            background: #dc3545;
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
        }

        /* Bookmarks Modal */
        .bookmarks-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        
        .bookmarks-modal.show {
            display: flex;
        }
        
        .bookmarks-content {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            position: relative;
        }
        
        .bookmarks-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f8f9fa;
        }
        
        .bookmarks-title {
            font-size: 1.5rem;
            color: #2c3e50;
            margin: 0;
        }
        
        .bookmarks-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #7f8c8d;
            padding: 0.5rem;
            border-radius: 50%;
            transition: all 0.2s ease;
        }
        
        .bookmarks-close:hover {
            background: #f8f9fa;
            color: #2c3e50;
        }
        
        .bookmark-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            margin-bottom: 1rem;
            background: #f8f9fa;
            border-radius: 10px;
            transition: all 0.2s ease;
        }
        
        .bookmark-item:hover {
            background: #e9ecef;
        }
        
        .bookmark-info {
            flex: 1;
        }
        
        .bookmark-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 0.25rem;
            font-size: 1rem;
        }
        
        .bookmark-url {
            font-size: 0.8rem;
            color: #667eea;
            text-decoration: none;
        }
        
        .bookmark-url:hover {
            text-decoration: underline;
        }
        
        .bookmark-date {
            font-size: 0.75rem;
            color: #7f8c8d;
            margin-top: 0.25rem;
        }
        
        .bookmark-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .bookmark-action {
            background: none;
            border: none;
            padding: 0.5rem;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1rem;
        }
        
        .bookmark-action:hover {
            background: rgba(102, 126, 234, 0.1);
        }
        
        .bookmark-action.delete:hover {
            background: rgba(220, 53, 69, 0.1);
            color: #dc3545;
        }
        
        .no-bookmarks {
            text-align: center;
            padding: 3rem 2rem;
            color: #7f8c8d;
        }
        
        .no-bookmarks-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        /* Dark Mode for Bookmarks Modal */
        .dark-mode .bookmarks-content {
            background: rgba(26, 26, 46, 0.95);
            color: #e9ecef;
        }
        
        .dark-mode .bookmarks-title {
            color: #e9ecef;
        }
        
        .dark-mode .bookmarks-close {
            color: #e9ecef;
        }
        
        .dark-mode .bookmarks-close:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .dark-mode .bookmark-item {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .dark-mode .bookmark-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .dark-mode .bookmark-title {
            color: #e9ecef;
        }

        /* Dark Mode - Content Areas */
        .dark-mode .content-area {
            background: rgba(255, 255, 255, 0.05);
            color: #e9ecef;
        }
        
        .dark-mode .content-area h2,
        .dark-mode .content-area h3,
        .dark-mode .content-area h4 {
            color: #e9ecef;
        }
        
        .dark-mode .content-area p,
        .dark-mode .content-area li {
            color: #e9ecef;
        }
        
        .dark-mode .content-area strong {
            color: #e9ecef;
        }
        
        /* Dark Mode - Tables */
        .dark-mode table {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .dark-mode th,
        .dark-mode td {
            color: #e9ecef;
            border-bottom-color: rgba(255, 255, 255, 0.1);
        }
        
        .dark-mode th {
            background: rgba(255, 255, 255, 0.1);
        }
        
        /* Dark Mode - Takeaways and Boxes */
        .dark-mode .key-takeaways,
        .dark-mode .insight-box,
        .dark-mode .war-story {
            background: rgba(255, 255, 255, 0.05);
            color: #e9ecef;
        }
        
        .dark-mode .key-takeaways h3,
        .dark-mode .insight-box h3,
        .dark-mode .war-story h3 {
            color: #e9ecef;
        }
        
        .dark-mode .key-takeaways p,
        .dark-mode .insight-box p,
        .dark-mode .war-story p {
            color: #e9ecef;
        }
        
        .dark-mode .key-takeaways li,
        .dark-mode .insight-box li,
        .dark-mode .war-story li {
            color: #e9ecef;
        }
    
        /* Architecture Icon Styling */
        .architecture-icon {
            width: 24px;
            height: 24px;
            margin-right: 12px;
            flex-shrink: 0;
        }
        
        /* War Story Icon Styling */
        .war-story-icon {
            width: 24px;
            height: 24px;
            margin-right: 12px;
            flex-shrink: 0;
        }
        
        /* Insight Icon Styling */
        .insight-icon {
            width: 24px;
            height: 24px;
            margin-right: 12px;
            flex-shrink: 0;
        }
        
        /* Architecture Section Styling */
        .architecture-section {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 2rem;
            margin: 2rem 0;
        }
        
        .architecture-title {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
            font-weight: 600;
            color: #495057;
        }
        
        .architecture-title h4 {
            margin: 0;
            color: #495057;
        }
        
        /* War Story Styling */
        .war-story {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border-left: 4px solid #856404;
            border-radius: 10px;
            padding: 2rem;
            margin: 2rem 0;
        }
        
        .war-story h4 {
            color: #856404;
            margin-top: 0;
        }
        
        /* Key Takeaways Styling */
        .key-takeaways-section {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border-radius: 10px;
            padding: 2rem;
            margin: 2rem 0;
        }
        
        .key-takeaways-title {
            margin-bottom: 1rem;
            font-weight: 600;
        }
        
        .key-takeaways-content {
            line-height: 1.6;
        }
        
        .takeaway-item {
            margin-bottom: 0.5rem;
        }
        
        /* Industry Insight Styling */
        .industry-insight {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-left: 4px solid #28a745;
            border-radius: 10px;
            padding: 2rem;
            margin: 2rem 0;
        }
        
        .industry-insight h4 {
            color: #28a745;
            margin-top: 0;
        }
        
        /* Mermaid Container */
        .mermaid {
            background: #f8f9fa;
            padding: 2rem;
            border-radius: 10px;
            margin: 2rem 0;
            text-align: center;
        }
    
        .architecture-section,
        .mermaid,
        .war-story,
        .key-takeaways-section,
        .industry-insight {
            max-width: 100%;
            box-sizing: border-box;
            overflow-x: auto;
        }
        
        .mermaid svg {
            max-width: 100%;
            height: auto;
        }
        
        /* PDF/Print Specific Styles - Hide UI Elements */
        @media print {
            .bookmarks-modal,
            .reader-tools,
            .bookmark-toast,
            #bookmarksModal,
            #bookmarkToast {
                display: none !important;
                visibility: hidden !important;
                opacity: 0 !important;
                z-index: -1000 !important;
            }
        }
            </style>

    <style>
    .contextual-link {
        color: #667eea;
        text-decoration: none;
        font-weight: 500;
        border-bottom: 1px dotted #667eea;
        transition: all 0.2s ease;
    }
    
    .contextual-link:hover {
        color: #5a6fd8;
        border-bottom-style: solid;
    }
    
    .dark-mode .contextual-link {
        color: #9bb5ff;
        border-bottom-color: #9bb5ff;
    }
        
        /* PDF/Print Specific Styles - Hide UI Elements */
        @media print {
            .bookmarks-modal,
            .reader-tools,
            .bookmark-toast,
            #bookmarksModal,
            #bookmarkToast {
                display: none !important;
                visibility: hidden !important;
                opacity: 0 !important;
                z-index: -1000 !important;
            }
        }
            </style>
        <style>

/* ========================================
   NARRATIVE LINKING SYSTEM STYLES
   ======================================== */

/* Contextual Links */
.contextual-link  {
    color: #3b82f6;
    text-decoration: none;
    border-bottom: 1px solid rgba(59, 130, 246, 0.3);
    transition: all 0.2s ease;
    padding-bottom: 1px;
}

.contextual-link:hover {
    color: #1d4ed8;
    border-bottom-color: #1d4ed8;
    background: rgba(59, 130, 246, 0.05);
    padding: 2px 4px;
    margin: -2px -4px;
    border-radius: 3px;
}

/* Narrative Callouts */
.narrative-callout {
    margin: 2rem 0;
    padding: 1.5rem;
    border-radius: 12px;
    border: 1px solid #e5e7eb;
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

.narrative-callout.next-step {
    border-left: 4px solid #10b981;
    background: linear-gradient(135deg, #ecfdf5 0%, #f0fdf4 100%);
}

.narrative-callout.evolution {
    border-left: 4px solid #f59e0b;
    background: linear-gradient(135deg, #fffbeb 0%, #fefce8 100%);
}

.callout-header {
    display: flex;
    align-items: center;
    margin-bottom: 0.75rem;
}

.callout-icon {
    font-size: 1.25rem;
    margin-right: 0.5rem;
}

.callout-header h4 {
    margin: 0;
    font-size: 1.1rem;
    font-weight: 600;
    color: #1f2937;
}

.narrative-link {
    color: #059669;
    text-decoration: none;
    font-weight: 500;
    border-bottom: 2px solid rgba(5, 150, 105, 0.2);
    transition: all 0.2s ease;
}

.narrative-link:hover {
    color: #047857;
    border-bottom-color: #047857;
    background: rgba(5, 150, 105, 0.1);
    padding: 2px 4px;
    margin: -2px -4px;
    border-radius: 4px;
}

.callout-meta {
    display: flex;
    gap: 1rem;
    margin-top: 1rem;
    font-size: 0.875rem;
    color: #6b7280;
}

/* Journey Progress */
.journey-progress {
    margin-top: 1rem;
}

.progress-bar {
    width: 100%;
    height: 4px;
    background: rgba(249, 115, 22, 0.2);
    border-radius: 2px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #f97316 0%, #ea580c 100%);
    border-radius: 2px;
    transition: width 0.3s ease;
}

.progress-text {
    display: block;
    margin-top: 0.5rem;
    font-size: 0.8rem;
    color: #9ca3af;
}

/* Related Chapters */
.related-chapters {
    margin: 2.5rem 0;
    padding: 2rem;
    background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
    border-radius: 12px;
    border: 1px solid #e5e7eb;
}

.related-chapters h4 {
    margin: 0 0 1.5rem 0;
    font-size: 1.2rem;
    color: #1f2937;
    display: flex;
    align-items: center;
}

.related-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
}

.related-item {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: 1.25rem;
    background: white;
    border-radius: 8px;
    border: 1px solid #e5e7eb;
    transition: all 0.2s ease;
}

.related-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 16px -4px rgba(0, 0, 0, 0.1);
    border-color: #3b82f6;
}

.related-icon {
    font-size: 1.5rem;
    min-width: 2rem;
}

.related-content {
    flex: 1;
}

.related-link {
    color: #1f2937;
    text-decoration: none;
    font-weight: 600;
    transition: color 0.2s ease;
}

.related-link:hover {
    color: #3b82f6;
}

.related-desc {
    margin: 0.5rem 0;
    color: #6b7280;
    font-size: 0.9rem;
    line-height: 1.4;
}

.related-connection {
    font-size: 0.8rem;
    color: #9ca3af;
    font-style: italic;
}

/* Dark Mode Support */
.dark-mode .narrative-callout {
    background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
    border-color: #374151;
    color: #f9fafb;
}

.dark-mode .related-chapters {
    background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
    border-color: #374151;
}

.dark-mode .related-item {
    background: #1f2937;
    border-color: #374151;
}

.dark-mode .related-link {
    color: #f9fafb;
}

.dark-mode .related-link:hover {
    color: #60a5fa;
}

/* Responsive Design */
@media (max-width: 768px) {
    .narrative-callout {
        margin: 1.5rem 0;
        padding: 1.25rem;
    }
    
    .related-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
    
    .related-item {
        padding: 1rem;
    }
    
    .callout-meta {
        flex-direction: column;
        gap: 0.5rem;
    }
}

/* Top Navigation Styling */
.chapter-nav-top {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(255, 255, 255, 0.9);
    padding: 1rem 2rem;
    border-radius: 10px;
    margin-bottom: 2rem;
    backdrop-filter: blur(10px);
    gap: 1rem;
}

.chapter-nav-top .nav-link {
    color: #667eea;
    text-decoration: none;
    font-weight: 600;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    transition: all 0.2s ease;
    border: 2px solid transparent;
}

.chapter-nav-top .nav-link:hover {
    background: #667eea;
    color: white;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

@media (max-width: 768px) {
    .chapter-nav-top {
        flex-direction: column;
        gap: 0.5rem;
        padding: 1rem;
    }
    
    .chapter-nav-top .nav-link {
        width: 100%;
        text-align: center;
    }
}
        
        /* PDF/Print Specific Styles - Hide UI Elements */
        @media print {
            .bookmarks-modal,
            .reader-tools,
            .bookmark-toast,
            #bookmarksModal,
            #bookmarkToast {
                display: none !important;
                visibility: hidden !important;
                opacity: 0 !important;
                z-index: -1000 !important;
            }
        }
            </style>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,CiAgICA8c3ZnIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDMyIDMyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogICAgICAgIDxkZWZzPgogICAgICAgICAgICA8bGluZWFyR3JhZGllbnQgaWQ9ImdyYWQxIiB4MT0iMCUiIHkxPSIwJSIgeDI9IjEwMCUiIHkyPSIxMDAlIj4KICAgICAgICAgICAgICAgIDxzdG9wIG9mZnNldD0iMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiM2NjdlZWE7c3RvcC1vcGFjaXR5OjEiIC8+CiAgICAgICAgICAgICAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiM3NjRiYTI7c3RvcC1vcGFjaXR5OjEiIC8+CiAgICAgICAgICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgICAgICAgPC9kZWZzPgogICAgICAgIDwhLS0gQmFja2dyb3VuZCBjaXJjbGUgLS0+CiAgICAgICAgPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTUiIGZpbGw9InVybCgjZ3JhZDEpIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMiIvPgogICAgICAgIDwhLS0gQUkgQnJhaW4gaWNvbiAtLT4KICAgICAgICA8Y2lyY2xlIGN4PSIxNiIgY3k9IjEzIiByPSI4IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMiIvPgogICAgICAgIDxjaXJjbGUgY3g9IjEzIiBjeT0iMTEiIHI9IjEiIGZpbGw9IiNmZmYiLz4KICAgICAgICA8Y2lyY2xlIGN4PSIxOSIgY3k9IjExIiByPSIxIiBmaWxsPSIjZmZmIi8+CiAgICAgICAgPHBhdGggZD0iTTEyIDE1YzEgMiAzIDIgNCAyczMgMCA0LTIiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLXdpZHRoPSIxLjUiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgogICAgICAgIDwhLS0gVGVhbSBvcmNoZXN0cmF0aW9uIGxpbmVzIC0tPgogICAgICAgIDxwYXRoIGQ9Ik04IDI0TDE2IDIwTDI0IDI0IiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMiIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgICAgICAgPGNpcmNsZSBjeD0iOCIgY3k9IjI0IiByPSIyIiBmaWxsPSIjZmZmIi8+CiAgICAgICAgPGNpcmNsZSBjeD0iMTYiIGN5PSIyMCIgcj0iMiIgZmlsbD0iI2ZmZiIvPgogICAgICAgIDxjaXJjbGUgY3g9IjI0IiBjeT0iMjQiIHI9IjIiIGZpbGw9IiNmZmYiLz4KICAgIDwvc3ZnPgogICAg">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,CiAgICA8c3ZnIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDMyIDMyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogICAgICAgIDxkZWZzPgogICAgICAgICAgICA8bGluZWFyR3JhZGllbnQgaWQ9ImdyYWQxIiB4MT0iMCUiIHkxPSIwJSIgeDI9IjEwMCUiIHkyPSIxMDAlIj4KICAgICAgICAgICAgICAgIDxzdG9wIG9mZnNldD0iMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiM2NjdlZWE7c3RvcC1vcGFjaXR5OjEiIC8+CiAgICAgICAgICAgICAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiM3NjRiYTI7c3RvcC1vcGFjaXR5OjEiIC8+CiAgICAgICAgICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgICAgICAgPC9kZWZzPgogICAgICAgIDwhLS0gQmFja2dyb3VuZCBjaXJjbGUgLS0+CiAgICAgICAgPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTUiIGZpbGw9InVybCgjZ3JhZDEpIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMiIvPgogICAgICAgIDwhLS0gQUkgQnJhaW4gaWNvbiAtLT4KICAgICAgICA8Y2lyY2xlIGN4PSIxNiIgY3k9IjEzIiByPSI4IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMiIvPgogICAgICAgIDxjaXJjbGUgY3g9IjEzIiBjeT0iMTEiIHI9IjEiIGZpbGw9IiNmZmYiLz4KICAgICAgICA8Y2lyY2xlIGN4PSIxOSIgY3k9IjExIiByPSIxIiBmaWxsPSIjZmZmIi8+CiAgICAgICAgPHBhdGggZD0iTTEyIDE1YzEgMiAzIDIgNCAyczMgMCA0LTIiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLXdpZHRoPSIxLjUiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgogICAgICAgIDwhLS0gVGVhbSBvcmNoZXN0cmF0aW9uIGxpbmVzIC0tPgogICAgICAgIDxwYXRoIGQ9Ik04IDI0TDE2IDIwTDI0IDI0IiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMiIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgICAgICAgPGNpcmNsZSBjeD0iOCIgY3k9IjI0IiByPSIyIiBmaWxsPSIjZmZmIi8+CiAgICAgICAgPGNpcmNsZSBjeD0iMTYiIGN5PSIyMCIgcj0iMiIgZmlsbD0iI2ZmZiIvPgogICAgICAgIDxjaXJjbGUgY3g9IjI0IiBjeT0iMjQiIHI9IjIiIGZpbGw9IiNmZmYiLz4KICAgIDwvc3ZnPgogICAg">
    <link rel="canonical" href="https://books.danielepelleri.com/en/core-philosophy-architecture/agent-toolbox/" />
</head>
<body>
    <div class="container">
        <!-- Breadcrumb -->
        <nav class="breadcrumb">
            <a href="../../ai-team-orchestrator.html">🏠 AI Team Orchestrator</a>
            <span>›</span>
            <a href="../">🎻 Core Philosophy & Architecture</a>
            <span>›</span>
            <span>The Agents Toolbox</span>
        </nav>

        <!-- Top Navigation -->
        <nav class="chapter-nav-top">
            <a href="../" class="nav-link">
                ← Back to Movement
            </a>
            <a href="../../ai-team-orchestrator.html" class="nav-link">
                📚 Complete Guide
            </a>
        </nav>
        <header class="chapter-header">
            <div class="chapter-instrument">🎧</div>
            <div class="chapter-meta">
                <span>Movement 1 of 4</span>
                <span>Chapter 11 of 42</span>
                <span>Ready to Read</span>
            </div>
            <h1 class="chapter-title">The Agent's Toolbox – Virtual Hands</h1>
        </header>

        <div class="chapter-content">
<p>With <code>websearch</code>, our agents had opened a window to the world. But an expert researcher doesnt just read: they analyze data, perform calculations, interact with other systems and, when necessary, consult other experts. To elevate our agents from simple "information gatherers" to true "digital analysts," we needed to drastically expand their toolbox.</p>

<p>The OpenAI Agents SDK classifies tools into three main categories, and our journey led us to implement them and understand their respective strengths and weaknesses.</p>

<h3>1. Function Tools: Transforming Code into Capabilities</h3>

<p>This is the most common and powerful form of tool. It allows you to transform <strong>any Python function into a capability that the agent can invoke</strong>. The SDK magically takes care of analyzing the function signature, argument types, and even the docstring to generate a schema that the LLM can understand.</p>

<p><strong>The Architectural Decision: A Central "Tool Registry" and Decorators</strong></p>

<p>To keep our code clean and modular (<strong>Pillar #14</strong>), we implemented a central <code>ToolRegistry</code>. Any function anywhere in our codebase can be transformed into a tool simply by adding a decorator.</p>

<p><em>Reference code: <code>backend/tools/registry.py</code> and <code>backend/tools/web_search_tool.py</code></em></p>

<pre><code class="language-python"># Example of a Function Tool
from .registry import tool_registry

@tool_registry.register(&quot;websearch&quot;)
class WebSearchTool:
    &quot;&quot;&quot;
    Performs a web search using the DuckDuckGo API to get updated information.
    Essential for tasks that require real-time data.
    &quot;&quot;&quot;
    async def execute(self, query: str) -&gt; str:
        # Logic to call a search API...
        return &quot;Search results...&quot;</code></pre>

<p>The SDK allowed us to cleanly define not only the action (<code>execute</code>), but also its "advertisement" to the AI through the docstring, which becomes the tools description.</p>

<h3>2. Hosted Tools: Leveraging Platform Power</h3>

<p>Some tools are so complex and require such specific infrastructure that it doesnt make sense to implement them ourselves. These are called "Hosted Tools," services run directly on OpenAIs servers. The most important one for us was the <strong><code>CodeInterpreterTool</code></strong>.</p>

<p><strong>The Challenge: The <code>code_interpreter</code> – A Sandboxed Analysis Laboratory</strong></p>

<p>Many tasks required complex quantitative analysis. The solution was to give the AI the ability to <strong>write and execute Python code</strong>.</p>

<p><em>Reference code: <code>backend/tools/code_interpreter_tool.py</code> (integration logic)</em></p>

<div class="war-story">
    <div class="war-story-header">
        <svg class="war-story-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
            <line x1="12" y1="9" x2="12" y2="13"/>
            <line x1="12" y1="17" x2="12.01" y2="17"/>
        </svg>
        <h4>"War Story": The Agent That Wanted to Format the Disk</h4>
    </div>
    <div class="war-story">
    <h4>"War Story": The Agent That Wanted to Format the Disk</h4>
</div>

<p>As mentioned, our first encounter with the <code>code_interpreter</code> was traumatic. An agent generated dangerous code (<code>rm -rf /*</code>), teaching us the fundamental lesson about security.</p>

<p><strong>The Lesson Learned: "Zero Trust Execution"</strong></p>

<p>Code generated by an LLM must be treated as the most hostile input possible. Our security architecture is based on three levels:</p>

<table>
<thead>
<tr>
<th>Security Level</th>
<th>Implementation</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>1. Sandboxing</strong></td>
<td>Execution of all code in an ephemeral Docker container with minimal permissions (no access to network or host file system).</td>
<td>Completely isolate execution, making even the most dangerous commands harmless.</td>
</tr>
<tr>
<td><strong>2. Static Analysis</strong></td>
<td>A pre-execution validator that looks for obviously malicious code patterns (<code>os.system</code>, <code>subprocess</code>).</td>
<td>A quick first filter to block the most obvious abuse attempts.</td>
</tr>
<tr>
<td><strong>3. Guardrail (Human-in-the-Loop)</strong></td>
<td>An SDK <code>Guardrail</code> that intercepts code. If it attempts critical operations, it pauses execution and requests human approval.</td>
<td>The final safety net, applying <strong>Pillar #8</strong> to tool security as well.</td>
</tr>
</tbody>
</table>

<h3>3. Agents as Tools: Consulting an Expert</h3>

<p>This is the most advanced technique and the one that truly transformed our system into a <strong>digital organization</strong>. Sometimes, the best "tool" for a task isnt a function, but another agent.</p>

<p>We realized that our <code>MarketingStrategist</code> shouldn't try to do financial analysis. It should <em>consult</em> the <code>FinancialAnalyst</code>.</p>

<p><strong>The "Agent-as-Tools" Pattern:</strong></p>

<p>The SDK makes this pattern incredibly elegant with the <code>.as_tool()</code> method.</p>

<p><em>Reference code: Conceptual logic in <code>director.py</code> and <code>specialist.py</code></em></p>

<pre><code class="language-python"># Definition of specialist agents
financial_analyst_agent = Agent(name=&quot;Financial Analyst&quot;, instructions=&quot;...&quot;)
market_researcher_agent = Agent(name=&quot;Market Researcher&quot;, instructions=&quot;...&quot;)

# Creation of the orchestrator agent
strategy_agent = Agent(name=&quot;StrategicPlanner&quot;,
    instructions=&quot;Analyze the problem and delegate to your specialists using tools.&quot;,
    tools=[
        financial_analyst_agent.as_tool(tool_name=&quot;consult_financial_analyst&quot;,
            tool_description=&quot;Ask a specific financial analysis question.&quot;
        ),
        market_researcher_agent.as_tool(
            tool_name=&quot;get_market_data&quot;,
            tool_description=&quot;Request updated market data.&quot;
        ),
    ],
)</code></pre>

<p>This unlocked <strong>hierarchical collaboration</strong>. Our system was no longer a "flat" team, but a true organization where agents could delegate sub-tasks, request consultations, and aggregate results, just like in a real company.</p>

<div class="key-takeaways-section">
    <h4 class="key-takeaways-title">📝 Key Takeaways of the Chapter:</h4>
    <p class="takeaway-item">✓ <strong>Choose the Right Tool Class:</strong> Not all tools are equal. Use <code>Function Tools</code> for custom capabilities, <code>Hosted Tools</code> for complex infrastructure (like the <code>code_interpreter</code>), and <code>Agents as Tools</code> for delegation and collaboration.</p>
<p class="takeaway-item">✓ <strong>Security is Not Optional:</strong> If you use powerful tools like code execution, you must design a multi-layered security architecture based on the "Zero Trust" principle.</p>
<p class="takeaway-item">✓ <strong>Delegation is a Superior Form of Intelligence:</strong> The most advanced agent systems arent those where every agent knows how to do everything, but those where every agent knows who to ask for help.</p>

</div>

<p><strong>Chapter Conclusion</strong></p>

<p>With a rich and secure toolbox, our agents were now able to tackle a much broader range of complex problems. They could analyze data, create visualizations, and collaborate at a much deeper level.</p>

<p>This, however, made the role of our quality system even more critical. With such powerful agents, how could we be sure that their outputs, now much more sophisticated, were still high quality and aligned with business objectives? This brings us back to our <strong>Quality Gate</strong>, but with a new and deeper understanding of what "quality" means.</p>
            </div>
</div>
    
    <div class="mermaid">
graph TD
    A[Agent receives Task]
    B{AI decides to use a tool}
    C[SDK formats request for websearch]
    D{Executor intercepts the request}
    E[Calls tool_registry.get_tool websearch]
    F[Executes the actual search]
    G[Returns results to Executor]
    H[SDK passes results to Agent]
    I[Agent uses data to complete Task]
    
    A --> B
    B --> C
    C --> D
    D --> E
    E --> F
    F --> G
    G --> H
    H --> I
    </div>
</div>

<div class="architecture-section">
    <div class="architecture-title">
        <svg class="architecture-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
            <line x1="9" y1="9" x2="15" y2="9"/>
            <line x1="9" y1="12" x2="15" y2="12"/>
            <line x1="9" y1="15" x2="15" y2="15"/>
        </svg>
        <h4>System Architecture</h4>
    </div>
    
    
</div>

<div class="war-story">
    <h4>"War Story": The Test That Revealed AIs "Laziness"</h4>
    <p>We wrote a test to verify that the tools were working.</p>

<p><em>Reference code: <code>tests/test_tools.py</code></em></p>

<p>The test was simple: give an agent a task that clearly <em>required</em> a web search (e.g., "Who is the current CEO of OpenAI?") and verify that the <code>websearch</code> tool was called.</p>

<p>The first results were disconcerting: <strong>the test failed 50% of the time.</strong></p>

<p><em>Disaster Logbook (July 27):</em></p>

<pre><code class="language-text">ASSERTION FAILED: Web search tool was not called.;
AI Response: &quot;As of my last update in early 2023, the CEO of OpenAI was Sam Altman.&quot</code></pre>

<p><strong>The Problem:</strong> The LLM was "lazy." Instead of admitting it didnt have updated information and using the tool we had provided, it preferred to give an answer based on its internal knowledge, even if obsolete. It was choosing the easy way out, at the expense of quality and truthfulness.</p>

<p><strong>The Lesson Learned: You Must <em>Force</em> Tool Usage</strong></p>

<p>Its not enough to <em>give</em> a tool to an agent. You must create an environment and instructions that <strong>incentivize (or force) it to use it</strong>.</p>

<p>The solution was a refinement of our prompt engineering:</p>

<ol>
<li><strong>Explicit Instructions in System Prompt:</strong> We added a phrase to each agent's system prompt: <em>"When you need current or specific information that you don't have, you MUST use the appropriate tools available to you."</em></li>
<li><strong>"Priming" in Task Prompt:</strong> When assigning a task, we started adding a hint: <em>"This task requires up-to-date information. Use your tools to ensure accuracy."</em></li>
</ol>

<p>These changes increased tool usage from 50% to over 95%, solving the "laziness" problem and ensuring our agents actively sought real data.</p>
</div>

<div class="key-takeaways-section">
    <h4 class="key-takeaways-title">📝 Key Takeaways of the Chapter:</h4>
    <p class="takeaway-item">✓ <strong>Agents Need Tools:</strong> An AI system without access to external tools is a limited system destined to become obsolete.</p>
<p class="takeaway-item">✓ <strong>Centralize Tools in a Registry:</strong> Don't tie tools to specific agents. A modular registry is more scalable and maintainable.</p>
<p class="takeaway-item">✓ <strong>AI Can Be "Lazy":</strong> Don't assume an agent will use the tools you provide. You must explicitly instruct and incentivize it to do so.</p>
<p class="takeaway-item">✓ <strong>Test <em>Behavior</em>, Not Just Output:</strong> Tool tests shouldn't just verify that the tool works, but that the agent <em>decides</em> to use it when strategically correct.</p>

</div>

<p><strong>Chapter Conclusion</strong></p>

<p>With the introduction of tools, our agents finally had a way to produce reality-based results. But this opened a new Pandora's box: <strong>quality</strong>.</p>

<p>Now that agents could produce data-rich content, how could we be sure this content was high quality, consistent, and, most importantly, of real business value? It was time to build our <strong>Quality Gate</strong>.</p>
            </div>
                    <p>Now that you understand specialist agent architecture, it's time to build the <a href="../agent-toolbox/" class="narrative-link">perfect toolkit</a> to orchestrate them effectively.</p>
                    <div class="callout-meta">
                        <span class="reading-time">⏱️ 8 min read</span>
                        <span class="difficulty">📊 Intermediate</span>
                    </div>
                </div>
                

<!-- Bottom Navigation -->
        <nav class="chapter-nav-bottom">
            <div class="nav-section">
                <div class="nav-label">← Previous Chapter</div>
                <a href="../agent-environment-interactions/" class="nav-link nav-prev">
                    Agent Environment Interactions
                </a>
            </div>
            <div class="nav-section center">
                <a href="../" class="nav-link nav-home">📚 Movement Overview</a>
            </div>
            <div class="nav-section">
                <div class="nav-label">Next Movement →</div>
                <a href="../../execution-quality/" class="nav-link nav-next">
                    Execution & Quality
                </a>
            </div>
        </nav>
        </div>
    </div>

        <!-- Reader Tools -->
        <div class="reader-tools" id="readerTools">
            <button class="reader-tools-toggle" onclick="toggleReaderTools()">⚙</button>
            
            <div class="reader-tool" onclick="toggleTheme()">
                <span class="reader-tool-icon" id="themeIcon">🌙</span>
                <span class="reader-tool-label">Theme</span>
            </div>
            
            <div class="reader-tool" onclick="toggleBookmark()">
                <span class="reader-tool-icon">🔖</span>
                <span class="reader-tool-label">Bookmark</span>
            </div>
            
            <div class="reader-tool" onclick="showBookmarks()">
                <span class="reader-tool-icon">📚</span>
                <span class="reader-tool-label">My Bookmarks</span>
            </div>
            
            <div class="language-switcher">
                <select class="language-select" onchange="switchLanguage(this.value)">
                    <option value="en">🇬🇧 EN</option>
                    <option value="it">🇮🇹 IT</option>
                </select>
            </div>
            
            <div class="reader-tool" onclick="showFontSizeMenu()">
                <span class="reader-tool-icon">🔤</span>
                <span class="reader-tool-label">Font Size</span>
            </div>
        </div>
        
        <!-- Reading Progress -->
        <div class="reading-progress">
            <div class="reading-progress-fill" id="progressFill"></div>
        </div>
        
        <!-- Bookmark Toast -->
        <div class="bookmark-toast" id="bookmarkToast">
            <span id="bookmarkMessage">Bookmark saved!</span>
        </div>        </div>
        
        <!-- Bookmarks Modal -->
        <div class="bookmarks-modal" id="bookmarksModal" onclick="closeBookmarksModal(event)">
            <div class="bookmarks-content" onclick="event.stopPropagation()">
                <div class="bookmarks-header">
                    <h2 class="bookmarks-title">📚 My Bookmarks</h2>
                    <button class="bookmarks-close" onclick="closeBookmarksModal()">✕</button>
                </div>
                <div class="bookmarks-list" id="bookmarksList">
                    <!-- Bookmarks will be populated by JavaScript -->
                </div>
</div>

    
    <script>
        // Complete Reader Tools JavaScript Functions
        
        function toggleTheme() {
            const body = document.body;
            const themeIcon = document.getElementById('themeIcon')
            const isDarkMode = body.classList.contains('dark-mode');
            
            if (isDarkMode) {
                body.classList.remove('dark-mode');
                if (themeIcon) themeIcon.textContent = '🌙';
                localStorage.setItem('theme', 'light');
            } else {
                body.classList.add('dark-mode');
                if (themeIcon) themeIcon.textContent = '☀️';
                localStorage.setItem('theme', 'dark');
            }
        }
        
        function toggleBookmark() {
            const currentPage = window.location.pathname;
            const pageTitle = document.querySelector('.chapter-title')?.textContent || 'Chapter';
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');
            const existingIndex = bookmarks.findIndex(b => b.url === currentPage);
            
            if (existingIndex > -1) {
                bookmarks.splice(existingIndex, 1);
                showToast('Bookmark removed!', 'error');
            } else {
                bookmarks.push({
                    url: currentPage,
                    title: pageTitle,
                    timestamp: new Date().toISOString()
                });
                showToast('Bookmark saved!', 'success');
            }
            
            localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
            updateBookmarkButton();
        }
        
        function showBookmarks() {
            createBookmarksModal();
            const modal = document.getElementById('bookmarksModal')
            const bookmarksList = document.getElementById('bookmarksList')
            const bookmarks = JSON.parse(localStorage.getItem('bookmarks') || []);
            
            if (bookmarks.length === 0) {
                bookmarksList.innerHTML = `
                    <div class="no-bookmarks">
                        <div class="no-bookmarks-icon">📚</div>
                        <h3>No bookmarks saved</h3>
                        <p>Start saving your favorite chapters by clicking the 🔖 icon</p>
                    </div>`;
                `;
            } else {
                bookmarksList.innerHTML = bookmarks
                    .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                    .map(bookmark => `
                        <div class="bookmark-item">
                            <div class="bookmark-info">
                                <div class="bookmark-title">${bookmark.title}</div>
                                <a href="${bookmark.url}" class="bookmark-url">${bookmark.url}</a>
                                <div class="bookmark-date">Saved ${new Date(bookmark.timestamp).toLocaleDateString()}</div>
                            </div>
                            <div class="bookmark-actions">
                                <button class="bookmark-action delete" onclick="deleteBookmark(${bookmark.url}')">🗑️</button>
                            </div>
                        </div>
                    `).join();
            }
            
            modal.style.display = flex;
            document.body.style.overflow = hidden';
        }
        
        function closeBookmarksModal(event) {
            const modal = document.getElementById('bookmarksModal')
            if (modal && (!event || event.target === modal))  {
                modal.style.display = 'none';
                document.body.style.overflow = '';
            }
        }
        
        function deleteBookmark(url) {
            let bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]);
            bookmarks = bookmarks.filter(b => b.url !== url);
            localStorage.setItem('bookmarks', JSON.stringify(bookmarks'));
            showToast('Bookmark removed!', 'error');
            showBookmarks();
        }
        
        function showFontSizeMenu() {
            const currentSize = localStorage.getItem('fontSize'') || 'medium';
            const sizes = [small, medium, large];
            const currentIndex = sizes.indexOf(currentSize);
            const newSize = sizes[(currentIndex + 1) % sizes.length];
            
            setFontSize(newSize);
            localStorage.setItem('fontSize', 'newSize');
            showToast('`Font size: ${newSize}`, 'success');
        }
        
        function setFontSize(size) {
            const root = document.documentElement;
            const sizes = {
                'small': 0.9',
                'medium': 1.0,
                'large': 1.1
            };
            if (sizes[size]) {
                root.style.fontSize = sizes[size] + em';
            }
        }
        
        function showToast(message, type = 'success') {
            let toast = document.getElementById('bookmarkToast')
            
            if (!toast) {
                toast = document.createElement(div);
                toast.id = bookmarkToast;
                toast.className = 'bookmark-toast;
                toast.innerHTML = <span id="bookmarkMessage"></span>';
        </div>                toast.style.cssText = `
                    position: fixed;
                    top: 80px;
                    right: 20px;
                    padding: 12px 20px;
                    border-radius: 8px;
                    color: white;
                    font-weight: 500;
                    z-index: 10001;
                    transform: translateX(100%);
                    transition: transform 0.3s ease;
                    background: #28a745;
                `;
                document.body.appendChild(toast);
            }
            
            const messageEl = document.getElementById('bookmarkMessage')
            if (messageEl) messageEl.textContent = message;
            
            toast.style.background = type === 'error' ? #dc3545 : '#28a745;
            toast.style.transform = 'translateX(0)';
            
            setTimeout(() => {
                toast.style.transform = translateX(100%);
            }, 3000);
        }
        
        function toggleReaderTools() {
            const tools = document.getElementById('readerTools')
            if (tools) {
                tools.classList.toggle('collapsed');
                localStorage.setItem('readerToolsCollapsed', tools.classList.contains('collapsed));
            }
        }
        
        function updateBookmarkButton() {
            const currentPage = window.location.pathname;
            const bookmarks = JSON.parse(localStorage.getItem('bookmarks') || []);
            const isBookmarked = bookmarks.some(b => b.url === currentPage);
            
            const bookmarkTool = document.querySelector('.reader-tool[onclick*="toggleBookmark"]');
            if (bookmarkTool) {
                bookmarkTool.classList.toggle('active', isBookmarked);
            }
        }
        
        function switchLanguage(lang) {
            const currentPath = window.location.pathname;
            let newPath = currentPath;
            
            if (lang === 'en'' && currentPath.includes(/it/))  {
                newPath = currentPath.replace(/it/, /en/);
                    .replace(filosofia-core-architettura, 'core-philosophy-architecture)
                    .replace(user-experience-trasparenza', user-experience-transparency)
                    .replace(esecuzione-qualita, execution-quality);
            } else if (lang === it && currentPath.includes('/en/))  {
                newPath = currentPath.replace(/en/, /it/);
                    .replace('core-philosophy-architecture, filosofia-core-architettura)
                    .replace(user-experience-transparency, user-experience-trasparenza)
                    .replace(execution-quality', esecuzione-qualita);
            }
            
            if (newPath !== currentPath) {
                window.location.href = newPath;
            }
        }
        
        function updateReadingProgress() {
            const progressFill = document.getElementById('progressFill')
            if (!progressFill) return;
            
            window.addEventListener('scroll', () => {
                const article = document.querySelector('.chapter-content');
                if (!article) return;
                
                const articleTop = article.offsetTop;
                const articleHeight = article.offsetHeight;
                const windowHeight = window.innerHeight;
                const scrollTop = window.pageYOffset;
                
                const progress = Math.min(100, Math.max(0, 
                    ((scrollTop + windowHeight - articleTop) / articleHeight) * 100;
                ));
                
                progressFill.style.width = progress + '%';
            });
        }
        
        function loadUserPreferences() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode);
                const themeIcon = document.getElementById('themeIcon')
                if (themeIcon) themeIcon.textContent = '☀️';
            }
            
            const savedFontSize = localStorage.getItem('fontSize');
            if (savedFontSize) {
                setFontSize(savedFontSize);
            }
            
            const toolsCollapsed = localStorage.getItem('readerToolsCollapsed') === true;
            if (toolsCollapsed) {
                const tools = document.getElementById('readerTools')
                if (tools) tools.classList.add('collapsed');
            }
        }
        
        function initializeReaderTools() {
            updateBookmarkButton();
            updateReadingProgress();
            loadUserPreferences();
        }
        
        function stopPropagation(event) {
            if (event) {
                event.stopPropagation();
            }
        }
        
        function createBookmarksModal() {
            if (document.getElementById('bookmarksModal')) return;
            
            const modal = document.createElement(div');
            modal.id = bookmarksModal;
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.8);
                z-index: 10000;
                display: none;
                align-items: center;
                justify-content: center;
                padding: 2rem;
            `;
            
            modal.innerHTML = `;
                <div style="background: white; border-radius: 15px; padding: 2rem; max-width: 500px; width: 100%; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid #f1f3f4;">
                        <h2 style="margin: 0; color: #2c3e50;">📚 My Bookmarks</h2>
                        <button onclick="closeBookmarksModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #adb5bd;">✕</button>
                    </div>
                    <div id="bookmarksList"></div>
                </div>`;
            `;
            
            modal.onclick = closeBookmarksModal;
            document.body.appendChild(modal);
        }
        
        // Initialize on DOM load
        document.addEventListener(DOMContentLoaded, initializeReaderTools);
    </script>

<!-- universal-progress-bar-added -->

    <!-- Mermaid.js for diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'base',
            themeVariables: {
                primaryColor: '#667eea',
                primaryTextColor: '#2c3e50',
                primaryBorderColor: '#667eea',
                lineColor: '#7f8c8d',
                secondaryColor: '#f8f9fa',
                tertiaryColor: '#ffffff'
            }
        });
    </script>
</body>
</html>