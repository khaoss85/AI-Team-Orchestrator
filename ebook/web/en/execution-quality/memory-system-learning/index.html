<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 14: The Memory System - The Learning Agent | Execution Quality | AI Team Orchestrator</title>
    <meta name="description" content="Chapter 14: The Memory System - How AI agents learn from experience and build institutional knowledge through structured insights and contextual memory systems.">
    <meta name="robots" content="index, follow">
    
    <style>
        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #2c3e50;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 2rem;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }
        
        /* Breadcrumb */
        .breadcrumb {
            background: rgba(102, 126, 234, 0.1);
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            font-size: 0.9rem;
        }
        
        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
        }
        
        .breadcrumb a:hover {
            text-decoration: underline;
        }
        
        .breadcrumb span {
            color: #7f8c8d;
            margin: 0 0.5rem;
        }
        
        /* Chapter Header */
        .chapter-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .chapter-instrument {
            font-size: 4rem;
            margin-bottom: 1rem;
        }
        
        .chapter-meta {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            color: #7f8c8d;
            flex-wrap: wrap;
        }
        
        .chapter-title {
            font-size: 2.5rem;
            color: #2c3e50;
            margin-bottom: 2rem;
            font-weight: 700;
            line-height: 1.2;
        }
        
        /* Content Styles */
        .chapter-content {
            line-height: 1.8;
        }
        
        .chapter-content h2,
        .chapter-content h3,
        .chapter-content h4 {
            color: #2c3e50;
            margin: 2rem 0 1rem 0;
        }
        
        .chapter-content h2 {
            font-size: 2rem;
            border-bottom: 3px solid #667eea;
            padding-bottom: 0.5rem;
        }
        
        .chapter-content h3 {
            font-size: 1.5rem;
            color: #667eea;
        }
        
        .chapter-content p {
            margin-bottom: 1.5rem;
            text-align: justify;
        }
        
        .chapter-content ul, .chapter-content ol {
            margin: 1.5rem 0;
            padding-left: 2rem;
        }
        
        .chapter-content li {
            margin-bottom: 0.5rem;
        }
        
        .chapter-content strong {
            color: #2c3e50;
            font-weight: 600;
        }
        
        .chapter-content code {
            background: #f8f9fa;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9rem;
        }
        
        .chapter-content pre {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1.5rem 0;
        }
        
        .chapter-content pre code {
            background: none;
            padding: 0;
        }
        
        /* Chapter Navigation */
        .chapter-nav {
            margin: 3rem 0;
            padding: 2rem 0;
            border-top: 2px solid #f1f3f4;
            border-bottom: 2px solid #f1f3f4;
        }
        
        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .nav-link {
            display: flex;
            flex-direction: column;
            padding: 1rem 1.5rem;
            background: white;
            border-radius: 10px;
            border: 2px solid #e9ecef;
            text-decoration: none;
            color: #2c3e50;
            transition: all 0.3s ease;
            flex: 1;
            max-width: 280px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .nav-link:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.2);
        }
        
        .nav-direction {
            font-size: 0.8rem;
            color: #667eea;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .nav-title {
            font-weight: 500;
            color: #2c3e50;
        }
        
        .nav-link.up {
            max-width: 200px;
            text-align: center;
        }
        
        @media (max-width: 768px) {
            .nav-container {
                flex-direction: column;
            }
            
            .nav-link {
                max-width: 100%;
                text-align: center;
            }
        }
        
        /* Dark mode navigation */
        .dark-mode .chapter-nav {
            border-color: #374151;
        }
        
        .dark-mode .nav-link {
            background: rgba(255, 255, 255, 0.05);
            border-color: #374151;
            color: #e9ecef;
        }
        
        .dark-mode .nav-link:hover {
            border-color: #667eea;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .dark-mode .nav-title {
            color: #e9ecef;
        }

        /* Reader Tools */
        .reader-tools {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
            transition: all 0.3s ease;
            min-width: 60px;
        }
        
        .reader-tools.collapsed {
            width: 60px;
            padding: 0.8rem;
        }
        
        .reader-tool {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.6rem;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s ease;
            color: #495057;
            font-size: 0.85rem;
            white-space: nowrap;
        }
        
        .reader-tool:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }
        
        .reader-tool.active {
            background: #667eea;
            color: white;
        }
        
        .reader-tool-icon {
            font-size: 1.1rem;
            flex-shrink: 0;
        }
        
        .reader-tool-label {
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .collapsed .reader-tool-label {
            display: none;
        }
        
        .reader-tools-toggle {
            position: absolute;
            top: -10px;
            left: -10px;
            width: 30px;
            height: 30px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        /* Language Switcher */
        .language-select {
            background: transparent;
            border: none;
            color: inherit;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            outline: none;
            min-width: 60px;
        }
        
        .language-select option {
            background: white;
            color: #2c3e50;
        }
        
        /* Reading Progress */
        .reading-progress {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: rgba(102, 126, 234, 0.2);
            z-index: 1001;
        }
        
        .reading-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        /* Bookmark Toast */
        .bookmark-toast {
            position: fixed;
            top: 80px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 0.8rem 1.2rem;
            border-radius: 8px;
            z-index: 1002;
            transform: translateX(350px);
            opacity: 0;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
        }
        
        .bookmark-toast.show {
            transform: translateX(0);
            opacity: 1;
        }
        
        .bookmark-toast.error {
            background: #dc3545;
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
        }
        
        /* Bookmarks Modal */
        .bookmarks-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            backdrop-filter: blur(5px);
        }
        
        .bookmarks-modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .bookmarks-content {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        .bookmarks-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #667eea;
        }
        
        .bookmarks-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .close-bookmarks {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #7f8c8d;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }
        
        .close-bookmarks:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }
        
        .bookmarks-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .bookmark-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 0.5rem;
            background: rgba(102, 126, 234, 0.05);
            transition: all 0.2s ease;
        }
        
        .bookmark-item:hover {
            background: rgba(102, 126, 234, 0.1);
            transform: translateX(5px);
        }
        
        .bookmark-info {
            flex-grow: 1;
        }
        
        .bookmark-title {
            font-weight: 600;
            color: #2c3e50;
            text-decoration: none;
            font-size: 1rem;
            line-height: 1.4;
        }
        
        .bookmark-title:hover {
            color: #667eea;
        }
        
        .bookmark-date {
            font-size: 0.8rem;
            color: #7f8c8d;
            margin-top: 0.3rem;
        }
        
        .bookmark-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .bookmark-action {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.3rem;
            border-radius: 5px;
            transition: all 0.2s ease;
            color: #7f8c8d;
        }
        
        .bookmark-action:hover {
            background: rgba(220, 53, 69, 0.1);
            color: #dc3545;
        }
        
        .empty-bookmarks {
            text-align: center;
            padding: 2rem;
            color: #7f8c8d;
        }
        
        .empty-bookmarks-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        
        /* Dark Mode */
        body.dark-mode {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e9ecef;
        }
        
        .dark-mode .container {
            background: rgba(255, 255, 255, 0.05);
            color: #e9ecef;
        }
        
        .dark-mode .breadcrumb {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .dark-mode .breadcrumb a {
            color: #9bb5ff;
        }
        
        .dark-mode .chapter-title,
        .dark-mode .chapter-content h2,
        .dark-mode .chapter-content h3,
        .dark-mode .chapter-content h4 {
            color: #e9ecef;
        }
        
        .dark-mode .chapter-content h3 {
            color: #9bb5ff;
        }
        
        .dark-mode .chapter-content strong {
            color: #e9ecef;
        }
        
        .dark-mode .chapter-content code {
            background: rgba(255, 255, 255, 0.1);
            color: #e9ecef;
        }
        
        .dark-mode .chapter-content pre {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .dark-mode .reader-tools {
            background: rgba(0, 0, 0, 0.8);
            color: #e9ecef;
        }
        
        .dark-mode .reader-tool {
            color: #e9ecef;
        }
        
        .dark-mode .reader-tool:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .dark-mode .language-select option {
            background: #1a1a2e;
            color: #e9ecef;
        }
        
        .dark-mode .bookmarks-content {
            background: #1a1a2e;
            color: #e9ecef;
        }
        
        .dark-mode .bookmarks-title {
            color: #e9ecef;
        }
        
        .dark-mode .bookmark-item {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .dark-mode .bookmark-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .dark-mode .bookmark-title {
            color: #e9ecef;
        }
        
        .dark-mode .bookmark-title:hover {
            color: #9bb5ff;
        }
        /* Special Content Boxes */
        .architecture-section {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 2rem;
            margin: 2rem 0;
        }
        
        .architecture-title {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
            font-weight: 600;
            color: #495057;
        }
        
        .architecture-title h4 {
            margin: 0;
            color: #495057;
        }
        
        .architecture-icon {
            width: 24px;
            height: 24px;
            margin-right: 12px;
            flex-shrink: 0;
        }
        
        .war-story {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border-left: 4px solid #856404;
            border-radius: 10px;
            padding: 2rem;
            margin: 2rem 0;
        }
        
        .war-story h4 {
            color: #856404;
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .key-takeaways-section {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border-radius: 10px;
            padding: 2rem;
            margin: 2rem 0;
        }
        
        .key-takeaways-title {
            margin-bottom: 1rem;
            font-weight: 600;
        }
        
        .takeaway-item {
            margin-bottom: 1rem;
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
        }
        
        .mermaid {
            background: #f8f9fa;
            padding: 2rem;
            border-radius: 10px;
            margin: 2rem 0;
            text-align: center;
        }
        
        .mermaid svg {
            max-width: 100%;
            height: auto;
        }
        
        /* Dark mode for special boxes */
        .dark-mode .architecture-section {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        .dark-mode .architecture-title,
        .dark-mode .architecture-title h4 {
            color: #e9ecef;
        }
        
        .dark-mode .war-story {
            background: rgba(255, 243, 205, 0.1);
            border-left-color: #ffd700;
        }
        
        .dark-mode .war-story h4 {
            color: #ffd700;
        }
        
        .dark-mode .mermaid {
            background: rgba(255, 255, 255, 0.05);
        }
        
        /* Contextual Links */
        .contextual-link {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
            border-bottom: 1px dotted #667eea;
            transition: all 0.2s ease;
        }
        
        .contextual-link:hover {
            color: #5a6fd8;
            border-bottom-style: solid;
        }
        
        .dark-mode .contextual-link {
            color: #9bb5ff;
            border-bottom-color: #9bb5ff;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }
            
            .container {
                padding: 1.5rem;
            }
            
            .chapter-title {
                font-size: 2rem;
            }
            
            .chapter-content h2 {
                font-size: 1.5rem;
            }
            
            .reader-tools {
                right: 10px;
                padding: 0.8rem;
                min-width: 50px;
            }
            
            .reader-tools.collapsed {
                width: 50px;
                padding: 0.6rem;
            }
            
            .reader-tool {
                padding: 0.5rem;
            }
            
            .reader-tool-label {
                font-size: 0.75rem;
            }
        }
        
        /* PDF/Print Specific Styles - Hide UI Elements */
        @media print {
            .bookmarks-modal,
            .reader-tools,
            .bookmark-toast,
            #bookmarksModal,
            #bookmarkToast {
                display: none !important;
                visibility: hidden !important;
                opacity: 0 !important;
                z-index: -1000 !important;
            }
        }
            </style>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,CiAgICA8c3ZnIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDMyIDMyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogICAgICAgIDxkZWZzPgogICAgICAgICAgICA8bGluZWFyR3JhZGllbnQgaWQ9ImdyYWQxIiB4MT0iMCUiIHkxPSIwJSIgeDI9IjEwMCUiIHkyPSIxMDAlIj4KICAgICAgICAgICAgICAgIDxzdG9wIG9mZnNldD0iMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiM2NjdlZWE7c3RvcC1vcGFjaXR5OjEiIC8+CiAgICAgICAgICAgICAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiM3NjRiYTI7c3RvcC1vcGFjaXR5OjEiIC8+CiAgICAgICAgICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgICAgICAgPC9kZWZzPgogICAgICAgIDwhLS0gQmFja2dyb3VuZCBjaXJjbGUgLS0+CiAgICAgICAgPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTUiIGZpbGw9InVybCgjZ3JhZDEpIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMiIvPgogICAgICAgIDwhLS0gQUkgQnJhaW4gaWNvbiAtLT4KICAgICAgICA8Y2lyY2xlIGN4PSIxNiIgY3k9IjEzIiByPSI4IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMiIvPgogICAgICAgIDxjaXJjbGUgY3g9IjEzIiBjeT0iMTEiIHI9IjEiIGZpbGw9IiNmZmYiLz4KICAgICAgICA8Y2lyY2xlIGN4PSIxOSIgY3k9IjExIiByPSIxIiBmaWxsPSIjZmZmIi8+CiAgICAgICAgPHBhdGggZD0iTTEyIDE1YzEgMiAzIDIgNCAyczMgMCA0LTIiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLXdpZHRoPSIxLjUiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgogICAgICAgIDwhLS0gVGVhbSBvcmNoZXN0cmF0aW9uIGxpbmVzIC0tPgogICAgICAgIDxwYXRoIGQ9Ik04IDI0TDE2IDIwTDI0IDI0IiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMiIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgICAgICAgPGNpcmNsZSBjeD0iOCIgY3k9IjI0IiByPSIyIiBmaWxsPSIjZmZmIi8+CiAgICAgICAgPGNpcmNsZSBjeD0iMTYiIGN5PSIyMCIgcj0iMiIgZmlsbD0iI2ZmZiIvPgogICAgICAgIDxjaXJjbGUgY3g9IjI0IiBjeT0iMjQiIHI9IjIiIGZpbGw9IiNmZmYiLz4KICAgIDwvc3ZnPgogICAg">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,CiAgICA8c3ZnIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDMyIDMyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogICAgICAgIDxkZWZzPgogICAgICAgICAgICA8bGluZWFyR3JhZGllbnQgaWQ9ImdyYWQxIiB4MT0iMCUiIHkxPSIwJSIgeDI9IjEwMCUiIHkyPSIxMDAlIj4KICAgICAgICAgICAgICAgIDxzdG9wIG9mZnNldD0iMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiM2NjdlZWE7c3RvcC1vcGFjaXR5OjEiIC8+CiAgICAgICAgICAgICAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiM3NjRiYTI7c3RvcC1vcGFjaXR5OjEiIC8+CiAgICAgICAgICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgICAgICAgPC9kZWZzPgogICAgICAgIDwhLS0gQmFja2dyb3VuZCBjaXJjbGUgLS0+CiAgICAgICAgPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTUiIGZpbGw9InVybCgjZ3JhZDEpIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMiIvPgogICAgICAgIDwhLS0gQUkgQnJhaW4gaWNvbiAtLT4KICAgICAgICA8Y2lyY2xlIGN4PSIxNiIgY3k9IjEzIiByPSI4IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMiIvPgogICAgICAgIDxjaXJjbGUgY3g9IjEzIiBjeT0iMTEiIHI9IjEiIGZpbGw9IiNmZmYiLz4KICAgICAgICA8Y2lyY2xlIGN4PSIxOSIgY3k9IjExIiByPSIxIiBmaWxsPSIjZmZmIi8+CiAgICAgICAgPHBhdGggZD0iTTEyIDE1YzEgMiAzIDIgNCAyczMgMCA0LTIiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLXdpZHRoPSIxLjUiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgogICAgICAgIDwhLS0gVGVhbSBvcmNoZXN0cmF0aW9uIGxpbmVzIC0tPgogICAgICAgIDxwYXRoIGQ9Ik04IDI0TDE2IDIwTDI0IDI0IiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMiIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgICAgICAgPGNpcmNsZSBjeD0iOCIgY3k9IjI0IiByPSIyIiBmaWxsPSIjZmZmIi8+CiAgICAgICAgPGNpcmNsZSBjeD0iMTYiIGN5PSIyMCIgcj0iMiIgZmlsbD0iI2ZmZiIvPgogICAgICAgIDxjaXJjbGUgY3g9IjI0IiBjeT0iMjQiIHI9IjIiIGZpbGw9IiNmZmYiLz4KICAgIDwvc3ZnPgogICAg">
    <link rel="canonical" href="https://books.danielepelleri.com/en/execution-quality/memory-system-learning/" />
</head>
<body>
    <div class="container">
        <!-- Breadcrumb -->
        <nav class="breadcrumb">
            <a href="../../ai-team-orchestrator.html">🏠 AI Team Orchestrator</a>
            <span>›</span>
            <a href="../">🎺 Execution & Quality</a>
            <span>›</span>
            <span>The Memory System - The Learning Agent</span>
        </nav>
        <header class="chapter-header">
            <div class="chapter-instrument">🎺</div>
            <div class="chapter-meta">
                <span>Movement 2 of 4</span>
                <span>Chapter 14 of 42</span>
                <span>Ready to Read</span>
            </div>
            <h1 class="chapter-title">The Memory System - The Learning Agent</h1>
        </header>

        <div class="chapter-content">
            <h2>Chapter 14: The Memory System - The Learning Agent</h2>
            
            <p>Up to this point, our system had become incredibly competent at executing complex tasks. But it still suffered from a form of <strong>digital amnesia</strong>. Every new project, every new task, started from scratch. Lessons learned in one workspace weren't transferred to another. Successes weren't replicated and, worse yet, errors were repeated.</p>
            
            <p>A system that doesn't learn from its own past isn't truly intelligent; it's just a fast automaton. To realize our vision of a <strong>self-learning AI team (Pillar #4)</strong>, we had to build the most critical and complex component of all: a <strong>persistent and contextual memory system</strong>.</p>

            <h3>The Memory System Landscape</h3>
            
            <p>When we started designing the memory system, we faced a fundamental question: <strong>what should an AI agent remember?</strong></p>
            
            <p>The naive approach would be to save everything: every API call, every response, every intermediate result. But this would create an unusable data swamp. Our memory had to be <strong>curated, structured, and actionable</strong>.</p>
            
            <div class="architecture-section">
                <div class="architecture-title">
                    <svg class="architecture-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                        <line x1="9" y1="9" x2="15" y2="9"/>
                        <line x1="9" y1="12" x2="15" y2="12"/>
                        <line x1="9" y1="15" x2="15" y2="15"/>
                    </svg>
                    <h4>The Architectural Decision: Beyond a Simple Database</h4>
                </div>
                
                <p>The first, fundamental decision was understanding what memory should <em>not</em> be. It shouldn't be a simple event log or a dump of all task results. Such memory would just be "noise", an archive impossible to consult usefully.</p>
                
                <p>Our memory had to be:</p>
                
                <ul>
                    <li><strong>Curated:</strong> It should contain only high strategic value information.</li>
                    <li><strong>Structured:</strong> Every memory should be typed and categorized.</li>
                    <li><strong>Contextual:</strong> It should be easy to retrieve the right information at the right time.</li>
                    <li><strong>Actionable:</strong> Every "memory" should be formulated to guide future decisions.</li>
                </ul>
            </div>

            <p>We therefore designed <code>WorkspaceMemory</code>, a dedicated service that manages structured "insights".</p>
            
            <p><em>Reference code: <code>backend/workspace_memory.py</code></em></p>
            
            <h3>Anatomy of an "Insight" (a Memory)</h3>
            
            <p>We defined a Pydantic model for each "memory", forcing the system to think structurally about what it was learning.</p>
            
            <pre><code class="language-python">class InsightType(Enum):
    SUCCESS_PATTERN = "success_pattern"
    FAILURE_LESSON = "failure_lesson"
    DISCOVERY = "discovery"  # Something new and unexpected
    CONSTRAINT = "constraint"  # A rule or constraint to respect

class WorkspaceInsight(BaseModel):
    id: UUID
    workspace_id: UUID
    task_id: Optional[UUID]  # The task that generated the insight
    insight_type: InsightType
    content: str  # The lesson, formulated in natural language
    relevance_tags: List[str]  # Tags for search (e.g., "email_marketing", "ctr_optimization")
    confidence_score: float  # How confident we are about this lesson</code></pre>

            <h3>The Learning Flow: How the Agent Learns</h3>
            
            <p>Learning isn't a passive process, but an explicit action that occurs at the end of every execution cycle.</p>

            <div class="architecture-section">
                <div class="architecture-title">
                    <svg class="architecture-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                        <line x1="9" y1="9" x2="15" y2="9"/>
                        <line x1="9" y1="12" x2="15" y2="12"/>
                        <line x1="9" y1="15" x2="15" y2="15"/>
                    </svg>
                    <h4>Learning Flow Architecture</h4>
                </div>
                
                <div class="mermaid">
graph TD
    A[Task Completed] --> B[Post-Execution Analysis]
    B --> C[AI analyzes the result and process]
    C --> D[Extracts a Key Insight]
    D --> E[Types the Insight - Success, Failure, etc.]
    E --> F[Generates Relevance Tags]
    F --> G[Saves Structured Insight in WorkspaceMemory]
                </div>
            </div>

            <div class="war-story">
                <h4>💡 "War Story": The Polluted Memory</h4>
                <p>Our first attempts to implement memory were a disaster. We simply asked the agent at the end of each task: "What did you learn?"</p>
                
                <p><em>Disaster Logbook (July 28th):</em></p>
                
                <pre><code class="language-text">INSIGHT 1: "I completed the task successfully." (Useless)
INSIGHT 2: "Market analysis is important." (Banal)
INSIGHT 3: "Using a friendly tone in emails seems to work." (Vague)</code></pre>
                
                <p>Our memory was filling up with useless banalities. It was "polluted" by low-value information that made it impossible to find the real gems.</p>
                
                <p><strong>The Lesson Learned: Learning Must Be Specific and Measurable.</strong></p>
                
                <p>It's not enough to ask AI to "learn". You have to force it to formulate its lessons in a way that's <strong>specific, measurable, and actionable</strong>.</p>
                
                <p>We completely rewrote the prompt for insight extraction:</p>
                
                <p><em>Reference code: Logic within <code>AIMemoryIntelligence</code></em></p>
                
                <pre><code class="language-python">prompt = f"""
Analyze the following completed task and its result. Extract ONE SINGLE actionable insight that can be used to improve future performance.

**Executed Task:** {task.name}
**Result:** {task.result}
**Quality Score Achieved:** {quality_score}/100

**Required Analysis:**
1. **Identify the Cause:** What single action, pattern, or technique contributed most to the success (or failure) of this task?
2. **Quantify the Impact:** If possible, quantify the impact. (E.g., "Using the {{company}} token in the subject increased open rate by 15%").
3. **Formulate the Lesson:** Write the lesson as a general rule applicable to future tasks.
4. **Create Tags:** Generate 3-5 specific tags to make this insight easy to find.

**Example Success Insight:**
- **content:** "Emails that include a specific numerical statistic in the first paragraph achieve 20% higher click-through rates."
- **relevance_tags:** ["email_copywriting", "ctr_optimization", "data_driven"]

**Example Lesson from Failure:**
- **content:** "Generating contact lists without an email verification process leads to 40% bounce rates, making campaigns ineffective."
- **relevance_tags:** ["contact_generation", "email_verification", "bounce_rate"]

**Output Format (JSON only):**
{{
  "insight_type": "SUCCESS_PATTERN" | "FAILURE_LESSON",
  "content": "The specific and quantified lesson.",
  "relevance_tags": ["tag1", "tag2"],
  "confidence_score": 0.95
}}
"""</code></pre>
                
                <p>This prompt changed everything. It forced the AI to stop producing banalities and start generating <strong>strategic knowledge</strong>.</p>
            </div>

            <h3>The Power of Contextual Retrieval</h3>
            
            <p>Having insights in memory is only half the battle. The real challenge is <strong>retrieving the right insight at the right moment</strong>.</p>
            
            <p>We developed a semantic search system that, before starting any new task, queries the memory for relevant patterns:</p>
            
            <pre><code class="language-python">def get_relevant_insights(task_context: str, workspace_id: UUID) -> List[WorkspaceInsight]:
    # Semantic search based on task context and tags
    relevant_insights = memory_service.search_insights(
        workspace_id=workspace_id,
        context=task_context,
        min_confidence=0.7,
        max_results=3
    )
    return relevant_insights</code></pre>
            
            <p>This allows agents to "remember" lessons from previous tasks and apply them proactively.</p>
            
            <div class="key-takeaways-section">
                <h4 class="key-takeaways-title">📝 Key Takeaways of the Chapter</h4>
                <div class="takeaway-item">✓ <strong>Memory isn't an Archive, it's a Learning System:</strong> Don't save everything. Design a system to extract and save only high-value insights.</div>
                <div class="takeaway-item">✓ <strong>Structure Your Memories:</strong> Use data models (like Pydantic) to give shape to your "memories". This makes them queryable and usable.</div>
                <div class="takeaway-item">✓ <strong>Force AI to Be Specific:</strong> Always ask to quantify impact and formulate lessons that are general and actionable rules.</div>
                <div class="takeaway-item">✓ <strong>Use Tags for Contextualization:</strong> A good tagging system is fundamental for retrieving the right insight at the right time.</div>
                <div class="takeaway-item">✓ <strong>Semantic Retrieval is Key:</strong> Build systems that can find relevant past experiences based on current context, not just keywords.</div>
            </div>
            
            <h3>Chapter Conclusion</h3>
            
            <p>With a functioning memory system, our agent team had finally acquired the ability to learn. Every executed project was no longer an isolated event, but an opportunity to make the entire system more intelligent.</p>
            
            <p>But learning is useless if it doesn't lead to behavioral change. Our next challenge was closing the loop: how could we use stored lessons to <strong>automatically course-correct</strong> when a project was going badly? This led us to develop our <strong>Course Correction</strong> system.</p>

    <!-- Chapter Navigation -->
    <nav class="chapter-nav">
        <div class="nav-container">
            <a href="../final-assembly-last-mile/" class="nav-link prev">
                <span class="nav-direction">← Previous</span>
                <span class="nav-title">Chapter 13: Final Assembly - Last Mile Testing</span>
            </a>
            <a href="../" class="nav-link up">
                <span class="nav-direction">↑ Up</span>
                <span class="nav-title">Execution & Quality</span>
            </a>
            <a href="../improvement-cycle-correction/" class="nav-link next">
                <span class="nav-direction">Next →</span>
                <span class="nav-title">Chapter 15: Improvement Cycle - Self-Correction</span>
            </a>
        </div>
    </nav>
        </div>
            </div>
        </div>

        <!-- Reader Tools -->
        <div class="reader-tools" id="readerTools">
            <button class="reader-tools-toggle" onclick="toggleReaderTools()">⚙</button>
            <div class="reader-tool" onclick="toggleTheme()">
                <span class="reader-tool-icon" id="themeIcon">🌙</span>
                <span class="reader-tool-label">Theme</span>
            </div>
            <div class="reader-tool" onclick="toggleBookmark()">
                <span class="reader-tool-icon">🔖</span>
                <span class="reader-tool-label">Bookmark</span>
            </div>
            <div class="reader-tool" onclick="showBookmarks()">
                <span class="reader-tool-icon">📚</span>
                <span class="reader-tool-label">My Bookmarks</span>
            </div>
            <div class="reader-tool">
                <span class="reader-tool-icon">🌐</span>
                <select class="language-select" onchange="switchLanguage(this.value)">
                    <option value="en" selected>English</option>
                    <option value="it">Italiano</option>
                </select>
            </div>
            <div class="reader-tool" onclick="showFontSizeMenu()">
                <span class="reader-tool-icon">🔤</span>
                <span class="reader-tool-label">Font Size</span>
            </div>
        </div>

        <!-- Reading Progress -->
        <div class="reading-progress">
            <div class="reading-progress-fill" id="progressFill"></div>
        </div>
        
        <!-- Bookmark Toast -->
        <div class="bookmark-toast" id="bookmarkToast">
            <span id="bookmarkMessage">Bookmark saved!</span>
        </div>

        <!-- Bookmarks Modal -->
        <div class="bookmarks-modal" id="bookmarksModal" onclick="if(event.target === this) closeBookmarksModal()">
            <div class="bookmarks-content">
                <div class="bookmarks-header">
                    <h3 class="bookmarks-title">📚 My Bookmarks</h3>
                    <button class="close-bookmarks" onclick="closeBookmarksModal()">×</button>
                </div>
                <div class="bookmarks-list" id="bookmarksList">
                    <!-- Bookmarks will be populated by JavaScript -->
                </div>
            </div>
        </div>
        <!-- Related Chapters Section -->
        <div class="related-chapters-section">
            <div class="related-chapters-header">
                <h3>🔗 Related Chapters</h3>
                <p>Explore these chapters to deepen your understanding of memory systems and learning agents</p>
            </div>
            <div class="related-chapters-grid">
                <div class="related-chapter-item">
                    <h4><a href="../../../core-philosophy-architecture/15-pillars-ai-system/" class="related-link">15 Pillars of AI Systems</a></h4>
                    <p>Discover the foundational principles including <strong>Pillar #4: Self-Learning AI Team</strong> that guides memory system design.</p>
                    <a href="../../../core-philosophy-architecture/15-pillars-ai-system/" class="related-cta">Learn More →</a>
                </div>
                
                <div class="related-chapter-item">
                    <h4><a href="../improvement-cycle-correction/" class="related-link">Course Correction & Auto-Improvement</a></h4>
                    <p>Learn how memory insights trigger automatic course corrections when projects go off track.</p>
                    <a href="../improvement-cycle-correction/" class="related-cta">Learn More →</a>
                </div>
                
                <div class="related-chapter-item">
                    <h4><a href="../../../memory-system-scaling/memory-consolidation/" class="related-link">Memory Consolidation at Scale</a></h4>
                    <p>Explore how memory systems scale across multiple workspaces and maintain consistency.</p>
                    <a href="../../../memory-system-scaling/memory-consolidation/" class="related-cta">Learn More →</a>
                </div>
            </div>
    
        </div>
        
        <style>
        .related-chapters-section {
            margin: 3rem 0;
            padding: 2rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            border-left: 5px solid #667eea;
        }
        
        .related-chapters-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .related-chapters-header h3 {
            color: #2c3e50;
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }
        
        .related-chapters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .related-chapter-item {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .related-chapter-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
        }
        
        .related-link {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }
        
        .related-link:hover {
            color: #5a6fd8;
            text-decoration: underline;
        }
        
        .related-cta {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            margin-top: 1rem;
        }
        
        .related-cta:hover {
            color: #5a6fd8;
        }
        
        /* Dark mode support */
        .dark-mode .related-chapters-section {
            background: rgba(255, 255, 255, 0.05);
            color: #e9ecef;
        }
        
        .dark-mode .related-chapters-header h3 {
            color: #e9ecef;
        }
        
        .dark-mode .related-chapter-item {
            background: rgba(255, 255, 255, 0.05);
            color: #e9ecef;
        }
        
        /* PDF/Print Specific Styles - Hide UI Elements */
        @media print {
            .bookmarks-modal,
            .reader-tools,
            .bookmark-toast,
            #bookmarksModal,
            #bookmarkToast {
                display: none !important;
                visibility: hidden !important;
                opacity: 0 !important;
                z-index: -1000 !important;
            }
        }
                </style>
    
    <!-- Continue Reading Section -->
    <div class="continue-reading-section">
        <div class="continue-reading-header">
            <h3>📚 Continue Reading</h3>
        </div>
        <div class="continue-reading-actions">
            <a href="../../ai-team-orchestrator.html" class="continue-btn primary">
                <span class="btn-icon">🏠</span>
                <span class="btn-text">Back to Guide</span>
            </a>
            <a href="../core-philosophy-architecture/" class="continue-btn secondary">
                <span class="btn-icon">🎭</span>
                <span class="btn-text">Explore Movement</span>
            </a>
        </div>
    </div>
    
    <style>
    .continue-reading-section {
        margin: 2rem 0;
        padding: 1.5rem;
        text-align: center;
        background: linear-gradient(135deg, #667eea10, #764ba210);
        border-radius: 15px;
    }
    
    .continue-reading-header h3 {
        color: #2c3e50;
        margin-bottom: 1rem;
    }
    
    .continue-reading-actions {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
    }
    
    .continue-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.8rem 1.5rem;
        border-radius: 25px;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .continue-btn.primary {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
    }
    
    .continue-btn.secondary {
        background: rgba(102, 126, 234, 0.1);
        color: #667eea;
        border: 2px solid #667eea;
    }
    
    .continue-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
    }
    
    .dark-mode .continue-reading-header h3 {
        color: #e9ecef;
    }
        
        /* PDF/Print Specific Styles - Hide UI Elements */
        @media print {
            .bookmarks-modal,
            .reader-tools,
            .bookmark-toast,
            #bookmarksModal,
            #bookmarkToast {
                display: none !important;
                visibility: hidden !important;
                opacity: 0 !important;
                z-index: -1000 !important;
            }
        }
            </style>
    </div>

    <script>
        // Reader Tools JavaScript
        let readerToolsCollapsed = false;
        
        // Initialize reader tools
        document.addEventListener('DOMContentLoaded', function() {
            initializeReaderTools();
            updateReadingProgress();
            loadUserPreferences();
        });
        
        // Toggle reader tools visibility
        function toggleReaderTools() {
            const tools = document.getElementById('readerTools');
            readerToolsCollapsed = !readerToolsCollapsed;
            
            if (readerToolsCollapsed) {
                tools.classList.add('collapsed');
            } else {
                tools.classList.remove('collapsed');
            }
            
            localStorage.setItem('readerToolsCollapsed', readerToolsCollapsed);
        }
        
        // Theme toggle functionality
        function toggleTheme() {
            const body = document.body;
            const themeIcon = document.getElementById('themeIcon');
            const isDarkMode = body.classList.contains('dark-mode');
            
            if (isDarkMode) {
                body.classList.remove('dark-mode');
                themeIcon.textContent = '🌙';
                localStorage.setItem('theme', 'light');
            } else {
                body.classList.add('dark-mode');
                themeIcon.textContent = '☀️';
                localStorage.setItem('theme', 'dark');
            }
        }
        
        // Bookmark functionality
        function toggleBookmark() {
            const currentPage = window.location.pathname;
            const pageTitle = document.querySelector('.chapter-title').textContent;
            
            let bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]);
            const existingIndex = bookmarks.findIndex(b => b.url === currentPage);
            
            if (existingIndex > -1) {
                bookmarks.splice(existingIndex, 1);
                showToast('Bookmark removed!', 'error');
            } else {
                bookmarks.push({
                    url: currentPage,
                    title: pageTitle,
                    timestamp: new Date().toISOString()
                });
                showToast('Bookmark saved!', 'success');
            }
            
            localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
        }
        
        // Language switching
        function switchLanguage(lang) {
            const currentPath = window.location.pathname;
            let newPath;
            
            if (lang === 'en')  {
                newPath = currentPath.replace(/it/, /en/);
                    .replace('filosofia-core-architettura, core-philosophy-architecture')
                    .replace(user-experience-trasparenza, user-experience-transparency)
                    .replace(esecuzione-qualita, execution-quality)
                    .replace('memory-system-scaling, memory-system-scaling)
                    .replace(i-15-pilastri-sistema-ai, '15-pillars-ai-system)
                    .replace(primo-agente-specialist-architecture, first-specialist-agent-architecture)
                    .replace(isolare-intelligenza-mock-llm, ai-mocking-testing-strategy')
                    .replace(dramma-parsing-contratto-ai, 'drama-parsing-ai-contracts)
                    .replace(sdk-vs-api-battle, sdk-vs-direct-api-battle)
                    .replace(agente-ambiente-interazioni-fondamentali, agent-environment-interactions')
                    .replace(orchestratore-direttore-orchestra, orchestrator-conductor)
                    .replace(staffetta-mancata-handoff', failed-handoff-delegation)
                    .replace(recruiter-ai-team-dinamico, ai-recruiter-dynamic-team)
                    .replace(test-tool-ancorare-realta, 'tool-testing-reality-anchor)
                    .replace(cassetta-attrezzi-agente', agent-toolbox);
            } else if (lang === it) {;
                newPath = currentPath.replace(/en/, /it/);
                    .replace('core-philosophy-architecture, filosofia-core-architettura)
                    .replace(user-experience-transparency, 'user-experience-trasparenza)
                    .replace(execution-quality, esecuzione-qualita)
                    .replace(memory-system-scaling, memory-system-scaling')
                    .replace(15-pillars-ai-system, 'i-15-pilastri-sistema-ai)
                    .replace(first-specialist-agent-architecture, primo-agente-specialist-architecture)
                    .replace(ai-mocking-testing-strategy, isolare-intelligenza-mock-llm')
                    .replace(drama-parsing-ai-contracts, dramma-parsing-contratto-ai)
                    .replace(sdk-vs-direct-api-battle', sdk-vs-api-battle)
                    .replace(agent-environment-interactions, agente-ambiente-interazioni-fondamentali)
                    .replace(orchestrator-conductor, 'orchestratore-direttore-orchestra)
                    .replace(failed-handoff-delegation', staffetta-mancata-handoff)
                    .replace(ai-recruiter-dynamic-team, recruiter-ai-team-dinamico)
                    .replace(tool-testing-reality-anchor, 'test-tool-ancorare-realta)
                    .replace(agent-toolbox, cassetta-attrezzi-agente);
            }
            
            if (newPath && newPath !== currentPath) {
                window.location.href = newPath;
            }
        }
        
        // Font size menu (simplified)
        function showFontSizeMenu() {
            const currentSize = localStorage.getItem('fontSize') || 'medium';
            let newSize;
            
            switch (currentSize) {
                case 'small':
                    newSize = 'medium';
                    break;
                case medium':
                    newSize = large;
                    break;
                case ''large':
                    newSize = small;
                    break;
                default:
                    newSize = 'medium';
            }
            
            setFontSize(newSize);
            localStorage.setItem(fontSize', ), newSize);
            showToast(`Dimensione font: ${newSize}`, 'success');
        }
        
        // Set font size
        function setFontSize(size) {
            const root = document.documentElement;
            const sizes = {
                'small': 0.9,
                'medium': 1.0,
                'large': 1.1;
            };
            root.style.fontSize = sizes[size] + em;
        }
        
        // Show toast notification (improved)
        function showToast('message, type = 'success') {;
            const toast = document.getElementById('bookmarkToast')
            const messageEl = document.getElementById('bookmarkMessage')
            
            if (!toast || !messageEl) return;
            
            // Clear any existing timeouts
            if (window.toastTimeout) {
                clearTimeout(window.toastTimeout);
            }
            
            // Reset classes and set message
            toast.classList.remove(show, error')
            messageEl.textContent = message;
            
            // Add appropriate classes
            if (type === 'error')  {
                toast.classList.add('error');
            }
            
            // Show toast
            toast.classList.add('show');
            
            // Hide after delay
            window.toastTimeout = setTimeout(() =>  {
                toast.classList.remove('show');
            }, 3000);
        }
        
        // Reading progress
        function updateReadingProgress() {
            const progressFill = document.getElementById('progressFill')
            
            window.addEventListener(scroll', () => {
                const article = document.querySelector('.chapter-content');
                if (!article) return;
                
                const articleTop = article.offsetTop;
                const articleHeight = article.offsetHeight;
                const windowHeight = window.innerHeight;
                const scrollTop = window.pageYOffset;
                
                const progress = Math.min(100, Math.max(0, 
                    ((scrollTop + windowHeight - articleTop) / articleHeight) * 100;
                )');
                
                progressFill.style.width = progress + '%';
            });
        }
        
        // Load user preferences
        function loadUserPreferences() {
            // Load theme
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode);
                document.getElementById('themeIcon').textContent = '☀️';
            }
            
            // Load font size
            const savedFontSize = localStorage.getItem('fontSize');
            if (savedFontSize) {
                setFontSize(savedFontSize);
            }
            
            // Load reader tools state
            const toolsCollapsed = localStorage.getItem('readerToolsCollapsed') === 'true;
            if (toolsCollapsed) {
                document.getElementById('readerTools').classList.add('collapsed');
                readerToolsCollapsed = true;
            }
        }
        
        // Initialize reader tools
        function initializeReaderTools() {
            // Check if current page is bookmarked
            const currentPage = window.location.pathname;
            const bookmarks = JSON.parse(localStorage.getItem('bookmarks') || []);
            const isBookmarked = bookmarks.some(b => b.url === currentPage);
            
            if (isBookmarked) {
                document.querySelector('.reader-tool:nth-child(3)').classList.add('active');
            }
        
    
        // Show bookmarks modal
        function showBookmarks() {
            const modal = document.getElementById('bookmarksModal')
            const bookmarksList = document.getElementById('bookmarksList')
            const bookmarks = JSON.parse(localStorage.getItem('bookmarks') || []);
            
            if (bookmarks.length === 0) {
                bookmarksList.innerHTML = `
                    <div class="no-bookmarks">
                        <div class="no-bookmarks-icon">📚</div>
                        <h3>No bookmarks saved</h3>
                        <p>Start saving your favorite chapters clicking the icon 🔖</p>`;
                    </div>`;
            } else {
                bookmarksList.innerHTML = bookmarks.map(bookmark => `
                    <div class="bookmark-item">
                        <a href="${bookmark.url}" class="bookmark-link">
                            <div class="bookmark-title">${bookmark.title}</div>
                            <div class="bookmark-date">${new Date(bookmark.date).toLocaleDateString(it-IT')}</div>
                        </a>
                        <button class="delete-bookmark" onclick="deleteBookmark(${bookmark.url})">🗑️</button>
                    </div>
                `).join(');
            }
            
            modal.style.display = flex;
            document.body.style.overflow = hidden;
        }
        
        function closeBookmarksModal(event) {
            const modal = document.getElementById('bookmarksModal')
            if (modal && (!event || event.target === modal))  {
                modal.style.display = 'none;
                document.body.style.overflow = '';
            }
        }
        
        function deleteBookmark(url) {
            let bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]);
            bookmarks = bookmarks.filter(b => b.url !== url);
            localStorage.setItem('bookmarks', JSON.stringify(bookmarks'));
            showToast('Bookmark removed!', 'error');
            showBookmarks();
        }
        
        function showToast('message, type = 'success') {;
            let toast = document.getElementById('bookmarkToast')
            if (!toast) return;
            
            const messageEl = document.getElementById('bookmarkMessage')
            if (messageEl) messageEl.textContent = message;
            
            toast.style.background = type === 'error' ? '#dc3545' : '#28a745';
            toast.style.opacity = 1;
            toast.style.transform = 'translateY(0)';
            
            setTimeout(() => {
                toast.style.opacity = 0;
                toast.style.transform = 'translateY(-10px)';
            }, 3000);
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            const currentPage = window.location.pathname;
            const bookmarks = JSON.parse(localStorage.getItem('bookmarks') || []);
            const isBookmarked = bookmarks.some(b => b.url === currentPage);
            
            const bookmarkTool = document.querySelector('.reader-tool[onclick*="toggleBookmark"]');
            if (bookmarkTool) {
                bookmarkTool.classList.toggle('active', isBookmarked);
            }
            
            // Load saved theme
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                const themeIcon = document.getElementById('themeIcon')
                if (themeIcon) themeIcon.textContent = '☀️';
            }
        });
    
        }
    </script>

<!-- universal-progress-bar-added -->

    <!-- Mermaid.js for diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: base',
            themeVariables: {
                primaryColor: '#667eea,
                primaryTextColor: '#2c3e50',',
                primaryBorderColor: #667eea,
                lineColor: '#7f8c8d',',
                secondaryColor: #f8f9fa,
                tertiaryColor: #ffffff'
            }
        });
    </script>
</body>
</html>
